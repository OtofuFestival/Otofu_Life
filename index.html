<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>„Åä„Å®„Äú„Åµ‰∏ÄÁîü</title>
    <!-- LZStringÂúßÁ∏Æ„É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100vh;
            height: 100dvh;
            min-height: 100vh;
            min-height: 100dvh;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            overflow: hidden;
            position: relative;
            transition: background 1s ease;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        /* Portrait-safe viewport wrapper (prevents sideways layout on Android fullscreen) */
        #viewport {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            box-sizing: border-box;
        }

        #app {
            width: 100%;
            height: 100%;
            transform-origin: center center;
            will-change: transform, width, height;
            box-sizing: border-box;
        }

        
        body.night-bg {
            background: 
                radial-gradient(ellipse at top, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, 
                    #0a0e27 0%, 
                    #16213e 20%,
                    #1a1a40 40%,
                    #0f1b3d 60%,
                    #1e1e3f 80%,
                    #0a0e27 100%);
            background-size: 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        body.snow-bg {
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(230, 245, 255, 0.7) 0%, transparent 30%),
                radial-gradient(ellipse at 80% 70%, rgba(180, 220, 255, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(210, 235, 255, 0.4) 0%, transparent 50%),
                linear-gradient(180deg, 
                    #e8f4ff 0%,
                    #def0ff 6%,
                    #d4ecff 12%,
                    #cae8ff 18%,
                    #c0e4ff 24%,
                    #b6e0ff 30%,
                    #acdcff 36%,
                    #a2d8ff 42%,
                    #98d4ff 48%,
                    #8ed0ff 54%,
                    #84ccff 60%,
                    #7ac8ff 66%,
                    #70c4ff 72%,
                    #66c0ff 78%,
                    #5cbcff 84%,
                    #52b8ff 90%,
                    #48b4ff 96%,
                    #3eb0ff 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.forest-bg {
            background: 
                radial-gradient(ellipse at 25% 15%, rgba(150, 220, 120, 0.7) 0%, transparent 35%),
                radial-gradient(ellipse at 75% 75%, rgba(60, 140, 60, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(100, 180, 90, 0.4) 0%, transparent 50%),
                linear-gradient(180deg, 
                    #6fb350 0%,
                    #62a045 6%,
                    #568d3b 12%,
                    #4a7a32 18%,
                    #3f6829 24%,
                    #355621 30%,
                    #2c4619 36%,
                    #243713 42%,
                    #1d290e 48%,
                    #171e0a 54%,
                    #121508 60%,
                    #0e0f06 66%,
                    #0b0b05 72%,
                    #090804 78%,
                    #070603 84%,
                    #050402 90%,
                    #040302 96%,
                    #020201 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.rain-bg {
            background: 
                radial-gradient(ellipse at 30% 25%, rgba(150, 180, 220, 0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 70% 70%, rgba(100, 130, 180, 0.5) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(120, 150, 200, 0.4) 0%, transparent 50%),
                linear-gradient(180deg, 
                    #708090 0%,
                    #657585 8%,
                    #5a6a7a 16%,
                    #4f5f6f 24%,
                    #445464 32%,
                    #394959 40%,
                    #2e3e4e 48%,
                    #233343 56%,
                    #182838 64%,
                    #0d1d2d 72%,
                    #021222 80%,
                    #000717 88%,
                    #00020c 96%,
                    #000001 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.rainbow-bg {
            background: 
                radial-gradient(ellipse at 15% 20%, rgba(255, 0, 100, 0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 85% 25%, rgba(100, 0, 255, 0.6) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(0, 255, 150, 0.5) 0%, transparent 40%),
                radial-gradient(ellipse at 30% 70%, rgba(255, 200, 0, 0.5) 0%, transparent 35%),
                radial-gradient(ellipse at 70% 75%, rgba(0, 150, 255, 0.5) 0%, transparent 35%),
                linear-gradient(180deg, 
                    #ff1493 0%,
                    #ff3d8f 6%,
                    #ff5c8a 12%,
                    #ff7a86 18%,
                    #ff9981 24%,
                    #ffb87d 30%,
                    #ffd678 36%,
                    #fff573 42%,
                    #e8ff6f 48%,
                    #c8ff6f 54%,
                    #a8ff73 60%,
                    #88ff7d 66%,
                    #68ff8d 72%,
                    #48ffa3 78%,
                    #48e8ff 84%,
                    #48c8ff 90%,
                    #5c9dff 96%,
                    #7a6fff 100%);
            background-size: 100% 100%;
        }
        
        body.dream-bg {
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(255, 100, 150, 0.5) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 40%, rgba(100, 150, 255, 0.5) 0%, transparent 40%),
                radial-gradient(circle at 50% 60%, rgba(150, 255, 150, 0.4) 0%, transparent 45%),
                linear-gradient(180deg, 
                    #ff6b9d 0%,
                    #ff8ba7 7%,
                    #ffa8b4 14%,
                    #ffc4c4 21%,
                    #ffddcc 28%,
                    #fff4d4 35%,
                    #ffffdd 42%,
                    #e8ffdd 49%,
                    #d4ffdd 56%,
                    #c4ffe8 63%,
                    #b4f4ff 70%,
                    #a8ddff 77%,
                    #9dc4ff 84%,
                    #9da8ff 91%,
                    #a89dff 98%,
                    #b49dff 100%);
            background-size: 100% 100%;
        }
        
        body.sakura-bg {
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(255, 200, 220, 0.7) 0%, transparent 35%),
                radial-gradient(ellipse at 70% 75%, rgba(255, 180, 210, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(255, 220, 230, 0.4) 0%, transparent 50%),
                linear-gradient(180deg, 
                    #ffe8f0 0%,
                    #ffd8e8 8%,
                    #ffc8e0 16%,
                    #ffb8d8 24%,
                    #ffa8d0 32%,
                    #ff98c8 40%,
                    #ff88c0 48%,
                    #ff78b8 56%,
                    #ff68b0 64%,
                    #ff58a8 72%,
                    #ff48a0 80%,
                    #ff3898 88%,
                    #ff2890 96%,
                    #ff1888 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.earth-bg {
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(0, 150, 255, 0.7) 0%, transparent 35%),
                radial-gradient(ellipse at 70% 60%, rgba(50, 220, 50, 0.7) 0%, transparent 40%),
                radial-gradient(circle at 50% 80%, rgba(0, 200, 120, 0.6) 0%, transparent 45%),
                radial-gradient(ellipse at 45% 50%, rgba(160, 82, 45, 0.6) 0%, transparent 38%),
                linear-gradient(180deg, 
                    #001a33 0%,      /* Ê∑±„ÅÑÁ¥∫Ëâ≤ */
                    #003366 3%,      /* ÊøÉÁ¥∫ */
                    #004d99 6%,      /* ÊøÉ„ÅÑÈùí */
                    #0066cc 9%,      /* Èùí */
                    #0080ff 12%,     /* Êòé„Çã„ÅÑÈùí */
                    #0099ff 15%,     /* Ê∞¥Ëâ≤ */
                    #00aaff 18%,     /* Êòé„Çã„ÅÑÊ∞¥Ëâ≤ */
                    #00bbff 21%,     /* ÈÆÆ„ÇÑ„Åã„Å™Ê∞¥Ëâ≤ */
                    #11ccee 24%,     /* ÈùíÁ∑ë */
                    #22ddcc 27%,     /* „Ç®„É°„É©„É´„Éâ */
                    #33eeaa 30%,     /* Á∑ëÈùí */
                    #22cc66 33%,     /* ÊøÉ„ÅÑÁ∑ë */
                    #228844 36%,     /* Ê∑±Á∑ë */
                    #116622 39%,     /* Ê£ÆÊûó„ÅÆÁ∑ë */
                    #004400 42%,     /* ÊúÄ„ÇÇÊøÉ„ÅÑÁ∑ë */
                    #226633 45%,     /* Ê∑±Á∑ë */
                    #44aa55 48%,     /* Á∑ë */
                    #55dd66 51%,     /* Êòé„Çã„ÅÑÁ∑ë */
                    #66ff77 54%,     /* ÈÆÆ„ÇÑ„Åã„Å™Á∑ë */
                    #77dd55 57%,     /* ÈªÑÁ∑ë */
                    #88aa44 60%,     /* „Åè„Åô„Çì„Å†ÈªÑÁ∑ë */
                    #998833 63%,     /* ÈªÑÂúüËâ≤ */
                    #aa7744 66%,     /* Ëå∂Ëâ≤ */
                    #bb6633 69%,     /* ÊøÉ„ÅÑËå∂Ëâ≤ */
                    #cc5522 72%,     /* Ëµ§Ëå∂Ëâ≤ */
                    #dd4411 75%,     /* Ëµ§„Åø„ÅÆËå∂Ëâ≤ */
                    #cc5522 78%,     /* Ëå∂Ëâ≤ */
                    #bb5533 81%,     /* Ê∑±„ÅÑËå∂Ëâ≤ */
                    #aa5544 84%,     /* Êöó„ÅÑËå∂Ëâ≤ */
                    #995555 87%,     /* „Åè„Åô„Çì„Å†Ëå∂Ëâ≤ */
                    #886655 90%,     /* Ê∑±„ÅÑËå∂Ëâ≤ */
                    #775544 93%,     /* ÊúÄ„ÇÇÊøÉ„ÅÑËå∂Ëâ≤ */
                    #664433 96%,     /* ÊöóË§êËâ≤ */
                    #553322 100%);   /* „ÉÄ„Éº„ÇØ„Éñ„É©„Ç¶„É≥ */
            background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.toilet-bg {
            background: 
                radial-gradient(ellipse at 40% 25%, rgba(139, 90, 43, 0.5) 0%, transparent 35%),
                radial-gradient(ellipse at 60% 70%, rgba(160, 105, 60, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(205, 133, 63, 0.3) 0%, transparent 50%),
                linear-gradient(180deg, 
                    #8b6914 0%,
                    #9d7726 10%,
                    #af8538 20%,
                    #c1934a 30%,
                    #d3a15c 40%,
                    #c4956f 50%,
                    #b58982 60%,
                    #a67d95 70%,
                    #9771a8 80%,
                    #8865bb 90%,
                    #7959ce 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 22s ease infinite;
        }
        
        body.music-bg {
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(138, 43, 226, 0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 70% 60%, rgba(186, 85, 211, 0.5) 0%, transparent 40%),
                radial-gradient(circle at 50% 80%, rgba(147, 112, 219, 0.4) 0%, transparent 45%),
                linear-gradient(180deg, 
                    #4a148c 0%,
                    #5e1a9e 10%,
                    #7220b0 15%,
                    #8626c2 20%,
                    #9a2cd4 25%,
                    #ae32e6 30%,
                    #9c27b0 35%,
                    #8a1c9a 40%,
                    #781184 45%,
                    #66066e 50%,
                    #7820a0 55%,
                    #8a3ab2 60%,
                    #9c54c4 65%,
                    #ae6ed6 70%,
                    #c088e8 75%,
                    #d2a2fa 80%,
                    #c896ec 85%,
                    #be8ade 90%,
                    #b47ed0 95%,
                    #aa72c2 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 18s ease infinite;
        }
        
        body.love-bg {
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(255, 105, 180, 0.7) 0%, transparent 35%),
                radial-gradient(ellipse at 70% 60%, rgba(255, 20, 100, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 50% 80%, rgba(255, 60, 120, 0.5) 0%, transparent 45%),
                linear-gradient(180deg, 
                    #ff69b4 0%,
                    #ff5ca8 8%,
                    #ff4f9c 16%,
                    #ff4290 24%,
                    #ff3584 32%,
                    #ff2878 40%,
                    #ff1b6c 48%,
                    #ff0e60 56%,
                    #ff0154 64%,
                    #ee0050 72%,
                    #dd004c 80%,
                    #cc0048 88%,
                    #bb0044 96%,
                    #aa0040 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        body.money-bg {
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255, 223, 0, 0.8) 0%, transparent 30%),
                radial-gradient(ellipse at 80% 30%, rgba(255, 200, 50, 0.7) 0%, transparent 35%),
                radial-gradient(circle at 50% 60%, rgba(255, 215, 0, 0.6) 0%, transparent 40%),
                radial-gradient(ellipse at 30% 80%, rgba(218, 165, 32, 0.5) 0%, transparent 35%),
                linear-gradient(180deg, 
                    #FFD700 0%,
                    #FFC700 8%,
                    #FFB700 16%,
                    #FFA700 24%,
                    #FF9700 32%,
                    #F8B500 40%,
                    #F5C542 48%,
                    #F2D55E 56%,
                    #EFE57A 64%,
                    #DAA520 72%,
                    #B8860B 80%,
                    #996515 88%,
                    #7A5020 96%,
                    #5C3C1A 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        body.jewel-bg {
            background: 
                radial-gradient(ellipse at 15% 15%, rgba(255, 0, 255, 0.8) 0%, transparent 25%),
                radial-gradient(ellipse at 85% 20%, rgba(138, 43, 226, 0.8) 0%, transparent 30%),
                radial-gradient(circle at 50% 40%, rgba(218, 112, 214, 0.7) 0%, transparent 35%),
                radial-gradient(ellipse at 25% 70%, rgba(255, 105, 180, 0.7) 0%, transparent 30%),
                radial-gradient(circle at 75% 75%, rgba(186, 85, 211, 0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 50% 90%, rgba(147, 112, 219, 0.6) 0%, transparent 40%),
                linear-gradient(180deg, 
                    #FF00FF 0%,
                    #EE00EE 6%,
                    #DD00DD 12%,
                    #CC00CC 18%,
                    #BA55D3 24%,
                    #DA70D6 30%,
                    #EE82EE 36%,
                    #FF69B4 42%,
                    #FF1493 48%,
                    #DB7093 54%,
                    #C71585 60%,
                    #9932CC 66%,
                    #8B008B 72%,
                    #800080 78%,
                    #663399 84%,
                    #4B0082 90%,
                    #3A0066 96%,
                    #2A0050 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 15s ease infinite, jewelPulse 3s ease-in-out infinite;
        }
        
        @keyframes jewelPulse {
            0%, 100% { filter: brightness(1) saturate(1.2); }
            50% { filter: brightness(1.15) saturate(1.4); }
        }
        
        body.city-bg {
            background: 
                radial-gradient(ellipse at 50% 40%, rgba(255, 140, 80, 0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 30% 80%, rgba(140, 100, 200, 0.5) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 20%, rgba(180, 120, 220, 0.4) 0%, transparent 45%),
                linear-gradient(180deg, 
                    #ff9966 0%,
                    #f58855 8%,
                    #eb7744 16%,
                    #e16633 24%,
                    #d75522 32%,
                    #ba4a33 40%,
                    #9d3f44 48%,
                    #803455 56%,
                    #632966 64%,
                    #461e77 72%,
                    #2a1555 80%,
                    #1f1144 88%,
                    #140d33 96%,
                    #0a0922 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.lava-bg {
            background: 
                radial-gradient(ellipse at 40% 30%, rgba(255, 100, 0, 0.8) 0%, transparent 30%),
                radial-gradient(ellipse at 60% 70%, rgba(255, 50, 0, 0.7) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(255, 150, 50, 0.5) 0%, transparent 45%),
                linear-gradient(180deg, 
                    #ff6600 0%,
                    #ff5500 6%,
                    #ff4400 12%,
                    #ff3300 18%,
                    #ff2200 24%,
                    #ee1100 30%,
                    #cc1100 36%,
                    #aa0f00 42%,
                    #880d00 48%,
                    #660b00 54%,
                    #440900 60%,
                    #330700 66%,
                    #220500 72%,
                    #110300 78%,
                    #0a0200 84%,
                    #050100 90%,
                    #020100 96%,
                    #000000 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            animation: gradientShift 25s ease infinite;
        }
        
        body.aurora-bg {
            background: 
                radial-gradient(ellipse at 25% 25%, rgba(0, 255, 150, 0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 75% 55%, rgba(100, 50, 255, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 50% 35%, rgba(0, 200, 255, 0.5) 0%, transparent 45%),
                radial-gradient(ellipse at 40% 70%, rgba(255, 50, 200, 0.4) 0%, transparent 40%),
                linear-gradient(180deg, 
                    #0d1f3a 0%,
                    #0a1b33 10%,
                    #08172c 20%,
                    #061325 30%,
                    #050f1e 40%,
                    #030b17 50%,
                    #020710 60%,
                    #01050c 70%,
                    #010308 80%,
                    #000204 90%,
                    #000000 100%);
            background-size: 100% 100%;
        }
        
        /* ÂõûËª¢„Åô„ÇãÊòüÁ©∫ËÉåÊôØÔºàRank 100Ôºâ */
        body.cosmos-bg {
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(75, 0, 130, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 70% 60%, rgba(25, 25, 112, 0.3) 0%, transparent 50%),
                linear-gradient(180deg,
                    #000428 0%,
                    #001845 20%,
                    #003366 40%,
                    #004d88 60%,
                    #0066aa 80%,
                    #0080cc 100%);
            background-size: 100% 100%;
        }
        
        /* Âπæ‰ΩïÂ≠¶Ê®°ÊßòËÉåÊôØÔºàRank 200Ôºâ */
        body.matrix-bg {
            background:
                linear-gradient(45deg, transparent 48%, rgba(100, 200, 255, 0.1) 49%, rgba(100, 200, 255, 0.1) 51%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(100, 200, 255, 0.1) 49%, rgba(100, 200, 255, 0.1) 51%, transparent 52%),
                linear-gradient(180deg,
                    #0a0a1f 0%,
                    #0f0f2d 20%,
                    #14143b 40%,
                    #191949 60%,
                    #1e1e57 80%,
                    #232365 100%);
            background-size: 40px 40px, 40px 40px, 100% 100%;
            background-position: 0 0, 0 0, 0 0;
        }
        
        /* Ê≥¢Á¥ãËÉåÊôØÔºàRank 300Ôºâ */
        body.aqua-bg {
            background:
                radial-gradient(circle at 50% 50%, rgba(135, 206, 250, 0.2) 0%, transparent 30%),
                radial-gradient(circle at 30% 70%, rgba(100, 149, 237, 0.15) 0%, transparent 35%),
                radial-gradient(circle at 70% 30%, rgba(176, 224, 230, 0.15) 0%, transparent 35%),
                linear-gradient(180deg,
                    #001f3f 0%,
                    #003057 20%,
                    #00416f 40%,
                    #005287 60%,
                    #00639f 80%,
                    #0074b7 100%);
            background-size: 100% 100%;
        }
        
        /* „É°„Éà„É≠„Éù„É™„ÇπËÉåÊôØÔºàRank 400Ôºâ- „Çπ„ÇØ„É≠„Éº„É´„Åô„ÇãË°ó‰∏¶„Åø */
        body.metro-bg {
            background:
                linear-gradient(180deg,
                    #0a0e1a 0%,
                    #1a1f35 20%,
                    #2a2f45 40%,
                    #1f2438 60%,
                    #14182a 80%,
                    #0a0e1a 100%);
            background-size: 100% 100%;
        }
        
        /* „Éè„ÉÉ„Ç´„ÉºËÉåÊôØÔºàRank 500Ôºâ- „Çµ„Ç§„Éê„Éº„Çπ„Éö„Éº„Çπ */
        body.hacker-bg {
            background:
                linear-gradient(180deg,
                    #000000 0%,
                    #001100 20%,
                    #002200 40%,
                    #001100 60%,
                    #000000 80%,
                    #000000 100%);
            background-size: 100% 100%;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.12) 0%, transparent 35%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.12) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.08) 0%, transparent 45%),
                radial-gradient(circle at 40% 60%, rgba(236, 72, 153, 0.08) 0%, transparent 40%);
            animation: pulseGlow 10s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 0%, 0% 0%, 0% 50%; }
            50% { background-position: 0% 0%, 0% 0%, 100% 50%; }
        }
        
        @keyframes pulseGlow {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none; /* „Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà„Çí‰∏ã„ÅÆË¶ÅÁ¥†„Å´ÈÄöÈÅé„Åï„Åõ„Çã */
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Èõ™„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
        .snowflake {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: snowfall linear infinite;
        }
        
        @keyframes snowfall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100dvh) rotate(360deg);
                opacity: 0.3;
            }
        }
        
        /* Èõ™„ÅÆÁµêÊô∂„Ç®„Éï„Çß„ÇØ„Éà */
        .snowcrystal {
            position: absolute;
            width: 16px;
            height: 16px;
            color: #a0d8ff;
            font-size: 16px;
            opacity: 0.9;
            animation: crystalfall linear infinite;
            text-shadow: 0 0 5px rgba(160, 216, 255, 0.8);
        }
        
        @keyframes crystalfall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.9;
            }
            100% {
                transform: translateY(100dvh) rotate(360deg);
                opacity: 0.4;
            }
        }
        
        /* Èõ®„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
        .raindrop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, rgba(150, 200, 255, 0.8), rgba(100, 150, 255, 0.3));
            opacity: 0.7;
            animation: rainfall linear infinite;
        }
        
        @keyframes rainfall {
            0% {
                transform: translateY(-30px);
                opacity: 0.7;
            }
            100% {
                transform: translateY(100dvh);
                opacity: 0.3;
            }
        }
        
        /* ÊÅã„ÅÆ„Éè„Éº„Éà„Ç®„Éï„Çß„ÇØ„Éà */
        .heart {
            position: absolute;
            opacity: 0.85;
            animation: heartfall linear infinite;
        }
        
        .heart.pink-heart {
            color: #ff69b4;
            text-shadow: 0 0 8px rgba(255, 105, 180, 0.6);
        }
        
        .heart.red-heart {
            color: #ff1744;
            text-shadow: 0 0 8px rgba(255, 23, 68, 0.6);
        }
        
        @keyframes heartfall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.7;
            }
            50% {
                transform: translateY(50vh) rotate(180deg);
                opacity: 0.85;
            }
            100% {
                transform: translateY(100dvh) rotate(360deg);
                opacity: 0.3;
            }
        }
        
        /* Ê£Æ„ÅÆËëâ„Å£„Å±„Ç®„Éï„Çß„ÇØ„Éà */
        .leaf {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 0 100% 0 100%;
            opacity: 0.85;
            animation: leaffall linear infinite;
        }
        
        /* ÊøÉ„ÅÑÁ∑ë„ÅÆËëâ */
        .leaf.dark-green {
            background: linear-gradient(45deg, #2d5016, #1a3010);
        }
        
        /* ‰∏≠ÈñìËâ≤„ÅÆËëâ */
        .leaf.medium-green {
            background: linear-gradient(45deg, #4a7c2e, #2d5016);
        }
        
        /* Êòé„Çã„ÅÑÁ∑ë„ÅÆËëâ */
        .leaf.light-green {
            background: linear-gradient(45deg, #90EE90, #228B22);
        }
        
        /* Âú∞ÁêÉ„ÅÆÈùí„ÅÑËëâÔºàÊøÉ„ÅÑ„ÇÅÔºâ */
        .leaf.earth-blue {
            background: linear-gradient(45deg, #0088ff, #0055cc);
        }
        
        /* Âú∞ÁêÉ„ÅÆÁ∑ë„ÅÆËëâÔºàÊøÉ„ÅÑ„ÇÅÔºâ */
        .leaf.earth-green {
            background: linear-gradient(45deg, #33cc33, #118811);
        }
        
        /* Âú∞ÁêÉ„ÅÆÈùíÁ∑ë„ÅÆËëâÔºàÊøÉ„ÅÑ„ÇÅÔºâ */
        .leaf.earth-teal {
            background: linear-gradient(45deg, #00aa88, #008866);
        }
        
        @keyframes leaffall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.7;
            }
            50% {
                transform: translateY(50vh) rotate(180deg);
                opacity: 0.5;
            }
            100% {
                transform: translateY(100dvh) rotate(360deg);
                opacity: 0.2;
            }
        }
        
        /* Ê°ú„ÅÆËä±„Å≥„Çâ„Ç®„Éï„Çß„ÇØ„Éà */
        .petal {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50% 0 50% 0;
            opacity: 0.8;
            animation: petalfall linear infinite;
        }
        
        /* ÊøÉ„ÅÑ„Éî„É≥„ÇØ„ÅÆËä±„Å≥„Çâ ‚Üí Ê°ú„ÅÆËëâ„Å£„Å±„ÅÆÁ∑ë */
        .petal.dark-pink {
            background: linear-gradient(45deg, #88cc88, #5a9e5a);
        }
        
        /* ‰∏≠ÈñìËâ≤„ÅÆËä±„Å≥„Çâ */
        .petal.medium-pink {
            background: linear-gradient(45deg, #ffb3d9, #ff85c1);
        }
        
        /* ÁôΩ„Å£„ÅΩ„ÅÑËä±„Å≥„Çâ */
        .petal.light-pink {
            background: linear-gradient(45deg, #ffe4f0, #ffc0e0);
        }
        
        @keyframes petalfall {
            0% {
                transform: translateY(-10px) rotate(0deg) translateX(0);
                opacity: 0.8;
            }
            50% {
                transform: translateY(50vh) rotate(180deg) translateX(30px);
                opacity: 0.6;
            }
            100% {
                transform: translateY(100dvh) rotate(360deg) translateX(0);
                opacity: 0.2;
            }
        }
        
        /* „Éû„Éç„Éº„ÅÆüí∞ü™ô„Ç®„Éï„Çß„ÇØ„Éà */
        .money-coin {
            position: absolute;
            font-size: 24px;
            opacity: 1;
            animation: moneyfall linear infinite;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
        }
        
        @keyframes moneyfall {
            0% {
                transform: translateY(-30px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100dvh) rotate(720deg);
                opacity: 0.6;
            }
        }
        
        /* „Ç∏„É•„Ç®„É´„ÅÆÂÆùÁü≥„Ç®„Éï„Çß„ÇØ„Éà */
        .jewel-gem {
            position: absolute;
            font-size: 20px;
            opacity: 0.9;
            animation: jewelfall linear infinite;
            filter: drop-shadow(0 0 10px rgba(255, 0, 255, 0.9));
        }
        
        @keyframes jewelfall {
            0% {
                transform: translateY(-20px) rotate(0deg) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) rotate(180deg) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translateY(100dvh) rotate(360deg) scale(0.8);
                opacity: 0.5;
            }
        }
        
        /* „Ç∏„É•„Ç®„É´„ÅÆ„Ç≠„É©„Ç≠„É©„Ç®„Éï„Çß„ÇØ„Éà */
        .jewel-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #fff, transparent);
            border-radius: 50%;
            opacity: 0;
            animation: jewelSparkle 2s infinite;
        }
        
        @keyframes jewelSparkle {
            0%, 100% { 
                opacity: 0;
                transform: scale(0.5);
            }
            50% { 
                opacity: 1;
                transform: scale(1.5);
                box-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
            }
        }
        
        /* ÈÉΩ‰ºö„ÅÆÂÖâ„Ç®„Éï„Çß„ÇØ„Éà */
        .city-light {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 200, 100, 0.8);
            border-radius: 50%;
            animation: cityTwinkle 2s infinite;
            box-shadow: 0 0 10px rgba(255, 200, 100, 0.6);
        }
        
        @keyframes cityTwinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Ê∫∂Â≤©„ÅÆÁÅ´Ëä±„Ç®„Éï„Çß„ÇØ„Éà */
        .spark {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #ffcc00, #ff3300);
            border-radius: 50%;
            opacity: 0.9;
            box-shadow: 0 0 10px #ff6600;
            animation: sparkRise linear infinite;
        }
        
        @keyframes sparkRise {
            0% {
                transform: translateY(100dvh) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) scale(0.7);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-50px) scale(0.3);
                opacity: 0;
            }
        }
        
        /* Ê∫∂Â≤©„ÅÆÈªí„ÅÑÁÖô„ÉªÁÅ∞„Ç®„Éï„Çß„ÇØ„Éà */
        .lava-smoke {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(50, 50, 50, 0.7), transparent);
            border-radius: 50%;
            opacity: 0.6;
            animation: smokeRise linear infinite;
        }
        
        @keyframes smokeRise {
            0% {
                transform: translateY(100dvh) scale(0.5);
                opacity: 0.8;
            }
            50% {
                transform: translateY(50vh) scale(1.5);
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100px) scale(2.5);
                opacity: 0;
            }
        }
        
        /* Ê∫∂Â≤©„ÅÆÂ°ä„Ç®„Éï„Çß„ÇØ„Éà */
        .lava-chunk {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ff4400, #330000);
            border-radius: 40% 60% 50% 50%;
            opacity: 0.9;
            animation: chunkRise linear infinite;
        }
        
        @keyframes chunkRise {
            0% {
                transform: translateY(100dvh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-80px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* „Ç™„Éº„É≠„É©„ÅÆÂÖâ„Ç®„Éï„Çß„ÇØ„Éà */
        .aurora-wave {
            position: absolute;
            width: 180px;
            height: 100%;
            background: linear-gradient(180deg, 
                transparent 0%,
                rgba(0, 255, 150, 0.5) 15%,
                rgba(0, 200, 255, 0.6) 30%,
                rgba(100, 50, 255, 0.6) 45%,
                rgba(255, 50, 200, 0.5) 60%,
                rgba(0, 255, 180, 0.5) 75%,
                rgba(50, 150, 255, 0.4) 85%,
                transparent 100%);
            opacity: 0.5;
            filter: blur(35px);
            animation: auroraGlow 12s ease-in-out infinite;
        }
        
        @keyframes auroraGlow {
            0%, 100% {
                opacity: 0.3;
                transform: scaleX(0.9) scaleY(1);
            }
            33% {
                opacity: 0.7;
                transform: scaleX(1.3) scaleY(1.05);
            }
            66% {
                opacity: 0.5;
                transform: scaleX(1.1) scaleY(0.95);
            }
        }
        
        /* Êµ∑„ÅÆÊ≥°„Ç®„Éï„Çß„ÇØ„Éà */
        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(100, 200, 255, 0.3));
            border-radius: 50%;
            animation: bubbleRise linear infinite;
        }
        
        /* Âú∞ÁêÉ„ÅÆÊ≥°ÔºàÈùíÁ∑ëÁ≥ªÔºâ */
        .bubble.earth-bubble {
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7), rgba(50, 200, 150, 0.4));
        }
        
        /* „Éà„Ç§„É¨„ÅÆÊ≥°ÔºàËå∂Ëâ≤Á≥ªÔºâ */
        .bubble.toilet-bubble {
            background: radial-gradient(circle at 30% 30%, rgba(255, 240, 200, 0.6), rgba(139, 90, 43, 0.5));
        }
        
        @keyframes bubbleRise {
            0% {
                transform: translateY(100dvh) scale(0.5);
                opacity: 0;
            }
            50% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-50px) scale(1);
                opacity: 0;
            }
        }
        
        /* Ê∫ÄÊúà„ÅÆÊúàÂÖâ„Ç®„Éï„Çß„ÇØ„Éà */
        .moonbeam {
            position: absolute;
            width: 2px;
            height: 30px;
            background: linear-gradient(to bottom, rgba(255, 255, 200, 0.5), transparent);
            animation: moonbeamFall linear infinite;
        }
        
        @keyframes moonbeamFall {
            0% {
                transform: translateY(-50px);
                opacity: 0;
            }
            50% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(100dvh);
                opacity: 0;
            }
        }
        
        /* Ëôπ„ÅÆÂÖâ„ÅÆÁ≤íÂ≠ê„Ç®„Éï„Çß„ÇØ„Éà */
        .rainbow-particle {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            opacity: 0.8;
            animation: rainbowFloat linear infinite;
        }
        
        @keyframes rainbowFloat {
            0% {
                transform: translateY(-20px) translateX(0) scale(0.5);
                opacity: 0;
            }
            20% {
                opacity: 0.8;
            }
            80% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(100dvh) translateX(50px) scale(1.2);
                opacity: 0;
            }
        }
        
        /* Ëôπ„ÅÆ„Ç≠„É©„Ç≠„É©„Ç®„Éï„Çß„ÇØ„Éà */
        .rainbow-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: rainbowTwinkle 3s infinite;
        }
        
        @keyframes rainbowTwinkle {
            0%, 100% { 
                opacity: 0.3;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.5);
            }
        }
        
        /* ÂõûËª¢„Åô„ÇãÊòüÁ©∫„Ç®„Éï„Çß„ÇØ„Éà */
        .rotating-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            animation: rotateStar 30s linear infinite;
        }
        
        @keyframes rotateStar {
            0% {
                transform: rotate(0deg) translateX(var(--radius)) rotate(0deg);
                opacity: 0.3;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: rotate(360deg) translateX(var(--radius)) rotate(-360deg);
                opacity: 0.3;
            }
        }
        
        /* Âπæ‰ΩïÂ≠¶Ê®°Êßò„Ç®„Éï„Çß„ÇØ„Éà */
        .geo-shape {
            position: absolute;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: geoFloat 15s ease-in-out infinite;
        }
        
        @keyframes geoFloat {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 0.4;
            }
            25% {
                transform: translate(30px, -30px) rotate(90deg);
                opacity: 0.7;
            }
            50% {
                transform: translate(0, -60px) rotate(180deg);
                opacity: 0.4;
            }
            75% {
                transform: translate(-30px, -30px) rotate(270deg);
                opacity: 0.7;
            }
        }
        
        /* Ê≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà */
        .ripple {
            position: absolute;
            border: 2px solid rgba(135, 206, 250, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: rippleExpand 1.5s ease-out forwards;
        }
        
        @keyframes rippleExpand {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 300px;
                height: 300px;
                opacity: 0;
            }
        }
        
        /* „Çπ„ÇØ„É≠„Éº„É´„Åô„ÇãË°ó‰∏¶„Åø„Ç®„Éï„Çß„ÇØ„Éà */
        .city-building {
            position: absolute;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.6));
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .city-building.scroll-1 {
            animation: cityScroll1 30s linear infinite;
        }
        
        .city-building.scroll-2 {
            animation: cityScroll2 30s linear infinite;
        }
        
        @keyframes cityScroll1 {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-200vw);
            }
        }
        
        @keyframes cityScroll2 {
            0% {
                transform: translateX(100vw);
            }
            100% {
                transform: translateX(-100vw);
            }
        }
        
        /* „Çµ„Ç§„Éê„Éº„Çπ„Éö„Éº„Çπ„ÅÆ„Ç≥„Éº„ÉâÊñáÂ≠ó */
        .cyber-code {
            position: absolute;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
            opacity: 0.8;
            white-space: nowrap;
            animation: codeRain 8s linear infinite;
        }
        
        @keyframes codeRain {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }
        
        /* ========== Top HUD ========== */
        #top-ui {
            position: absolute;
            top: 60px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: clamp(10px, 3vw, 16px);
            z-index: 20;
            pointer-events: none;
        }

        #hud-right {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            pointer-events: none;
            z-index: 20;
        }

        #title-display {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #FFD700;
            font-size: clamp(14px, 3.5vw, 20px);
            font-weight: 700;
            background: rgba(0, 0, 0, 0.7);
            padding: clamp(6px, 1.5vw, 10px) clamp(12px, 3vw, 20px);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            z-index: 25;
            border: 2px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            cursor: pointer;
            max-width: 48vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s;
        }
        
        #title-display:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }
        
        #title-text {
            cursor: pointer;
        }
        
        #username-display {
            position: relative;
            color: #FFD700;
            font-size: clamp(18px, 4.5vw, 28px);
            font-weight: 900;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(40, 40, 40, 0.95) 100%);
            padding: clamp(10px, 2.2vw, 16px) clamp(16px, 3.8vw, 28px);
            border-radius: 25px;
            backdrop-filter: blur(20px);
            text-shadow: 
                0 0 15px rgba(255, 215, 0, 1),
                0 0 30px rgba(255, 215, 0, 0.5),
                0 3px 8px rgba(0, 0, 0, 0.8);
            z-index: 20;
            border: 3px solid #FFD700;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.6),
                0 8px 30px rgba(0, 0, 0, 0.4),
                inset 0 2px 10px rgba(255, 215, 0, 0.15);
            letter-spacing: 2px;
            font-family: 'Arial Black', 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
            max-width: 48vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            pointer-events: auto;
        }
        
        #username-display:hover {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(50, 50, 50, 1) 100%);
            transform: scale(1.05);
            box-shadow: 
                0 0 40px rgba(255, 215, 0, 0.8),
                0 10px 35px rgba(0, 0, 0, 0.5),
                inset 0 2px 15px rgba(255, 215, 0, 0.2);
        }
        
        #username-text {
            cursor: pointer;
        }
        
        #settings-btn {
            position: fixed;
            top: 110px;
            left: 20px;
            background: transparent;
            border: none;
            width: 50px;
            height: 50px;
            font-size: 32px;
            cursor: pointer;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            pointer-events: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }
        
        #settings-btn:hover {
            transform: scale(1.2) rotate(45deg);
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
        }
        
        #settings-btn:active {
            transform: scale(1.0) rotate(90deg);
        }
        
        #rank-box {
            position: relative;
            color: #FFD700;
            font-size: clamp(18px, 4.5vw, 28px);
            font-weight: 900;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(40, 40, 40, 0.95) 100%);
            padding: clamp(10px, 2.2vw, 16px) clamp(16px, 3.8vw, 28px);
            border-radius: 25px;
            backdrop-filter: blur(20px);
            text-shadow: 
                0 0 15px rgba(255, 215, 0, 1),
                0 0 30px rgba(255, 215, 0, 0.5),
                0 3px 8px rgba(0, 0, 0, 0.8);
            border: 3px solid #FFD700;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.6),
                0 8px 30px rgba(0, 0, 0, 0.4),
                inset 0 2px 10px rgba(255, 215, 0, 0.15);
            letter-spacing: 2px;
            font-family: 'Arial Black', 'M PLUS Rounded 1c', sans-serif;
            transition: all 0.3s ease;
            pointer-events: auto;
            max-width: 48vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #rank-box:hover {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(50, 50, 50, 1) 100%);
            transform: scale(1.05);
            box-shadow: 
                0 0 40px rgba(255, 215, 0, 0.8),
                0 10px 35px rgba(0, 0, 0, 0.5),
                inset 0 2px 15px rgba(255, 215, 0, 0.2);
        }

        #rank-display {
            color: #FFD700;
        }

        #currency-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
        }

        #diamond-counter {
            position: relative;
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 14px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }
        
        #star-counter {
            position: relative;
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 14px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }
        
        #character-area {
            position: relative;
            height: 45vh;
            max-height: calc(100vh - 350px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            padding-top: 5vh;
        }
        
        #character {
            font-size: 180px;
            cursor: pointer;
            transition: transform 0.1s ease;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.3));
            animation: float 3s ease-in-out infinite;
            z-index: 5;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        #character.jumping {
            animation: jump 0.6s ease;
        }
        
        @keyframes jump {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-50px); }
        }
        
        .collectible-star {
            position: absolute;
            font-size: 40px;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            /* È£æ„Çä„Çà„ÇäÂøÖ„Åö‰∏ä„Å´Âá∫„Åô */
            z-index: 100;
            animation: starFloat 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
            touch-action: manipulation;
        }
        
        @keyframes starFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .collectible-star.collected {
            animation: starCollect 0.5s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes starCollect {
            0% { 
                transform: scale(1);
                opacity: 1;
            }
            100% { 
                transform: scale(2) translateY(-50px);
                opacity: 0;
            }
        }
        
        /* „Éú„Éº„Éä„ÇπÊúà */
        .bonus-moon {
            position: absolute;
            font-size: 60px;
            cursor: pointer;
            z-index: 100;
            animation: moonSlide 8s linear;
            filter: drop-shadow(0 0 15px rgba(255, 255, 150, 0.8));
            transition: transform 0.2s ease;
            user-select: none;
        }
        
        /* „Éú„Éº„Éä„Çπ„ÇÆ„Éï„Éà */
        .bonus-gift {
            position: absolute;
            font-size: 50px;
            cursor: pointer;
            z-index: 100;
            animation: giftSlide 10s linear;
            filter: drop-shadow(0 0 20px rgba(255, 100, 200, 0.9));
            transition: transform 0.2s ease;
            user-select: none;
        }
        
        @keyframes moonSlide {
            0% {
                left: -100px;
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                left: calc(100% + 100px);
                opacity: 0;
            }
        }
        
        @keyframes giftSlide {
            0% {
                left: -100px;
                opacity: 0;
                transform: rotate(0deg);
            }
            5% {
                opacity: 1;
            }
            50% {
                transform: rotate(360deg);
            }
            95% {
                opacity: 1;
            }
            100% {
                left: calc(100% + 100px);
                opacity: 0;
                transform: rotate(720deg);
            }
        }
        
        .bonus-moon.collected {
            animation: moonCollect 0.5s ease-out forwards;
            pointer-events: none;
        }
        
        .bonus-gift.collected {
            animation: giftCollect 0.6s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes moonCollect {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            100% { 
                transform: scale(3) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes giftCollect {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(2.5) rotate(180deg);
            }
            100% { 
                transform: scale(4) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* È£æ„Çä„Ç®„É™„Ç¢ */
        #placement-area {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            pointer-events: none;
            /* „Ç≤„Éº„É†ÂÜÖ„Ç®„Éï„Çß„ÇØ„Éà„Çà„Çä‰∏ã„ÄÅUI„Çà„Çä‰∏ä„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´ */
            z-index: 8;
        }
        
        .placeable-decor {
            position: absolute;
            font-size: 80px;
            filter: drop-shadow(0 0 14px rgba(255,255,255,0.18));
            opacity: 1;
            cursor: move;
            pointer-events: auto;
            user-select: none;
            touch-action: none;
            transition: transform 0.1s ease;
            /* Êòü(collectible-star)„Çà„Çä‰∏ã */
            z-index: 10;
            /* üåö„Å®ÂÆåÂÖ®„Å´Âêå„Åò„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
            animation: float 3s ease-in-out infinite;
        }
        
        .placeable-decor.dragging {
            transform: scale(1.2);
            filter: drop-shadow(0 0 20px rgba(255,215,0,0.5));
            /* „Éâ„É©„ÉÉ„Ç∞‰∏≠„Åß„ÇÇÊòü„Çà„Çä‰∏ä„Å´Êù•„Å™„ÅÑ */
            z-index: 15;
            /* „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÂÅúÊ≠¢ */
            animation: none;
            pointer-events: auto;
        }
        
        .decor-slots-ui {
            display: flex;
            gap: 10px;
            margin: 10px 0 12px;
            flex-wrap: wrap;
        }
        
        .decor-slot-btn {
            padding: 10px 12px;
            border-radius: 14px;
            border: 2px solid rgba(255,215,0,0.5);
            background: rgba(0,0,0,0.28);
            color: #fff;
            font-size: 16px;
            min-width: 100px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
        }
        
        .decor-slot-btn.active {
            border-color: rgba(255,215,0,0.9);
            box-shadow: 0 0 18px rgba(255,215,0,0.35);
            transform: scale(1.05);
            background: rgba(255,215,0,0.15);
        }
        
        .decor-slot-btn:hover {
            border-color: rgba(255,215,0,0.7);
            transform: scale(1.03);
        }
        
        .decor-items-ui {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .decor-item-btn {
            padding: 10px 12px;
            border-radius: 14px;
            border: 2px solid rgba(255,255,255,0.22);
            background: rgba(255,255,255,0.08);
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .decor-item-btn:hover {
            transform: scale(1.15);
            border-color: rgba(255,215,0,0.5);
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
        }
        
        .decor-item-btn:active {
            transform: scale(0.95);
        }
        
        .small-note {
            opacity: 0.7;
            font-size: 12px;
            margin-top: 8px;
        }
        
        #speech-bubble {
            position: absolute;
            top: 90%;
            bottom: auto;

            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 18px 22px;
            border-radius: 20px;
            min-width: 220px;
            width: min(320px, 86%);
            max-width: 320px;
            opacity: 0;
            transition: opacity 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 15;
            line-height: 1.6;
            text-align: center;
            white-space: normal;
            overflow-wrap: anywhere;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        #speech-bubble::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -15px;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 15px 15px 15px;
            border-color: transparent transparent white transparent;
        }
        
        #speech-bubble.show {
            opacity: 1;
        }
        
        #speech-text {
            color: #333;
            font-size: 16px;
            line-height: 1.6;
        }
        
        #interaction-area {
            position: fixed;
            bottom: 80px;
            left: 0;
            right: 0;
            width: 100%;
            padding: 20px;
            padding-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            box-sizing: border-box;
            z-index: 100;
        }
        
        @media (max-width: 768px) {
            #interaction-area {
                bottom: 100px;
            }
        }
        
        /* „Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó„Ç∑„Çπ„ÉÜ„É† */
        #skill-system {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .skill-title {
            display: none;
        }
        
        .skill-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .skill-button {
    background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.85) 0%,
        rgba(40, 40, 40, 0.95) 100%
    );
    border: 2px solid rgba(255, 215, 0, 0.55);
    border-radius: 14px;
    padding: 14px 8px;
    color: #fff;
    cursor: pointer;
    transition: all 0.25s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-weight: 700;
    backdrop-filter: blur(12px);
    box-shadow:
        0 0 18px rgba(255, 215, 0, 0.25),
        0 4px 14px rgba(0, 0, 0, 0.35),
        inset 0 1px 6px rgba(255, 215, 0, 0.12);
}
        
        .skill-button:hover {
    transform: scale(1.05);
    border-color: rgba(255, 215, 0, 0.85);
    box-shadow:
        0 0 28px rgba(255, 215, 0, 0.55),
        0 6px 18px rgba(0, 0, 0, 0.45),
        inset 0 1px 10px rgba(255, 215, 0, 0.2);
}
        
        .skill-button:active {
    transform: scale(0.95);
}
        
        .skill-button.max-level {
    background: linear-gradient(
        135deg,
        rgba(255, 215, 0, 0.85) 0%,
        rgba(255, 165, 0, 0.95) 100%
    );
    color: #000;
    border-color: #FFD700;
    box-shadow:
        0 0 35px rgba(255, 215, 0, 0.9),
        0 6px 20px rgba(0, 0, 0, 0.4),
        inset 0 2px 12px rgba(255, 255, 255, 0.35);
}
        
        .skill-name {
    font-size: 13px;
    font-weight: 800;
    text-align: center;
    line-height: 1.25;
    letter-spacing: 0.5px;
}
        
        .skill-level {
    font-size: 11px;
    opacity: 0.85;
}
        
        
        #button-grid {
            display: grid;
            grid-template-columns: 1fr 0.65fr 1fr;
            gap: 10px;
        }
        
        .action-button {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            text-align: center;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .action-button:active {
            transform: scale(0.95);
        }
        
        .action-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        
        .action-button.mini {
            padding: 12px;
            font-size: 22px;
        }
#pixiv-btn {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(40, 40, 60, 0.95) 100%);
            border: 2px solid #667eea;
            box-shadow: 
                0 0 20px rgba(102, 126, 234, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 8px rgba(102, 126, 234, 0.15);
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.8);
        }
        
        #pixiv-btn:hover {
            box-shadow: 
                0 0 30px rgba(102, 126, 234, 0.6),
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 10px rgba(102, 126, 234, 0.25);
            border-color: #8099ff;
        }
        
        #mission-btn {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(40, 60, 60, 0.95) 100%);
            border: 2px solid #43e97b;
            box-shadow: 
                0 0 20px rgba(67, 233, 123, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 8px rgba(67, 233, 123, 0.15);
            text-shadow: 0 0 10px rgba(67, 233, 123, 0.8);
        }
        
        #mission-btn:hover {
            box-shadow: 
                0 0 30px rgba(67, 233, 123, 0.6),
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 10px rgba(67, 233, 123, 0.25);
            border-color: #5fffb0;
        }
        
        #gacha-btn {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(60, 40, 60, 0.95) 100%);
            border: 2px solid #f093fb;
            box-shadow: 
                0 0 20px rgba(240, 147, 251, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 8px rgba(240, 147, 251, 0.15);
            text-shadow: 0 0 10px rgba(240, 147, 251, 0.8);
        }
        
        #gacha-btn:hover {
            box-shadow: 
                0 0 30px rgba(240, 147, 251, 0.6),
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 10px rgba(240, 147, 251, 0.25);
            border-color: #ffb3ff;
        }
        
        #closet-btn {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(40, 50, 60, 0.95) 100%);
            border: 2px solid #4facfe;
            box-shadow: 
                0 0 20px rgba(79, 172, 254, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 8px rgba(79, 172, 254, 0.15);
            text-shadow: 0 0 10px rgba(79, 172, 254, 0.8);
        }
        
        #closet-btn:hover {
            box-shadow: 
                0 0 30px rgba(79, 172, 254, 0.6),
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 10px rgba(79, 172, 254, 0.25);
            border-color: #70d0ff;
        }
        
        #shop-btn {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(60, 50, 40, 0.95) 100%);
            border: 2px solid #FFD700;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 8px rgba(255, 215, 0, 0.15);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        #shop-btn:hover {
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.6),
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 10px rgba(255, 215, 0, 0.25);
            border-color: #FFA500;
        }
        
        #collect-all-btn {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(50, 40, 60, 0.95) 100%);
            border: 2px solid #FFA500;
            box-shadow: 
                0 0 20px rgba(255, 165, 0, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 8px rgba(255, 165, 0, 0.15);
            text-shadow: 0 0 10px rgba(255, 165, 0, 0.8);
        }
        
        #collect-all-btn:hover {
            box-shadow: 
                0 0 30px rgba(255, 165, 0, 0.6),
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 10px rgba(255, 165, 0, 0.25);
            border-color: #FFD700;
        }
        
        /* „É©„É≥„ÇØÁâπÂÖ∏„É¢„Éº„ÉÄ„É´ */
        #rank-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }
        
        #rank-modal.show {
            display: flex;
        }
        
        #rank-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid #FFD700;
        }
        
        #rank-modal-title {
            color: #FFD700;
            font-size: 28px;
            font-weight: 900;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        .reward-section {
            margin: 20px 0;
        }
        
        .reward-title {
            color: #fff;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .reward-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .reward-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .reward-item:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
            transform: scale(1.05);
        }
        
        .reward-item.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .reward-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .reward-item.locked:hover {
            transform: none;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .reward-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .reward-name {
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .reward-unlock {
            color: #FFD700;
            font-size: 12px;
        }
        
        .reward-locked {
            color: #999;
            font-size: 12px;
        }
        
        #close-modal-btn {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: none;
            border-radius: 15px;
            color: #000;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #close-modal-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }
        
        /* ÊîæÁΩÆÂ†±ÈÖ¨„É¢„Éº„ÉÄ„É´ */
        #idle-reward-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        #idle-reward-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
        }
        
        #idle-reward-title {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        #idle-reward-message {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        #idle-time-display {
            font-size: 20px;
            color: #fff;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        #idle-reward-amount {
            font-size: 40px;
            color: #FFD700;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        
        #claim-idle-reward-btn {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            font-size: 20px;
            font-weight: bold;
            padding: 15px 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            width: auto;
            display: inline-block;
            margin: 0 auto;
        }
        
        #claim-idle-reward-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }
        
        #claim-idle-reward-btn:active {
            transform: translateY(0);
        }
        
        /* Áß∞Âè∑„É¢„Éº„ÉÄ„É´ */
        #title-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        #title-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
        }
        
        #title-modal-title {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        #title-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .title-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .title-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .title-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .title-item.locked:hover {
            transform: none;
            box-shadow: none;
        }
        
        .title-item.equipped {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .title-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .title-condition {
            font-size: 12px;
            color: #ccc;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .title-status {
            font-size: 11px;
            text-align: center;
            color: #FFD700;
        }
        
        #close-title-modal-btn {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            font-size: 18px;
            font-weight: bold;
            padding: 12px 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
        }
        
        #close-title-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        /* Êû†Ëâ≤„ÇØ„É©„Çπ */
        .border-yellow { border-color: #FFD700 !important; box-shadow: 0 0 30px rgba(255, 215, 0, 0.6) !important; }
        .border-pink { border-color: #FFB3D9 !important; box-shadow: 0 0 30px rgba(255, 179, 217, 0.6) !important; }
        .border-green { border-color: #90EE90 !important; box-shadow: 0 0 30px rgba(144, 238, 144, 0.6) !important; }
        .border-blue { border-color: #4169E1 !important; box-shadow: 0 0 30px rgba(65, 105, 225, 0.6) !important; }
        .border-purple { border-color: #9370DB !important; box-shadow: 0 0 30px rgba(147, 112, 219, 0.6) !important; }
        .border-gold { border-color: #FFD700 !important; box-shadow: 0 0 40px rgba(255, 215, 0, 0.8) !important; }
        .border-rainbow {
            border: 2px solid;
            border-image: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1;
            animation: rainbow-glow 3s linear infinite;
        }
        
        @keyframes rainbow-glow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 0, 0, 0.6); }
            14% { box-shadow: 0 0 30px rgba(255, 127, 0, 0.6); }
            28% { box-shadow: 0 0 30px rgba(255, 255, 0, 0.6); }
            42% { box-shadow: 0 0 30px rgba(0, 255, 0, 0.6); }
            57% { box-shadow: 0 0 30px rgba(0, 0, 255, 0.6); }
            71% { box-shadow: 0 0 30px rgba(75, 0, 130, 0.6); }
            85% { box-shadow: 0 0 30px rgba(148, 0, 211, 0.6); }
        }
        
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }
        
        #title-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
        }
        
        #title-modal-title {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        #title-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .title-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .title-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .title-item.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .title-item.equipped {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .title-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .title-condition {
            font-size: 12px;
            color: #aaa;
        }
        
        .title-progress {
            font-size: 12px;
            color: #FFD700;
            margin-top: 5px;
        }
        
        #close-title-modal-btn {
            width: 100%;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            font-size: 18px;
            font-weight: bold;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #close-title-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        /* „Ç¨„ÉÅ„É£„É¢„Éº„ÉÄ„É´ */
        #gacha-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }
        
        #gacha-modal.show {
            display: flex;
        }
        
        #gacha-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 90%;
            /* „Çπ„Éû„Éõ„ÅßÂÖ®‰Ωì„ÅåË¶ã„Åà„Çã„Çà„ÅÜ„Å´Ë™øÊï¥ */
            max-height: 80vh;
            text-align: center;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid #f093fb;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-bottom: calc(30px + env(safe-area-inset-bottom));
        }

        @media (max-width: 480px) {
            #gacha-content {
                padding: 20px;
                padding-bottom: calc(20px + env(safe-area-inset-bottom));
                max-height: 85vh;
            }
            #gacha-title { font-size: 26px; margin-bottom: 15px; }
            .gacha-type-btn { 
                padding: 15px; 
                font-size: 16px;
            }
            #gacha-result { min-height: 100px; }
            .gacha-result-icon { font-size: 80px; margin: 15px 0; }
            .gacha-result-text { font-size: 22px !important; }
            .gacha-result-type { font-size: 14px !important; }
            .gacha-rarity { font-size: 14px !important; padding: 6px 12px !important; }
            #close-gacha-btn { padding: 12px; font-size: 16px; }
        }
        
        #gacha-title {
            color: #f093fb;
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(240, 147, 251, 0.8);
        }
        
        #gacha-cost {
            color: #fff;
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .gacha-type-btn {
            flex: 1;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .gacha-type-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 30px rgba(240, 147, 251, 0.6);
        }
        
        .gacha-type-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #gacha-pull-btn {
            padding: 20px 40px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 24px;
            font-weight: 900;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        #gacha-pull-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 30px rgba(240, 147, 251, 0.6);
        }
        
        #gacha-pull-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #gacha-result {
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* ÁµêÊûú„ÅåË¶ã„Åà„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´ */
            flex: 0 1 auto;
            margin-bottom: 10px;
        }
        
        .gacha-result-icon {
            font-size: 100px;
            margin: 20px 0;
            animation: gachaAppear 0.5s ease;
        }
        
        @keyframes gachaAppear {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        .falling-item {
            position: absolute;
            top: -50px;
            animation: itemFall linear infinite;
            pointer-events: none;
            opacity: 0.9;
        }
        
        @keyframes itemFall {
            0% {
                top: -50px;
                transform: translateX(0) rotate(0deg);
            }
            100% {
                top: 110%;
                transform: translateX(30px) rotate(360deg);
            }
        }
        
        .rising-item {
            position: absolute;
            bottom: -50px;
            animation: itemRise linear infinite;
            pointer-events: none;
            opacity: 0.9;
        }
        
        @keyframes itemRise {
            0% {
                bottom: -50px;
                transform: translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.9;
            }
            90% {
                opacity: 0.9;
            }
            100% {
                bottom: 110%;
                transform: translateX(-20px) rotate(-360deg);
                opacity: 0;
            }
        }
        
        .gacha-result-text {
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .gacha-result-meta {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }
        
        .gacha-result-type {
            color: #ffd700;
            font-size: 16px;
            font-weight: 600;
            opacity: 0.9;
        }
        
        .gacha-rarity {
            font-size: 18px;
            font-weight: 900;
            padding: 8px 20px;
            border-radius: 15px;
        }
        
        .rarity-common {
            background: linear-gradient(135deg, #808080 0%, #606060 100%);
            color: white;
        }
        
        .rarity-rare {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .rarity-sr {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .rarity-ssr {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        #close-gacha-btn {
            margin-top: 20px;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            flex: 0 0 auto;
        }
        
        /* ÁùÄ„ÅõÊõø„Åà„É¢„Éº„ÉÄ„É´ */
        #closet-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }
        
        #closet-modal.show {
            display: flex;
        }
        
        #closet-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid #4facfe;
        }
        
        #closet-title {
            color: #4facfe;
            font-size: 28px;
            font-weight: 900;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(79, 172, 254, 0.8);
        }
        
        #close-closet-btn {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
        }
        
        /* „É¶„Éº„Ç∂„Éº„Éç„Éº„É†ÂÖ•Âäõ„É¢„Éº„ÉÄ„É´ */
        #username-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }
        
        #username-modal.show {
            display: flex;
        }
        
        #username-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid #4facfe;
            text-align: center;
        }
        
        #username-modal-title {
            color: #4facfe;
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(79, 172, 254, 0.8);
        }
        
        #username-input {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            border: 2px solid #4facfe;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            margin-bottom: 10px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        
        #username-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        #username-char-count {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        #username-save-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        #username-save-btn:hover {
            transform: scale(1.05);
        }
        
        #username-cancel-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }
        
        /* „Éü„ÉÉ„Ç∑„Éß„É≥„É¢„Éº„ÉÄ„É´ */
        #mission-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        #mission-modal.show {
            display: flex;
        }
        
        #mission-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        #mission-modal-title {
            font-size: 28px;
            font-weight: 900;
            text-align: center;
            margin-bottom: 20px;
            color: white;
        }
        
        #mission-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mission-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            color: white;
        }
        
        .mission-item.completed {
            background: rgba(100, 255, 100, 0.3);
        }
        
        .mission-item.daily {
            background: linear-gradient(135deg, rgba(255, 200, 100, 0.4) 0%, rgba(255, 150, 50, 0.4) 100%);
            border: 2px solid rgba(255, 200, 100, 0.6);
        }
        
        .mission-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .mission-progress {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .mission-reward {
            font-size: 16px;
            font-weight: 700;
            color: #ffeb3b;
        }
        
        .mission-claim-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .mission-claim-btn:disabled {
            background: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }
        
        #close-mission-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
        }
        
        /* Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ */
        #settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }
        
        #settings-modal.show {
            display: flex;
        }
        
        #settings-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid #FFD700;
        }
        
        @media (max-width: 480px) {
            #settings-modal-content {
                padding: 20px;
                width: 95%;
            }
        }
        
        #settings-modal-title {
            color: #FFD700;
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            text-align: center;
        }
        
        .settings-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-sizing: border-box;
            max-width: 100%;
        }
        
        .settings-section-title {
            color: #4facfe;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .volume-control label {
            color: white;
            min-width: 80px;
            font-size: 16px;
        }
        
        .volume-control input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFD700;
            cursor: pointer;
        }
        
        .volume-control span {
            color: #FFD700;
            min-width: 40px;
            text-align: right;
            font-weight: 700;
        }
        
        .save-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .save-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #export-save-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        #import-save-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        #save-textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        .save-note {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .serial-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            width: 100%;
        }
        
        #serial-input {
            flex: 1;
            min-width: 0;
            max-width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            box-sizing: border-box;
        }
        
        #serial-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        #serial-input:focus {
            outline: none;
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        #serial-submit-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        #serial-submit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        #serial-submit-btn:active {
            transform: scale(0.95);
        }
        
        #serial-message {
            color: #FFD700;
            font-size: 13px;
            min-height: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        #serial-message.success {
            color: #43e97b;
        }
        
        #serial-message.error {
            color: #f5576c;
        }
        
        #close-settings-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* „Ç∑„Éß„ÉÉ„Éó„É¢„Éº„ÉÄ„É´ */
        #shop-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }
        
        #shop-modal.show {
            display: flex;
        }
        
        #shop-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid #FFD700;
        }
        
        @media (max-width: 480px) {
            #shop-modal-content {
                padding: 20px;
                width: 95%;
            }
        }
        
        #shop-modal-title {
            color: #FFD700;
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            text-align: center;
        }
        
        .shop-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-sizing: border-box;
            max-width: 100%;
        }
        
        .shop-section-title {
            color: #4facfe;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .shop-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .shop-item-icon {
            font-size: 36px;
        }
        
        .shop-item-name {
            color: white;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .shop-item-price {
            color: #FFD700;
            font-size: 14px;
            font-weight: 600;
        }
        
        .shop-item-note {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-top: 3px;
        }
        
        .shop-buy-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .shop-buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .shop-buy-btn:active {
            transform: scale(0.95);
        }
        
        .shop-buy-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }
        
        .shop-buy-btn.purchased {
            background: rgba(100, 100, 100, 0.5);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }
        
        #close-shop-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* Ë≥ºÂÖ•Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ */
        #confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        
        #confirm-modal.show {
            display: flex;
        }
        
        #confirm-modal-content {
            background: linear-gradient(135deg, #2a2a3e 0%, #1e2a4e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 85%;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.7);
            border: 3px solid #4facfe;
            text-align: center;
        }
        
        #confirm-modal-title {
            color: #FFD700;
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        #confirm-modal-message {
            color: white;
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        #confirm-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #confirm-yes-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        #confirm-yes-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
        }
        
        #confirm-no-btn {
            background: rgba(255, 100, 100, 0.8);
            color: white;
        }
        
        #confirm-no-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 100, 100, 0.5);
        }
        
        .confirm-btn:active {
            transform: scale(0.95);
        }
    

/* v54 viewport fix (Android Chrome address bar + safe-area) */
html, body { height: 100%; }

/* Use dynamic viewport units when supported */
/* Ensure bottom UI never gets clipped by system bars */
#interaction-area{
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
}

/* If any element was positioned flush to bottom, give it breathing room */
#button-grid{
  margin-bottom: calc(env(safe-area-inset-bottom, 0px) + 6px);
}

/* v55 moon tweak */
#character {
  font-size: 150px;
}
#character-area {
  padding-top: 10vh;
}


/* v56 moon further down */
#character-area {
  padding-top: calc(10vh + 75px); /* move down roughly one moon radius */
}


/* ===== PC„Åß„ÅØ„Çπ„Éû„ÉõÁ∏¶ÁîªÈù¢Âõ∫ÂÆö ===== */
@media (min-width: 768px) {
  #viewport { padding: 24px; }
  #app{
    height: min(900px, 100vh);
    aspect-ratio: 9 / 16;
    width: auto;
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
  }
}
@media (max-width: 767px) {
  #app{
    width: 100%;
    height: 100%;
    aspect-ratio: auto;
    border-radius: 0;
    box-shadow: none;
  }
}


/* ===== ËøΩÂä†ËÉåÊôØÔºà„Ç¨„ÉÅ„É£Ôºâ ===== */
.jellyfish-bg{
  background: radial-gradient(circle at 30% 20%, rgba(0, 255, 240, 0.18), transparent 45%),
              radial-gradient(circle at 70% 40%, rgba(120, 90, 255, 0.18), transparent 50%),
              linear-gradient(135deg, #061b2b 0%, #1a2a6c 45%, #0b1f33 100%);
}
.capsule-bg{
  background: radial-gradient(circle at 25% 20%, rgba(255, 0, 200, 0.20), transparent 40%),
              radial-gradient(circle at 75% 35%, rgba(0, 255, 200, 0.18), transparent 45%),
              radial-gradient(circle at 45% 75%, rgba(255, 220, 0, 0.14), transparent 50%),
              linear-gradient(135deg, #14002b 0%, #0b2b3d 45%, #2b0030 100%);
}

/* „ÇØ„É©„Ç≤ÊºîÂá∫ */
.jellyfish-particle{
  position:absolute;
  font-size: 28px;
  opacity: 0.55;
  filter: blur(0.2px);
  transform: translateY(110%);
  animation: jellyfishFloat linear infinite;
  pointer-events:none;
}
@keyframes jellyfishFloat{
  0% { transform: translateY(120vh) translateX(0); opacity: 0; }
  10%{ opacity: 0.55; }
  100% { transform: translateY(-20vh) translateX(40px); opacity: 0; }
}
/* override */
@keyframes jellyfishFloat_old{
  0% { transform: translateY(110%) translateX(0); opacity: 0; }
  10%{ opacity: 0.55; }
  100% { transform: translateY(-20%) translateX(40px); opacity: 0; }
}

/* „Ç´„Éó„Çª„É´ÊºîÂá∫ÔºàËêΩ‰∏ãÔºâ */
.capsule-particle{
  position:absolute;
  font-size: 26px;
  opacity: 0.5;
  transform: translateY(-20%);
  animation: capsuleFall linear infinite;
  pointer-events:none;
}
@keyframes capsuleFall{
  0% { transform: translateY(-20vh) rotate(0deg); opacity: 0; }
  10%{ opacity: 0.5; }
  100% { transform: translateY(120vh) rotate(180deg); opacity: 0; }
}
/* override */
@keyframes capsuleFall_old{
  0% { transform: translateY(-20%) rotate(0deg); opacity: 0; }
  10%{ opacity: 0.5; }
  100% { transform: translateY(115%) rotate(180deg); opacity: 0; }
}


/* ===== „ÇØ„É™„ÉÉ„ÇØÈòªÂÆ≥‰øÆÊ≠£ ===== */
/* ËÉåÊôØ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅØUI„Çà„ÇäËÉåÈù¢„Å´ */
.jellyfish-particle,
.capsule-particle{
  pointer-events: none !important;
  z-index: 0;
}

/* UI„Å®„É¢„Éº„ÉÄ„É´„ÅØÊúÄÂâçÈù¢ */
#interaction-area,
#button-grid,
.modal,
#shop-modal,
#closet-modal,
#gacha-modal{
  position: relative;
  z-index: 10;
}


/* ===== PC„Åß„Éú„Çø„É≥„Åå‰∏ä„Å´ÂØÑ„Çã„ÅÆ„ÇíÈò≤„ÅêÔºà‰∏ã„Å´Âõ∫ÂÆöÔºâ ===== */
#app{
  display: flex;
  flex-direction: column;
}
#main-container{
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 100%;
}
#game-area{
  flex: 1 1 auto;
}
#interaction-area{
  margin-top: auto; /* Â∏∏„Å´‰∏ãÂÅ¥„Å∏ */
}


/* ===== „Éú„Çø„É≥„Åå‰∏ä„Å´ÂØÑ„ÇãÂïèÈ°å„ÅÆÊ†πÊú¨‰øÆÊ≠£ ===== */
/* interaction-area „ÅÆ absolute Âü∫Ê∫ñ„Çí #main-container „Å´„Åô„Çã */
#main-container{
  position: relative;
  height: 100%;
}

/* ‰∏ãUI„ÇíÁ¢∫ÂÆü„Å´‰∏ã„Å∏Âõ∫ÂÆö */
#interaction-area{
  left: 0;
  right: 0;
  bottom: 0;
}

/* ‰∏ãUI„Å∂„Çì„Å†„Åë„Ç≤„Éº„É†ÂÅ¥„Å´‰ΩôÁôΩ„ÇíÁ¢∫‰øùÔºàË¢´„ÇäÈò≤Ê≠¢Ôºâ */
#game-area{
  padding-bottom: 220px; /* „Éú„Çø„É≥Ôºã„ÉÜ„Ç≠„Çπ„ÉàÊû†„ÅÆÈ´ò„ÅïÁõÆÂÆâ */
}
@media (max-width: 380px){
  #game-area{ padding-bottom: 240px; }
}


/* ===== ‰ΩçÁΩÆ„ÅåÂ§â„Çè„Çâ„Å™„ÅÑÊôÇ„ÅÆÊúÄÁµÇ‰∏äÊõ∏„ÅçÔºàÂº∑Âà∂ÈÅ©Áî®Ôºâ ===== */
#main-container{ position: relative !important; height: 100% !important; }

#interaction-area{
  position: absolute !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;   /* „Åì„Åì„Çí 0„Äú24px „ÅßÂ•Ω„Åø„Å´Ë™øÊï¥ÂèØ */
  margin: 0 !important;
}

/* „Éú„Çø„É≥Ôºã‰ºöË©±Êû†„Å∂„Çì„Å†„Åë„Ç≤„Éº„É†ÂÅ¥„Å´‰ΩôÁôΩ */
#game-area{ padding-bottom: 260px !important; }
@media (max-width: 380px){ #game-area{ padding-bottom: 280px !important; } }


/* ===== „É¨„Ç§„Ç¢„Ç¶„ÉàÊ†πÊú¨‰øÆÊ≠£ÔºöabsoluteÂõ∫ÂÆö„Çí„ÇÑ„ÇÅ„Å¶Grid„Åß‰∏ãUI„ÇíÂõ∫ÂÆö ===== */
#app{
  display: block !important;
}

/* ÁîªÈù¢ÂÖ®‰Ωì„Çí„Äå‰∏ä(„Éò„ÉÉ„ÉÄ„Éº) / ‰∏≠(„Ç≤„Éº„É†) / ‰∏ã(UI)„Äç„ÅÆ3ÊÆµ„Å´„Åô„Çã */
#main-container{
  display: grid !important;
  grid-template-rows: auto 1fr auto !important;
  height: 100% !important;
  position: relative !important;
}

/* „Ç≤„Éº„É†È†òÂüü„ÅØÁúü„Çì‰∏≠„Å´‰º∏„Å≥„Çã */
#game-area{
  grid-row: 2 !important;
  padding-bottom: 0 !important;
  overflow: hidden;
}

/* ‰∏ãUI„ÅØÂ∏∏„Å´ÊúÄ‰∏ãÊÆµ„Å´ÈÖçÁΩÆÔºà„Çπ„ÇØ„É≠„Éº„É´„Åß„Ç∫„É¨„Å™„ÅÑÔºâ */
#interaction-area{
  grid-row: 3 !important;
  position: relative !important;
  left: auto !important;
  right: auto !important;
  bottom: auto !important;
  margin: 0 !important;
  padding-bottom: env(safe-area-inset-bottom);
}

/* ===== „É¢„Éº„ÉÄ„É´È°û„ÅØÂ∏∏„Å´ÁîªÈù¢ÂÖ®Èù¢„ÅÆfixed„ÅßË°®Á§∫Ôºà‰∏ã„Å´Êäº„ÅóÂá∫„Åï„Çå„Å™„ÅÑÔºâ ===== */
.modal,
#shop-modal,
#closet-modal,
#gacha-modal,
#mission-modal{
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  z-index: 300 !important;
}

/* ËÉåÊôØ„Ç®„Éï„Çß„ÇØ„Éà„ÅØ„Çø„ÉÉ„Éó„ÇíÈÇ™È≠î„Åó„Å™„ÅÑ */
.jellyfish-particle,
.capsule-particle,
.collectible-star{
  pointer-events: none !important;
}


/* ===== Êòü„ÇØ„É™„ÉÉ„ÇØÂæ©Ê¥ªÔºàËÉåÊôØÊºîÂá∫„ÅØÈÄèÈÅé„ÇØ„É™„ÉÉ„ÇØÔºâ ===== */
.jellyfish-particle,
.capsule-particle{
  pointer-events: none !important;
}
.collectible-star{
  pointer-events: auto !important;
  z-index: 50 !important;
}

/* ===== Grid„ÅåÂäπ„Åè„Çà„ÅÜ„Å´È´ò„Åï„Çí‰øùË®ºÔºàPC„Åß‰∏ãUI„Åå‰∏ä„Å´Êù•„Å™„ÅÑÔºâ ===== */
html, body{
  height: 100% !important;
}
#viewport{
  height: 100vh !important;
}
#app{
  height: 100% !important;
}
#main-container{
  height: 100% !important;
  min-height: 100% !important;
}

/* ‰ΩôÁôΩ„Åå‰∏ã„Å´Âá∫„ÇãÊôÇ„ÅØ„Ç≤„Éº„É†È†òÂüü„ÅåÁ∏Æ„Çì„Åß„ÅÑ„Çã„ÅÆ„Åß‰º∏„Å∞„Åô */
#game-area{
  min-height: 0 !important;
}



/* ===== ÊúÄÁµÇ„É¨„Ç§„Ç¢„Ç¶„ÉàÂõ∫ÂÆöÔºàPC„Åß„ÇÇ‰∏ãUI„ÅåÂøÖ„Åö‰∏ãÔºâ ===== */
/* Grid/Flex„ÅÆÂÆüÈ®ì„Çí‰∏äÊõ∏„Åç„Åó„Å¶„ÄÅÂÖÉ„ÅÆabsoluteÊñπÂºè„Å´Áµ±‰∏Ä */
#main-container{
  position: relative !important;
  height: 100% !important;
  display: block !important;
}
#game-area{
  height: 100% !important;
  padding-bottom: 230px !important; /* ‰∏ãUI„Å∂„Çì */
}
#interaction-area{
  position: absolute !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  grid-row: auto !important;
  margin-top: 0 !important;
}

/* ===== Êòü„ÇØ„É™„ÉÉ„ÇØÂæ©Ê¥ªÔºà#stars„ÅåÈÄèÈÅé„Å´„Å™„Å£„Å¶„ÅÑ„Åü„ÅÆ„ÅåÂéüÂõ†Ôºâ ===== */
#stars{
  pointer-events: auto !important;  /* Â≠êË¶ÅÁ¥†Ôºàcollectible-starÔºâ„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´ */
}
.star{
  pointer-events: none !important;  /* ËÉåÊôØ„ÅÆÁÇπ„ÅØ„ÇØ„É™„ÉÉ„ÇØÁÑ°Âäπ */
}
.jellyfish-particle,
.capsule-particle{
  pointer-events: none !important;
}
.collectible-star{
  pointer-events: auto !important;
  z-index: 120 !important;
}


/* ===== Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„Åå„Ç∑„Éß„ÉÉ„Éó„ÅÆË£è„Å´Âõû„ÇãÂïèÈ°å„Çí‰øÆÊ≠£ ===== */
#shop-modal{
  position: fixed !important;
  z-index: 500 !important;
}
#confirm-modal{
  position: fixed !important;
  z-index: 800 !important;
}
/* „Å§„ÅÑ„Åß„Å´‰ªñ„ÅÆ„É¢„Ç∏„É•„Éº„É´„ÇÇÂâçÈù¢„Å´ */
#closet-modal, #gacha-modal, #mission-modal{
  position: fixed !important;
  z-index: 600 !important;
}


/* ===== „Ç≥„Ç∫„Éü„ÉÉ„ÇØËÉåÊôØÔºàü™êÔºâ: „Ç®„Éï„Çß„ÇØ„ÉàÁÑ°„Åó„ÉªËÉåÊôØ„ÅÆ„Åø ===== */
body.capsule-bg{
  background:
    radial-gradient(circle at 20% 30%, rgba(120, 80, 255, 0.30), transparent 40%),
    radial-gradient(circle at 80% 40%, rgba(0, 200, 255, 0.28), transparent 45%),
    radial-gradient(circle at 50% 75%, rgba(255, 255, 255, 0.10), transparent 55%),
    linear-gradient(135deg, #060016 0%, #12002e 45%, #02000a 100%);
}


/* ===== „Éû„Éç„Éº/„Ç∏„É•„Ç®„É´ËªΩÈáè„É™„ÉÉ„ÉÅÔºàÁµµÊñáÂ≠ó+ÂÖâ„ÅÆÂÜÜÔºâ ===== */
body.jewel-bg{
  background:
    radial-gradient(circle at 22% 18%, rgba(200, 240, 255, 0.45), transparent 38%),
    radial-gradient(circle at 78% 35%, rgba(150, 180, 255, 0.42), transparent 42%),
    radial-gradient(circle at 55% 75%, rgba(255, 255, 255, 0.12), transparent 55%),
    linear-gradient(135deg, #07122a 0%, #0f2a62 45%, #050a18 100%);
}
.jewel-gem{
  position:absolute;
  font-size: 36px;
  opacity: 0.98;
  filter: drop-shadow(0 0 14px rgba(210,245,255,0.95)) drop-shadow(0 0 6px rgba(120,170,255,0.65));
  animation: jewelFall linear infinite;
  pointer-events:none;
}
@keyframes jewelFall{
  0% { transform: translateY(-20vh) rotate(0deg) scale(1); }
  50% { transform: translateY(50vh) rotate(var(--spin)) scale(1.05); }
  100% { transform: translateY(120vh) rotate(calc(var(--spin) * 1.5)) scale(1.08); }
}
/* override */
@keyframes jewelFall_old{
  0% { transform: translateY(-20vh) scale(1); }
  100% { transform: translateY(120vh) scale(1.08); }
}
.jewel-glow{
  position:absolute;
  top: 0;
  width: var(--gsize, 34px);
  height: var(--gsize, 34px);
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,255,255,0.85), rgba(255,255,255,0.35), transparent 72%);
  opacity: 0.75;
  pointer-events:none;
  animation: jewelGlowFall linear infinite;
  will-change: transform, opacity;
  z-index: 4;
}
@keyframes jewelGlowFall{
  0%   { transform: translate3d(0,-20vh,0) scale(0.9); opacity: 0; }
  12%  { opacity: 0.75; }
  100% { transform: translate3d(0,120vh,0) scale(1.25); opacity: 0; }
}


body.money-bg{
  background:
    radial-gradient(circle at 20% 20%, rgba(255, 235, 170, 0.46), transparent 38%),
    radial-gradient(circle at 80% 38%, rgba(255, 210, 120, 0.42), transparent 42%),
    radial-gradient(circle at 55% 78%, rgba(255, 255, 255, 0.10), transparent 55%),
    linear-gradient(135deg, #2b1a06 0%, #5a3b13 45%, #120b03 100%);
}
.money-coin{
  position:absolute;
  font-size: 34px;
  opacity: 0.98;
  filter: drop-shadow(0 0 12px rgba(255,230,170,0.95)) drop-shadow(0 0 6px rgba(255,200,90,0.6));
  animation: moneyFall linear infinite;
  pointer-events:none;
}
@keyframes moneyFall{
  0% { transform: translateY(-20vh) rotate(0deg); }
  50% { transform: translateY(50vh) rotate(var(--spin)); }
  100% { transform: translateY(120vh) rotate(calc(var(--spin) * 1.5)); }
}
/* override */
@keyframes moneyFall_old{
  0% { transform: translateY(-20vh) rotate(0deg); }
  100% { transform: translateY(120vh) rotate(180deg); }
}
.money-shine{
  position:absolute;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,230,170,0.28), transparent 72%);
  opacity: 0.75;
  pointer-events:none;
}

/* ËÉåÊôØ„Ç®„Éï„Çß„ÇØ„Éà„ÅØUI„ÇØ„É™„ÉÉ„ÇØ„ÇíÈÇ™È≠î„Åó„Å™„ÅÑ */
.star{ pointer-events:none; }



:root{
  --money-bg:
    radial-gradient(120% 90% at 14% 16%, rgba(255,230,165,0.60), transparent 46%),
    radial-gradient(100% 80% at 88% 30%, rgba(255,205,120,0.52), transparent 52%),
    radial-gradient(130% 100% at 52% 90%, rgba(235,175,90,0.38), transparent 58%),
    linear-gradient(135deg, #241404 0%, #6a4013 45%, #0f0802 100%);
  --jewel-bg:
    radial-gradient(120% 90% at 18% 12%, rgba(120,220,255,0.58), transparent 46%),
    radial-gradient(100% 80% at 86% 28%, rgba(170,140,255,0.50), transparent 52%),
    radial-gradient(130% 100% at 50% 88%, rgba(80,170,230,0.38), transparent 58%),
    linear-gradient(135deg, #07102a 0%, #16306e 45%, #040714 100%);
}
.money-bg{ background: var(--money-bg); }
.jewel-bg{ background: var(--jewel-bg); }

/* ËÉåÊôØ„Å†„ÅëËâ≤Áõ∏„Çí„ÇÜ„Å£„Åè„ÇäÂãï„Åã„ÅôÔºàDOMÂ¢ó„ÇÑ„Åï„Å™„ÅÑÔºâ */
body.money-bg::before,
body.jewel-bg::before{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: -1;
  background: inherit;
  animation: hueShift 14s ease-in-out infinite;
}
@keyframes hueShift{
  0%   { filter: hue-rotate(0deg) saturate(1.10); }
  50%  { filter: hue-rotate(18deg) saturate(1.25); }
  100% { filter: hue-rotate(0deg) saturate(1.10); }
}


/* ===== ‰∏∏„ÅÑ„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂ§¢ ËÉåÊôØÈ¢®Ôºâ ===== */
.circle-fall{
  position:absolute;
  width: var(--size);
  height: var(--size);
  border-radius: 50%;
  opacity: 0.8;
  pointer-events:none;
  animation: circleFall linear infinite;
  will-change: transform, opacity;
}
.circle-yellow{ background: #f2c94c; }      /* yellow */
.circle-orange{ background: #f2994a; }     /* orange */
.circle-amber{ background: #f7b733; }      /* amber */
.circle-blue{
  background: radial-gradient(circle, rgba(160,220,255,0.9), rgba(120,190,255,0.45), transparent 70%);
}
@keyframes circleFall{
  0%{
    transform: translate3d(0,-20vh,0) scale(0.8);
    opacity: 0.0;
  }
  10%{ opacity: 0.6; }
  100%{
    transform: translate3d(0,120vh,0) scale(1.2);
    opacity: 0.0;
  }
}


/* ===== Â§úÁ©∫ËÉåÊôØ hue shift ===== */
body.night-bg::before{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: -1;
  background: inherit;
  filter: hue-rotate(0deg) saturate(1.1);
  animation: nightHueShift 18s ease-in-out infinite;
}
@keyframes nightHueShift{
  0%   { filter: hue-rotate(0deg); }
  50%  { filter: hue-rotate(-20deg); }
  100% { filter: hue-rotate(0deg); }
}


/* ===== Êñ∞ËÉåÊôØ: Á¥ÖËå∂„Éü„É´„ÇØ / „ÇØ„É™„Éº„É†„ÇΩ„Éº„ÉÄ / „ÉØ„Ç§„É≥ / „Éï„Ç£„É´„É† ===== */

/* Á¥ÖËå∂„Éü„É´„ÇØ */
.tea-bg{
  background:
    radial-gradient(120% 90% at 18% 18%, rgba(255, 238, 214, 0.85), transparent 52%),
    radial-gradient(110% 85% at 82% 30%, rgba(226, 178, 130, 0.55), transparent 55%),
    radial-gradient(140% 120% at 55% 92%, rgba(186, 124, 86, 0.30), transparent 60%),
    linear-gradient(135deg, #f3e4cf 0%, #ddb78f 45%, #7a4f36 100%);
  animation: teaBreathe 10s ease-in-out infinite;
}
@keyframes teaBreathe{
  0%{ filter: brightness(1.00) saturate(1.02); }
  50%{ filter: brightness(1.06) saturate(1.06); }
  100%{ filter: brightness(1.00) saturate(1.02); }
}
.tea-dot{
  position:absolute;
  width: var(--tsize, 22px);
  height: var(--tsize, 22px);
  border-radius: 50%;
  opacity: 1;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.06), rgba(0,0,0,0.985) 55%, rgba(0,0,0,0.995) 100%);
  pointer-events:none;
  animation: teaFall linear infinite;
  will-change: transform, opacity;
}
@keyframes teaFall{
  0%{ transform: translate3d(0,-20vh,0) scale(0.9); opacity: 0; }
  12%{ opacity: 0.82; }
  100%{ transform: translate3d(0,120vh,0) scale(1.15); opacity: 0; }
}
.tea-honey{
  position:absolute;
  font-size: 26px;
  opacity: 1;
  pointer-events:none;
  animation: honeyFall linear infinite;
  will-change: transform, opacity;
}
@keyframes honeyFall{
  0%{ transform: translate3d(0,-20vh,0) rotate(0deg); opacity: 0; }
  10%{ opacity: 1; }
  100%{ transform: translate3d(0,120vh,0) rotate(18deg); opacity: 0; }
}

/* „ÇØ„É™„Éº„É†„ÇΩ„Éº„ÉÄ */
.soda-bg{
  background:
    radial-gradient(120% 90% at 20% 15%, rgba(220, 255, 245, 0.85), transparent 55%),
    radial-gradient(110% 85% at 80% 28%, rgba(120, 230, 200, 0.55), transparent 55%),
    radial-gradient(140% 120% at 50% 92%, rgba(255, 245, 225, 0.55), transparent 62%),
    linear-gradient(135deg, #bdf3e3 0%, #63d3b8 45%, #214a44 100%);
  animation: sodaBreathe 12s ease-in-out infinite;
}
@keyframes sodaBreathe{
  0%{ filter: brightness(1.00) saturate(1.05); }
  50%{ filter: brightness(1.05) saturate(1.15); }
  100%{ filter: brightness(1.00) saturate(1.05); }
}
.soda-bubble{
  position:absolute;
  width: var(--bsize, 18px);
  height: var(--bsize, 18px);
  border-radius: 50%;
  opacity: 0.70;
  background: rgba(245,255,252,0.75);
  pointer-events:none;
  animation: bubbleRise linear infinite;
  will-change: transform, opacity;
}
@keyframes bubbleRise{
  0%{ transform: translate3d(0,120vh,0) scale(0.8); opacity: 0; }
  15%{ opacity: 0.70; }
  100%{ transform: translate3d(0,-30vh,0) scale(1.15); opacity: 0; }
}
.soda-cherry{
  position:absolute;
  font-size: 24px;
  opacity: 1;
  pointer-events:none;
  animation: cherryFall linear infinite;
  will-change: transform, opacity;
}
@keyframes cherryFall{
  0%{ transform: translate3d(0,-20vh,0) rotate(0deg) scale(0.95); opacity: 0; }
  12%{ opacity: 1; }
  100%{ transform: translate3d(0,120vh,0) rotate(var(--spin, 260deg)) scale(1.08); opacity: 0; }
}
  12%{ opacity: 1; }
  100%{ transform: translate3d(0,120vh,0) rotate(-25deg); opacity: 0; }
}

/* „ÉØ„Ç§„É≥ */
.wine-bg{ }
@keyframes wineHue{
  0%{ filter: hue-rotate(0deg) saturate(1.15) brightness(1.00); }
  50%{ filter: hue-rotate(28deg) saturate(1.35) brightness(1.03); }
  100%{ filter: hue-rotate(0deg) saturate(1.15) brightness(1.00); }
}
  50%{ filter: hue-rotate(-10deg) saturate(1.25) brightness(1.03); }
  100%{ filter: hue-rotate(0deg) saturate(1.10) brightness(1.00); }
}
.wine-dot{
  position:absolute;
  width: var(--wsize, 18px);
  height: var(--wsize, 18px);
  border-radius: 50%;
  opacity: 0.78;
  background: var(--wcolor, rgba(160, 30, 80, 0.70));
  pointer-events:none;
  animation: wineFall linear infinite;
  will-change: transform, opacity;
}
@keyframes wineFall{
  0%{ transform: translate3d(0,-20vh,0) scale(0.85); opacity: 0; }
  10%{ opacity: 0.78; }
  100%{ transform: translate3d(0,120vh,0) scale(1.10); opacity: 0; }
}
.wine-grape{
  position:absolute;
  font-size: 24px;
  opacity: 0.92;
  pointer-events:none;
  animation: grapeFall linear infinite;
  will-change: transform, opacity;
}
@keyframes grapeFall{
  0%{ transform: translate3d(0,-20vh,0) rotate(0deg); opacity: 0; }
  12%{ opacity: 0.92; }
  100%{ transform: translate3d(0,120vh,0) rotate(18deg); opacity: 0; }
}

/* „Éï„Ç£„É´„É† */
.film-bg{
  background:
    radial-gradient(120% 90% at 18% 20%, rgba(255, 242, 220, 0.55), transparent 55%),
    radial-gradient(110% 85% at 82% 30%, rgba(210, 180, 140, 0.35), transparent 58%),
    linear-gradient(135deg, #2a241c 0%, #6a5a45 45%, #17130f 100%);
  animation: filmBreathe 14s ease-in-out infinite, filmHue 22s linear infinite;
}
@keyframes filmHue{
  0%{ filter: hue-rotate(0deg) contrast(1.00) brightness(1.00); }
  50%{ filter: hue-rotate(22deg) contrast(1.06) brightness(1.02); }
  100%{ filter: hue-rotate(0deg) contrast(1.00) brightness(1.00); }
}
@keyframes filmBreathe{
  0%{ filter: contrast(1.00) brightness(1.00); }
  50%{ filter: contrast(1.08) brightness(1.03); }
  100%{ filter: contrast(1.00) brightness(1.00); }
}
body.film-bg::after{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: 0;
  opacity: 0.12;
  background:
    repeating-linear-gradient(90deg, rgba(0,0,0,0.35) 0, rgba(0,0,0,0.35) 1px, transparent 1px, transparent 6px),
    repeating-linear-gradient(0deg, rgba(255,255,255,0.18) 0, rgba(255,255,255,0.18) 1px, transparent 1px, transparent 7px);
  mix-blend-mode: overlay;
  animation: filmJitter 1.4s steps(2,end) infinite;
}
@keyframes filmJitter{
  0%{ transform: translate3d(0,0,0); }
  50%{ transform: translate3d(1px,-1px,0); }
  100%{ transform: translate3d(0,0,0); }
}



body.wine-bg{ background-color:#14040c !important; }


/* Background FX layer (behind everything, never blocks UI) */
#bgfx{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index: 0;
}
/* Put stars and UI above bgfx (keep their original positioning) */
#stars{ z-index: 1; }
#top-ui, #speech-bubble, #bottom-ui, #modules, #settings-modal, #character-container, #center-area{
  z-index: 20;
}

/* Rich wine gradient + hue shift on bgfx only */
#bgfx.wine-bg{
  background-color:#14040c;
  background-repeat:no-repeat;
  background-size:cover;
  background-image:
    radial-gradient(140% 120% at 14% 16%, rgba(255, 190, 220, 0.22), transparent 58%),
    radial-gradient(120% 95% at 86% 20%, rgba(190, 60, 150, 0.30), transparent 60%),
    radial-gradient(120% 120% at 55% 92%, rgba(70, 10, 45, 0.48), transparent 64%),
    radial-gradient(110% 100% at 62% 55%, rgba(255, 110, 170, 0.12), transparent 60%),
    radial-gradient(130% 120% at 38% 36%, rgba(255, 235, 250, 0.07), transparent 56%),
    radial-gradient(160% 140% at 50% 50%, rgba(0, 0, 0, 0.18), transparent 62%),
    linear-gradient(135deg, #14040c 0%, #2f0617 30%, #520a2e 62%, #090309 100%);
  animation: wineHueRichBgfx 26s ease-in-out infinite;
}
#bgfx.wine-bg::before{
  content:"";
  position:absolute;
  inset:0;
  opacity:0.28;
  pointer-events:none;
  background:
    radial-gradient(70% 60% at 25% 30%, rgba(255,255,255,0.10), transparent 60%),
    radial-gradient(80% 70% at 75% 25%, rgba(255,140,200,0.14), transparent 62%),
    radial-gradient(90% 80% at 55% 75%, rgba(120,20,80,0.18), transparent 65%);
  mix-blend-mode: screen;
  animation: wineSheenBgfx 12s ease-in-out infinite;
}
@keyframes wineHueRichBgfx{
  0%   { filter: hue-rotate(0deg) saturate(1.22) contrast(1.02) brightness(1.00); }
  33%  { filter: hue-rotate(18deg) saturate(1.45) contrast(1.06) brightness(1.03); }
  66%  { filter: hue-rotate(-14deg) saturate(1.55) contrast(1.08) brightness(1.02); }
  100% { filter: hue-rotate(0deg) saturate(1.22) contrast(1.02) brightness(1.00); }
}
@keyframes wineSheenBgfx{
  0%{ transform: scale(1); opacity: 0.22; }
  50%{ transform: scale(1.03); opacity: 0.32; }
  100%{ transform: scale(1); opacity: 0.22; }
}

        /* „Ç∑„É£„É≥„Éë„É≥ ËÉåÊôØ */
        body.champagne-bg{
            background: linear-gradient(180deg,#f7efc6 0%,#e7cf7a 50%,#c9a84a 100%);
        }


        

        /* „Éü„É©„Éº„Éú„Éº„É´ ËÉåÊôØ */
        body.disco-bg{
            background: radial-gradient(circle at 30% 20%, #2a2a2a 0%, #101010 35%, #000000 100%);
        }
/* „Ç∑„É£„É≥„Éë„É≥ÔºöÊ≥°ÔºàÁµµÊñáÂ≠ó„Å™„ÅóÔºâ */
        .floating-circle{
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.85;
            mix-blend-mode: screen;
            filter: saturate(1.1);
            animation: floatCircle linear infinite;
            will-change: transform, opacity;
        }
        @keyframes floatCircle{
            0%{
                transform: translate3d(0,0,0) scale(1) rotate(0deg);
                opacity: 0;
            }
            10%{ opacity: 0.9; }
            90%{ opacity: 0.8; }
            100%{
                transform: translate3d(var(--dx, 0px), var(--ty, -110vh), 0) scale(1.15) rotate(360deg);
                opacity: 0;
            }
        }

    
        /* Êµ∑ ËÉåÊôØ */
        body.sea-bg{
            background: linear-gradient(180deg,#2ed0ff 0%,#1aa2e6 45%,#0b4f8a 100%);
        }
        .sea-fish{
            position: absolute;
            pointer-events: none;
            will-change: transform;
            filter: saturate(1.1);
        }
        @keyframes swim-right{
            0%   { transform: translateX(-20vw) translateY(0px) scaleX(var(--fx, 1)) scale(var(--s)) rotate(var(--r)); }
            100% { transform: translateX(120vw) translateY(var(--dy)) scale(calc(var(--s) * var(--fx, 1)), var(--s)) rotate(var(--r)); }
        }
        @keyframes swim-left{
            0%   { transform: translateX(120vw) translateY(0px) scaleX(var(--fx, 1)) scale(var(--s)) rotate(var(--r)); }
            100% { transform: translateX(-20vw) translateY(var(--dy)) scale(calc(var(--s) * var(--fx, 1)), var(--s)) rotate(var(--r)); }
        }


        /* „É¢„É´„Éï„Ç©Ëù∂ ËÉåÊôØÔºàUI„Å´ÂΩ±Èüø„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Êì¨‰ººË¶ÅÁ¥†„ÅßÊèèÁîªÔºâ */
        body.morpho-bg{
            background: none;
        }
        body.morpho-bg::before{
            content: "";
            position: fixed;
            inset: 0;
            z-index: -1;
            background: linear-gradient(
                135deg,
                #0b1d4a,
                #1f4fd8,
                #39c6ff,
                #1f4fd8,
                #0b1d4a
            );
            background-size: 400% 400%;
            animation: morphoFlow 14s ease-in-out infinite, morphoHue 18s linear infinite;
        }
        @keyframes morphoFlow{
            0%{ background-position: 0% 50%; }
            50%{ background-position: 100% 50%; }
            100%{ background-position: 0% 50%; }
        }
        @keyframes morphoHue{
            0%{ filter: hue-rotate(0deg); }
            50%{ filter: hue-rotate(70deg); }
            100%{ filter: hue-rotate(0deg); }
        }


        /* „É¢„É´„Éï„Ç©Ëù∂Ôºö‰∏äÊòá„Åô„ÇãÁ≤í„Å®Ëù∂ */
        .morpho-particle{
            position: absolute;
            bottom: -10vh;
            pointer-events: none;
            will-change: transform, opacity;
            animation: morphoRise linear infinite;
        }
        @keyframes morphoRise{
            from{
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10%{ opacity: 1; }
            to{
                transform: translateY(-120vh) translateX(var(--dx)) rotate(var(--rot));
                opacity: 0;
            }
        }


        /* „Éà„É©„É≥„Éó ËÉåÊôØ */
        body.cards-bg{
            background: linear-gradient(160deg,#e2dfd2 0%, #cfcab9 35%, #b7b09e 70%, #9f9886 100%);
        }
        .card-fall{
            position: absolute;
            top: -12vh;
            pointer-events: none;
            will-change: transform, opacity;
            animation: cardFall linear infinite;
            opacity: 1;
        }
        @keyframes cardFall{
            0%{ transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
            10%{ opacity: 1; }
            100%{ transform: translateY(125vh) translateX(var(--dx)) rotate(var(--rot)); opacity: 0; }
        }


        /* „Éç„Ç™„É≥ ËÉåÊôØÔºàUI„Å´ÂΩ±Èüø„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Êì¨‰ººË¶ÅÁ¥†„ÅßÊèèÁîªÔºâ */
        body.neoncandy-bg{
            background: none;
        }
        body.neoncandy-bg::before{
            content:"";
            position: fixed;
            inset: 0;
            z-index: -1;
            /* „É™„ÉÉ„ÉÅ„Å™„Éç„Ç™„É≥√ó„Ç≠„É£„É≥„Éá„Ç£ÊÑüÔºö„Ç∞„É©„ÉáÔºã„Çπ„Éà„É©„Ç§„ÉóÔºãÂÖâÁÇπ */
            background:
              radial-gradient(circle at 20% 20%, rgba(255, 80, 200, 0.55), rgba(255,80,200,0.0) 55%),
              radial-gradient(circle at 80% 30%, rgba(70, 220, 255, 0.55), rgba(70,220,255,0.0) 55%),
              radial-gradient(circle at 35% 80%, rgba(255, 220, 80, 0.45), rgba(255,220,80,0.0) 60%),
              radial-gradient(circle at 85% 85%, rgba(140, 255, 120, 0.35), rgba(140,255,120,0.0) 60%),
              repeating-linear-gradient(135deg,
                rgba(255,255,255,0.10) 0px,
                rgba(255,255,255,0.10) 10px,
                rgba(255,255,255,0.00) 10px,
                rgba(255,255,255,0.00) 24px
              ),
              linear-gradient(135deg,
                #120024 0%,
                #2b0058 30%,
                #004a7a 60%,
                #120024 100%
              );
            background-size: 120% 120%, 120% 120%, 140% 140%, 140% 140%, 160% 160%, 400% 400%;
            animation: neoncandyFlow 14s ease-in-out infinite, neoncandyHue 18s linear infinite;
        }
        @keyframes neoncandyFlow{
            0%   { background-position: 0% 50%, 100% 40%, 30% 100%, 100% 100%, 0% 0%, 0% 50%; }
            50%  { background-position: 60% 40%, 40% 60%, 70% 40%, 40% 60%, 40% 40%, 100% 50%; }
            100% { background-position: 0% 50%, 100% 40%, 30% 100%, 100% 100%, 0% 0%, 0% 50%; }
        }
        @keyframes neoncandyHue{
            0%   { filter: hue-rotate(0deg); }
            50%  { filter: hue-rotate(55deg); }
            100% { filter: hue-rotate(0deg); }
        }


        /* „Éù„ÉÜ„Éà ËÉåÊôØ */
        body.fries-bg{
            background: linear-gradient(160deg,#c40012 0%, #ff1a1a 45%, #a80012 100%);
        }
        .fries-stick{
            position: absolute;
            top: -12vh;
            width: var(--w);
            height: var(--h);
            border-radius: 4px;
            background: linear-gradient(90deg, #ffef7a 0%, #ffb000 50%, #ffef7a 100%);
            pointer-events: none;
            will-change: transform, opacity;
            opacity: 1;
            animation: friesFall linear infinite;
        }
        @keyframes friesFall{
            0%{ transform: translateY(0) translateX(0) rotate(var(--rot)); opacity: 0; }
            10%{ opacity: 1; }
            100%{ transform: translateY(125vh) translateX(var(--dx)) rotate(var(--rot)); opacity: 0; }
        }


        /* Êµ∑„ÅÆÊ≥° */
        .sea-bubble{
            position:absolute;
            bottom:-8vh;
            left:var(--x);
            width:var(--s);
            height:var(--s);
            border-radius:50%;
            background: rgba(255,255,255,0.55);
            pointer-events:none;
            will-change: transform, opacity;
            animation: bubbleUp linear infinite;
        }
        @keyframes bubbleUp{
            0%{ transform: translateY(0) translateX(0); opacity:0; }
            10%{ opacity:0.55; }
            100%{ transform: translateY(-120vh) translateX(var(--dx)); opacity:0; }
        }


        /* üé≤„É©„É≥„ÉÄ„É† ËÉåÊôØÔºàUI„Å´ÂΩ±Èüø„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Êì¨‰ººË¶ÅÁ¥†„ÅßÊèèÁîªÔºâ */
        body.dice-bg{
            background: none;
        }
        body.dice-bg::before{
            content:"";
            position: fixed;
            inset: 0;
            z-index: -1;
            /* JS„Åß --dice1..3 „Çí„É©„É≥„ÉÄ„É†„Å´Êõ¥Êñ∞ */
            background: linear-gradient(135deg, var(--dice1, #2b2b2b), var(--dice2, #444), var(--dice3, #222));
            background-size: 200% 200%;
            animation: diceFlow 12s ease-in-out infinite;
            transition: background 1.1s ease;
        }
        @keyframes diceFlow{
            0%{ background-position: 0% 50%; }
            50%{ background-position: 100% 50%; }
            100%{ background-position: 0% 50%; }
        }
        .dice-fall{
            position: absolute;
            top: -12vh;
            pointer-events: none;
            will-change: transform, opacity;
            animation: diceFall linear infinite;
            opacity: 0.95;
        }
        @keyframes diceFall{
            0%{ transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
            10%{ opacity: 0.95; }
            100%{ transform: translateY(125vh) translateX(var(--dx)) rotate(var(--rot)); opacity: 0; }
        }


        .bgm-select{
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            margin-top:10px;
        }
        .bgm-btn{
            padding:10px 14px;
            border-radius:12px;
            border:1px solid rgba(255,255,255,0.25);
            background: rgba(255,255,255,0.10);
            color:#fff;
            font-weight:700;
            cursor:pointer;
        }
        .bgm-btn.active{
            background:#fff;
            color:#000;
            border-color:#fff;
        }


        /* BGM dropdown (compact) */
        .bgm-dropdown{ position:relative; margin-top:10px; }
        .bgm-current{
            width:100%;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            padding:12px 14px;
            border-radius:14px;
            border:1px solid rgba(255,255,255,0.22);
            background: rgba(255,255,255,0.10);
            color:#fff;
            font-weight:800;
            cursor:pointer;
        }
        .bgm-current:active{ transform: translateY(1px); }
        .bgm-current-caret{ opacity:0.85; font-weight:900; }
        .bgm-list{
            position:absolute;
            left:0;
            right:0;
            top: calc(100% + 8px);
            background: rgba(10, 14, 26, 0.92);
            border:1px solid rgba(255,255,255,0.18);
            border-radius:14px;
            padding:8px;
            display:none;
            z-index: 500; /* below modals */
            backdrop-filter: blur(10px);
        }
        .bgm-list.open{ display:block; }
        .bgm-item{
            width:100%;
            text-align:left;
            padding:12px 12px;
            border-radius:12px;
            border:1px solid transparent;
            background: rgba(255,255,255,0.06);
            color:#fff;
            font-weight:800;
            cursor:pointer;
        }
        .bgm-item + .bgm-item{ margin-top:8px; }
        .bgm-item.active{
            background:#fff;
            color:#000;
        }


/* ===== Skill panel (collapsible, no layout break) ===== */
#skill-toggle-wrap{
    display:flex;
    justify-content:center;
    margin: 6px 0 10px;
    pointer-events: auto;
}
#skill-toggle-btn{
    width: 60px;
    height: 30px;
    border-radius: 999px;
    border: 2px solid rgba(255, 215, 0, 0.45);
    background: rgba(0,0,0,0.35);
    color: rgba(255,255,255,0.95);
    font-size: 16px;
    font-weight: 900;
    cursor: pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    backdrop-filter: blur(10px);
    box-shadow:
        0 0 18px rgba(255,215,0,0.18),
        0 4px 14px rgba(0,0,0,0.25),
        inset 0 1px 8px rgba(255,215,0,0.10);
    transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}
#skill-toggle-btn:hover{
    transform: scale(1.06);
    border-color: rgba(255,215,0,0.75);
    box-shadow:
        0 0 26px rgba(255,215,0,0.35),
        0 6px 18px rgba(0,0,0,0.35),
        inset 0 1px 10px rgba(255,215,0,0.18);
}
#skill-toggle-btn:active{ transform: scale(0.95); }

/* Panel wrapper: fully hidden when closed (no "peeking") */
#skill-panel{
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(18px);
    transition: max-height 0.35s ease, opacity 0.25s ease, transform 0.35s ease;
    pointer-events: none;
}
#skill-panel.open{
    max-height: 320px; /* enough for buttons + padding */
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}
#skill-panel #skill-system{
    margin: 0 0 6px;
    background: rgba(0, 0, 0, 0.30);
    backdrop-filter: blur(12px);
    border-radius: 16px;
    border: 2px solid rgba(255,215,0,0.28);
    box-shadow:
        0 0 22px rgba(255,215,0,0.14),
        0 10px 30px rgba(0,0,0,0.35),
        inset 0 1px 10px rgba(255,215,0,0.08);
}



</style>

</head>
<body class="night-bg">
    <div id="viewport"><div id="app">
    <div id="game-container">
        <div id="bgfx"></div>
        <div id="stars"></div>
        
        <button id="settings-btn">‚öôÔ∏è</button>
        
        <!-- „Éá„Éê„ÉÉ„Ç∞„Éú„Çø„É≥Ôºà‰∏ÄÊôÇÁöÑÔºâ -->
        <button id="debug-idle-btn" style="position: fixed; top: 60px; right: 10px; z-index: 100; padding: 10px; background: #FF6B6B; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: none;">„Éá„Éê„ÉÉ„Ç∞: ÊîæÁΩÆÂ†±ÈÖ¨</button>
        
        <!-- Áß∞Âè∑Ë°®Á§∫ -->
        <div id="title-display">
            <span id="title-text">Êñ∞Êòü</span>
        </div>
        
        <div id="top-ui">
            <div id="username-display">
                <span id="username-text">ÂêçÂâç„ÇíÂÖ•Âäõ</span>
            </div>

            <div id="hud-right">
                <div id="rank-box"><span id="rank-display">Rank 1</span></div>
                <div id="currency-container">
                    <div id="diamond-counter">üíé √ó 0</div>
                    <div id="star-counter">‚≠êÔ∏è √ó 0</div>
                </div>
            </div>
        </div>
        
        <div id="character-area">
            <div id="character">üåö</div>
            <div id="speech-bubble">
                <div id="speech-text"></div>
            </div>
        </div>
        
        <!-- È£æ„Çä„Ç®„É™„Ç¢ -->
        <div id="placement-area"></div>
        
        </div>
    </div>
    
    <!-- „Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥„Ç®„É™„Ç¢Ôºàgame-container„ÅÆÂ§ñ„Å´ÈÖçÁΩÆÔºâ -->
    <div id="interaction-area">
        <!-- „Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó„Ç∑„Çπ„ÉÜ„É† -->
        
        <div id="skill-panel">
<div id="skill-system">
                            <div class="skill-buttons">
                <button class="skill-button" id="skill-diamond-btn">
                    <div class="skill-name">üíé„Çπ„Ç≠„É´</div>
                    <div class="skill-level">Lv.<span id="skill-diamond-level">0</span>/5</div>
                </button>
                <button class="skill-button" id="skill-speed-btn">
                    <div class="skill-name">‚≠êÔ∏è„Çπ„Ç≠„É´</div>
                    <div class="skill-level">Lv.<span id="skill-speed-level">0</span>/5</div>
                </button>
                <button class="skill-button" id="skill-bonus-btn">
                    <div class="skill-name">üéÅ„Çπ„Ç≠„É´</div>
                    <div class="skill-level">Lv.<span id="skill-bonus-level">0</span>/5</div>
                </button>
            </div>
        </div>
        </div>

        <div id="skill-toggle-wrap">
            <button id="skill-toggle-btn" aria-label="„Çπ„Ç≠„É´„Éë„Éç„É´„ÇíÈñãÈñâ" title="„Çπ„Ç≠„É´">üîº</button>
        </div>
        <div id="button-grid">
            <button class="action-button" id="pixiv-btn">pixiv‚≠êÔ∏è3</button>
            <button class="action-button mini" id="collect-all-btn">‚≠êÔ∏è</button>
            <button class="action-button" id="mission-btn">„Éü„ÉÉ„Ç∑„Éß„É≥</button>
            <button class="action-button" id="gacha-btn">„Ç¨„ÉÅ„É£</button>
            <button class="action-button" id="shop-btn">„Ç∑„Éß„ÉÉ„Éó</button>
            <button class="action-button" id="closet-btn">ÁùÄ„ÅõÊõø„Åà</button>
        </div>
    </div>
    
    <!-- ÊîæÁΩÆÂ†±ÈÖ¨„É¢„Éº„ÉÄ„É´ -->
    <div id="idle-reward-modal" style="display: none;">
        <div id="idle-reward-content">
            <div id="idle-reward-title">üéÅ ÊîæÁΩÆÂ†±ÈÖ¨</div>
            <div id="idle-reward-message">
                <div id="idle-time-display"></div>
                <div id="idle-reward-amount"></div>
            </div>
            <button id="claim-idle-reward-btn" class="action-button">Âèó„ÅëÂèñ„Çã</button>
        </div>
    </div>
    
    <!-- Áß∞Âè∑„É¢„Éº„ÉÄ„É´ -->
    <div id="title-modal" style="display: none;">
        <div id="title-modal-content">
            <div id="title-modal-title">üèÜ Áß∞Âè∑</div>
            <div id="title-list"></div>
            <button id="close-title-modal-btn" class="action-button">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <!-- „Ç¨„ÉÅ„É£„É¢„Éº„ÉÄ„É´ -->
    <div id="gacha-modal">
        <div id="gacha-content">
            <div id="gacha-title">„Åä„Å®„Äú„Åµ„Ç¨„ÉÅ„É£</div>
            <div style="display: flex; gap: 10px; margin: 20px 0;">
                <button id="gacha-pull-btn-star" class="gacha-type-btn">
                    <div>‚≠êÔ∏è„Ç¨„ÉÅ„É£</div>
                    <div style="font-size: 14px;">‚≠êÔ∏è10ÂÄã</div>
                </button>
                <button id="gacha-pull-btn-diamond" class="gacha-type-btn">
                    <div style="font-size: 12px; color: #ffd700; font-weight: 700; margin-bottom: 2px;">SSRÁ¢∫ÂÆö</div>
                    <div>üíé„Ç¨„ÉÅ„É£</div>
                    <div style="font-size: 14px;">üíé1ÂÄã</div>
                </button>
            </div>
            <div id="gacha-result"></div>
            <button id="close-gacha-btn">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <!-- ÁùÄ„ÅõÊõø„Åà„É¢„Éº„ÉÄ„É´ -->
    <div id="closet-modal">
        <div id="closet-content">
            <div id="closet-title">üëî ÁùÄ„ÅõÊõø„Åà</div>
            
            <div class="reward-section">
                <div class="reward-title">üé® „Ç≠„É£„É©„ÇØ„Çø„Éº</div>
                <div class="reward-grid" id="closet-characters"></div>
            </div>
            
            <div class="reward-section">
                <div class="reward-title">üåÖ ËÉåÊôØ</div>
                <div class="reward-grid" id="closet-backgrounds"></div>
            </div>
            
            <div class="reward-section">
                <div class="reward-title">üéÄ È£æ„ÇäË®≠ÁΩÆ</div>
                <div class="decor-slots-ui">
                    <button class="decor-slot-btn active" data-slot="0">„Çπ„É≠„ÉÉ„Éà1</button>
                    <button class="decor-slot-btn" data-slot="1">„Çπ„É≠„ÉÉ„Éà2</button>
                    <button class="decor-slot-btn" data-slot="2">„Çπ„É≠„ÉÉ„Éà3</button>
                </div>
                <div class="decor-items-ui" id="closet-decors"></div>
                <div class="small-note">‚ÄªÁîªÈù¢‰∏ä„ÅßÈ£æ„Çä„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶Ëá™Áî±„Å´ÈÖçÁΩÆ„Åß„Åç„Åæ„Åô</div>
            </div>
            
            <button id="close-closet-btn">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <!-- „É¶„Éº„Ç∂„Éº„Éç„Éº„É†ÂÖ•Âäõ„É¢„Éº„ÉÄ„É´ -->
    <div id="username-modal">
        <div id="username-modal-content">
            <div id="username-modal-title">„É¶„Éº„Ç∂„Éº„Éç„Éº„É†Ë®≠ÂÆö</div>
            <input type="text" id="username-input" maxlength="6" placeholder="ÂêçÂâç„ÇíÂÖ•ÂäõÔºà6ÊñáÂ≠ó„Åæ„ÅßÔºâ">
            <div id="username-char-count">0 / 6</div>
            <button id="username-save-btn">‰øùÂ≠ò</button>
            <button id="username-cancel-btn">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>
    
    <!-- „É©„É≥„ÇØÁâπÂÖ∏„É¢„Éº„ÉÄ„É´ -->
    <div id="rank-modal">
        <div id="rank-modal-content">
            <div id="rank-modal-title">„É©„É≥„ÇØÁâπÂÖ∏</div>
            
            <div class="reward-section">
                <div class="reward-title">üé® „Ç≠„É£„É©„ÇØ„Çø„ÉºÂ§âÊõ¥</div>
                <div class="reward-grid">
                    <div class="reward-item active" data-type="character" data-value="üåö" data-rank="1">
                        <div class="reward-icon">üåö</div>
                        <div class="reward-name">„Åä„Å®„Äú„Åµ</div>
                        <div class="reward-unlock">„Éá„Éï„Ç©„É´„Éà</div>
                    </div>
                    <div class="reward-item locked" data-type="character" data-value="üêµ" data-rank="5">
                        <div class="reward-icon">üêµ</div>
                        <div class="reward-name">„É¢„É≥„Ç≠„Éº</div>
                        <div class="reward-locked">Rank 5„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="character" data-value="ü§°" data-rank="10">
                        <div class="reward-icon">ü§°</div>
                        <div class="reward-name">„Éî„Ç®„É≠</div>
                        <div class="reward-locked">Rank 10„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="character" data-value="üåù" data-rank="20">
                        <div class="reward-icon">üåù</div>
                        <div class="reward-name">„É†„Éº„É≥</div>
                        <div class="reward-locked">Rank 20„ÅßËß£Á¶Å</div>
                    </div>
                </div>
            </div>
            
            <div class="reward-section">
                <div class="reward-title">üåÖ ËÉåÊôØÂ§âÊõ¥</div>
                <div class="reward-grid">
                    <div class="reward-item active" data-type="background" data-value="night" data-rank="1">
                        <div class="reward-icon">üåô</div>
                        <div class="reward-name">Â§úÁ©∫</div>
                        <div class="reward-unlock">„Éá„Éï„Ç©„É´„Éà</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="city" data-rank="15">
                        <div class="reward-icon">üåÜ</div>
                        <div class="reward-name">Â§ïÊöÆ„Çå</div>
                        <div class="reward-locked">Rank 15„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="rainbow" data-rank="20">
                        <div class="reward-icon">üåà</div>
                        <div class="reward-name">Ëôπ</div>
                        <div class="reward-locked">Rank 20„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="cosmos" data-rank="100">
                        <div class="reward-icon">üí´</div>
                        <div class="reward-name">„Ç≥„Çπ„É¢</div>
                        <div class="reward-locked">Rank 100„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="matrix" data-rank="200">
                        <div class="reward-icon">üî∑</div>
                        <div class="reward-name">„Éû„Éà„É™„ÉÉ„ÇØ„Çπ</div>
                        <div class="reward-locked">Rank 200„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="aqua" data-rank="300">
                        <div class="reward-icon">üíß</div>
                        <div class="reward-name">„Ç¢„ÇØ„Ç¢</div>
                        <div class="reward-locked">Rank 300„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="metro" data-rank="400">
                        <div class="reward-icon">üèôÔ∏è</div>
                        <div class="reward-name">„É°„Éà„É≠„Éù„É™„Çπ</div>
                        <div class="reward-locked">Rank 400„ÅßËß£Á¶Å</div>
                    </div>
                    <div class="reward-item locked" data-type="background" data-value="hacker" data-rank="500">
                        <div class="reward-icon">üíª</div>
                        <div class="reward-name">„Éè„ÉÉ„Ç´„Éº</div>
                        <div class="reward-locked">Rank 500„ÅßËß£Á¶Å</div>
                    </div>
                </div>
            </div>
            
            <button id="close-modal-btn">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <!-- „Éü„ÉÉ„Ç∑„Éß„É≥„É¢„Éº„ÉÄ„É´ -->
    <div id="mission-modal">
        <div id="mission-modal-content">
            <div id="mission-modal-title">
                „Éü„ÉÉ„Ç∑„Éß„É≥
                <button id="claim-all-missions-btn" style="float: right; font-size: 14px; padding: 5px 12px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-weight: bold;">‰∏ÄÊã¨</button>
            </div>
            <div id="mission-list"></div>
            <button id="close-mission-btn">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <!-- Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
    <div id="settings-modal">
        <div id="settings-modal-content">
            <div id="settings-modal-title">‚öôÔ∏è Ë®≠ÂÆö</div>
            
            <div class="settings-section">
                <div class="settings-section-title">üîä Èü≥ÈáèË™øÊï¥</div>
                
            <div class="settings-section">
                
                <div class="settings-section-title">üéµ BGM</div>
                <div class="bgm-dropdown">
                    <button class="bgm-current" id="bgmCurrentBtn" type="button">
                        <span class="bgm-current-label" id="bgmCurrentLabel">„Éá„Éï„Ç©„É´„Éà</span>
                        <span class="bgm-current-caret">‚ñæ</span>
                    </button>
                    <div class="bgm-list" id="bgmList" aria-hidden="true">
                        <button class="bgm-item" data-bgm="default" type="button">„Éá„Éï„Ç©„É´„Éà</button>
                        <button class="bgm-item" data-bgm="bgm2" type="button">BGM2</button>
                        <button class="bgm-item" data-bgm="bgm3" type="button">BGM3</button>
                        <button class="bgm-item" data-bgm="bgm4" type="button">BGM4</button>
                        <button class="bgm-item" data-bgm="off" type="button">„Ç™„Éï</button>
                    </div>
                </div>
            </div>
            
<div class="volume-control">
                    <label>BGM</label>
                    <input type="range" id="bgm-volume" min="0" max="100" value="15">
                    <span id="bgm-volume-text">15%</span>
                </div>
                <div class="volume-control">
                    <label>ÂäπÊûúÈü≥</label>
                    <input type="range" id="se-volume" min="0" max="100" value="100">
                    <span id="se-volume-text">100%</span>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">üíæ „Çª„Éº„Éñ„Éá„Éº„Çø</div>
                <div class="save-buttons">
                    <button id="export-save-btn">üì§ Êõ∏„ÅçÂá∫„Åô</button>
                    <button id="import-save-btn">üì• Âèñ„ÇäËæº„ÇÄ</button>
                </div>
                <textarea id="save-textarea" placeholder="„Çª„Éº„Éñ„Éá„Éº„Çø„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô"></textarea>
                <div class="save-note">‚Äª „Çª„Éº„Éñ„Éá„Éº„Çø„ÇíÊõ∏„ÅçÂá∫„Åó„Å¶‰øùÂ≠ò„Åó„Å¶„Åä„Åë„Å∞„ÄÅ„Ç≤„Éº„É†„Éï„Ç°„Ç§„É´„ÇíÊõ¥Êñ∞„Åó„Å¶„ÇÇÂºï„ÅçÁ∂ô„Åí„Åæ„Åô</div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">üéÅ „Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ</div>
                <div class="serial-input-container">
                    <input type="text" id="serial-input" placeholder="„Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ">
                    <button id="serial-submit-btn">ÈÅ©Áî®</button>
                </div>
                <div id="serial-message"></div>
            </div>
            
            <button id="close-settings-btn">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <!-- „Ç∑„Éß„ÉÉ„Éó„É¢„Éº„ÉÄ„É´ -->
    <div id="shop-modal">
        <div id="shop-modal-content">
            <div id="shop-modal-title">üõí „Ç∑„Éß„ÉÉ„Éó</div>
            
            <div class="shop-section">
                <div class="shop-section-title">üíé „ÉÄ„Ç§„É§„Å´‰∫§Êèõ</div>
                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üíé</div>
                        <div>
                            <div class="shop-item-name">„ÉÄ„Ç§„É§ √ó 1</div>
                            <div class="shop-item-price">‚≠êÔ∏è 30ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-diamond-btn">Ë≥ºÂÖ•</button>
                </div>
            </div>
            
            <div class="shop-section">
                <div class="shop-section-title">üé≠ „Ç≠„É£„É©„ÇØ„Çø„Éº</div>
                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üòé</div>
                        <div>
                            <div class="shop-item-name">„ÇØ„Éº„É´</div>
                            <div class="shop-item-price">‚≠êÔ∏è 100ÂÄã</div>
                            <div class="shop-item-note">Êòü: ü§òüçæ</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-cool-btn">Ë≥ºÂÖ•</button>
                </div>
                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">ü¶Ñ</div>
                        <div>
                            <div class="shop-item-name">„É¶„Éã„Ç≥„Éº„É≥</div>
                            <div class="shop-item-price">üíé 10ÂÄã</div>
                            <div class="shop-item-note">Êòü: üó°Ô∏èüõ°Ô∏è</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-unicorn-btn">Ë≥ºÂÖ•</button>
                </div>
            </div>
            
            <div class="shop-section">
                <div class="shop-section-title">üåÖ ËÉåÊôØ</div>
                
                <!-- ‚≠êÔ∏è„Çπ„Çø„Éº„ÅßË≥ºÂÖ• -->
                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üí∞</div>
                        <div>
                            <div class="shop-item-name">„Éû„Éç„Éº</div>
                            <div class="shop-item-price">‚≠êÔ∏è 200ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-money-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">ü¶ã</div>
                        <div>
                            <div class="shop-item-name">„É¢„É´„Éï„Ç©Ëù∂</div>
                            <div class="shop-item-price">‚≠ê 200ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-morpho-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üçü</div>
                        <div>
                            <div class="shop-item-name">„Éù„ÉÜ„Éà</div>
                            <div class="shop-item-price">‚≠ê 200ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-fries-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <!-- üíé„ÉÄ„Ç§„É§„ÅßË≥ºÂÖ• -->
                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">ü•Ç</div>
                        <div>
                            <div class="shop-item-name">„Ç∑„É£„É≥„Éë„É≥</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-champagne-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">ü™©</div>
                        <div>
                            <div class="shop-item-name">„Éü„É©„Éº„Éú„Éº„É´</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-disco-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üèùÔ∏è</div>
                        <div>
                            <div class="shop-item-name">Êµ∑</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-sea-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üíç</div>
                        <div>
                            <div class="shop-item-name">„Ç∏„É•„Ç®„É´</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-jewel-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üÉè</div>
                        <div>
                            <div class="shop-item-name">„Éà„É©„É≥„Éó</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-cards-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üç¨</div>
                        <div>
                            <div class="shop-item-name">„Éç„Ç™„É≥</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-neoncandy-bg-btn">Ë≥ºÂÖ•</button>
                </div>

                <div class="shop-item">
                    <div class="shop-item-info">
                        <div class="shop-item-icon">üé≤</div>
                        <div>
                            <div class="shop-item-name">„É©„É≥„ÉÄ„É†</div>
                            <div class="shop-item-price">üíé 20ÂÄã</div>
                        </div>
                    </div>
                    <button class="shop-buy-btn" id="buy-dice-bg-btn">Ë≥ºÂÖ•</button>
                </div>

            </div>
            
            <button id="close-shop-btn">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <!-- Ë≥ºÂÖ•Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <div id="confirm-modal">
        <div id="confirm-modal-content">
            <div id="confirm-modal-title">Ë≥ºÂÖ•Á¢∫Ë™ç</div>
            <div id="confirm-modal-message"></div>
            <div id="confirm-modal-buttons">
                <button id="confirm-yes-btn" class="confirm-btn">„ÅØ„ÅÑ</button>
                <button id="confirm-no-btn" class="confirm-btn">„ÅÑ„ÅÑ„Åà</button>
            </div>
        </div>
    </div>

    <!-- BGM -->
    <audio id="bgm" loop>
        <source src="orb2.mp3" type="audio/mpeg">
    </audio>

    <script>

// „ÇØ„É™„ÉÉ„ÇØÂâç„ÅÆËá™ÂãïÂÜçÁîüÂà∂Èôê„ÅßÊ≠¢„Åæ„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´„Ç¨„Éº„Éâ
function safePlay(audioEl){
  if (!audioEl) return;
  const p = audioEl.play();
  if (p && typeof p.catch === 'function') p.catch(()=>{});
}


// ===== file:// „Åß„ÇÇËêΩ„Å°„Å™„ÅÑÂÆâÂÖ®„Å™„Çπ„Éà„É¨„Éº„Ç∏ =====
const safeStorage = (() => {
  try {
    const k = '__otofu_test__';
    window.localStorage.setItem(k, '1');
    window.localStorage.removeItem(k);
    return window.localStorage;
  } catch (e) {
    // file:// „ÇÑ„Éó„É©„Ç§„Éô„Éº„ÉàË®≠ÂÆö„Åß localStorage „Åå‰Ωø„Åà„Å™„ÅÑÁí∞Â¢ÉÂêë„Åë
    const mem = {};
    return {
      getItem: (key) => (key in mem ? mem[key] : null),
      setItem: (key, val) => { mem[key] = String(val); },
      removeItem: (key) => { delete mem[key]; }
    };
  }
})();

        // BGMÂà∂Âæ°
        const bgm = document.getElementById('bgm');

        // iOS/Android„ÅßÈü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº„ÅåÁ¢∫ÂÆü„Å´Âäπ„Åè„Çà„ÅÜ„Å´„ÄÅWebAudio„ÅÆGain„ÅßÂà∂Âæ°„Åô„Çã
        // ÔºàHTMLAudioElement.volume „ÅØÁí∞Â¢É„Å´„Çà„Å£„Å¶ÂèçÊò†„Åï„Çå„Å™„ÅÑ„Åì„Å®„Åå„ÅÇ„ÇãÔºâ
        let bgmContext = null;
        let bgmGain = null;

        let seContext = null;
        let seMasterGain = null;

        function initAudioGraph() {
            // BGM
            if (!bgmContext && bgm) {
                bgmContext = new (window.AudioContext || window.webkitAudioContext)();
                bgmGain = bgmContext.createGain();

                const saved = safeStorage.getItem('bgmVolume');
                const v = (saved !== null ? parseFloat(saved) : 15) / 100;
                bgmGain.gain.value = isFinite(v) ? v : 0.15;

                const src = bgmContext.createMediaElementSource(bgm);
                src.connect(bgmGain);
                bgmGain.connect(bgmContext.destination);

                // ÂÆüÈöõ„ÅÆÈü≥Èáè„ÅØ bgmGain „ÅßË™øÊï¥„Åô„Çã„ÅÆ„Åß„ÄÅË¶ÅÁ¥†ÂÅ¥„ÅØÊúÄÂ§ß„Å´
                bgm.volume = 1;
            }

            // ÂäπÊûúÈü≥ÔºàBGM„Å®Âêå„ÅòContext„Çí‰Ωø„ÅÜÔºâ
            if (!seContext) {
                seContext = bgmContext || new (window.AudioContext || window.webkitAudioContext)();
                seMasterGain = seContext.createGain();

                const saved = safeStorage.getItem('seVolume');
                const v = (saved !== null ? parseFloat(saved) : 100) / 100;
                seMasterGain.gain.value = isFinite(v) ? v : 1.0;

                seMasterGain.connect(seContext.destination);
            }
        }

        function resumeAudio() {
            initAudioGraph();
            [bgmContext, seContext].forEach(ctx => {
                if (ctx && ctx.state === 'suspended') ctx.resume().catch(() => {});
            });
        }

        
        // „É¶„Éº„Ç∂„ÉºÊìç‰ΩúÂæå„Å´BGMÂÜçÁîü„ÇíÈñãÂßã
        let bgmStarted = false;
        function startBGM() {
            // „É¶„Éº„Ç∂„ÉºÊìç‰Ωú„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„ÅßAudioContext„ÇíËµ∑Âãï
            resumeAudio();

            if (!bgm) return;

            // „Åô„Åß„Å´ÈñãÂßãÊ∏à„Åø„Åß„ÇÇ„ÄÅimportÁ≠â„ÅßÊ≠¢„Åæ„Å£„Å¶„ÅÑ„Åü„ÇâÂøÖ„ÅöÂÜçÈñã„Åô„Çã
            if (bgm.paused || bgm.ended) {
                bgm.play().catch(() => {});
            }
            bgmStarted = true;
        }

// ÊúÄÂàù„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÅßBGMÈñãÂßã
        document.addEventListener('click', startBGM, { once: true });
        document.addEventListener('touchstart', startBGM, { once: true });
        
        // ÂäπÊûúÈü≥Èü≥Èáè
        let seVolume = 1.0;
        
        
        // ===== BGM ÈÅ∏ÊäûÔºàË®≠ÂÆö„É¢„Éº„ÉÄ„É´Ôºâ=====
        const bgmTracks = {
            default: 'orb2.mp3',
            bgm2: 'bgm2.mp3',
            bgm3: 'bgm3.mp3',
            bgm4: 'bgm4.mp3',
            off: null
        };
        let currentBgmTrack = 'default';

        // ‰øùÂ≠òÊ∏à„ÅøBGM„Éà„É©„ÉÉ„ÇØ„ÇíÈÅ©Áî®
        const savedTrack = safeStorage.getItem('bgmTrack');
        if (savedTrack && (savedTrack in bgmTracks)) {
            currentBgmTrack = savedTrack;
        }

        function setBgmTrack(key){
            currentBgmTrack = key;

            const bgmEl = document.getElementById('bgm');
            const srcEl = bgmEl ? bgmEl.querySelector('source') : null;
            if (!bgmEl || !srcEl) return;

            if (key === 'off' || !bgmTracks[key]){
                bgmEl.pause();
                // ‰ΩçÁΩÆ„ÅØÁ∂≠ÊåÅ„Åõ„ÅöÊ≠¢„ÇÅ„Çã
                bgmEl.currentTime = 0;
            } else {
                srcEl.src = bgmTracks[key];
                // „ÇΩ„Éº„ÇπÊõ¥Êñ∞„ÇíÂèçÊò†
                bgmEl.load();
                // „É¶„Éº„Ç∂„ÉºÊìç‰ΩúÂæå„Å´ startBGM „ÅåËµ∞„ÇãË®≠Ë®à„ÇíÂ£ä„Åï„Å™„ÅÑ
                // „Åô„Åß„Å´ÂÜçÁîüÂèØËÉΩ„Å™„Çâ„Åù„ÅÆÂ†¥„ÅßÂÜçÈñã„ÇÇË©¶„Åø„Çã
                startBGM();
            }

            try{ safeStorage.setItem('bgmTrack', currentBgmTrack); }catch(e){}
            updateBgmSelectUI();
        }

        function updateBgmSelectUI(){
            const labelMap = {
                default: '„Éá„Éï„Ç©„É´„Éà',
                bgm2: 'BGM2',
                bgm3: 'BGM3',
                bgm4: 'BGM4',
                off: '„Ç™„Éï'
            };
            const labelEl = document.getElementById('bgmCurrentLabel');
            if (labelEl) labelEl.textContent = labelMap[currentBgmTrack] || '„Éá„Éï„Ç©„É´„Éà';

            document.querySelectorAll('.bgm-item').forEach(btn=>{
                btn.classList.toggle('active', btn.dataset.bgm === currentBgmTrack);
            });
        }

// Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const bgmVolumeSlider = document.getElementById('bgm-volume');
        const bgmVolumeText = document.getElementById('bgm-volume-text');
        const seVolumeSlider = document.getElementById('se-volume');
        const seVolumeText = document.getElementById('se-volume-text');
        const exportSaveBtn = document.getElementById('export-save-btn');
        const importSaveBtn = document.getElementById('import-save-btn');
        const saveTextarea = document.getElementById('save-textarea');
        
        // ‰øùÂ≠ò„Åï„Çå„ÅüÈü≥ÈáèË®≠ÂÆö„ÇíÂÖà„Å´Ë™≠„ÅøËæº„ÇÄ
        const savedBgmVolume = safeStorage.getItem('bgmVolume');
        if (savedBgmVolume !== null) {
            bgmVolumeSlider.value = savedBgmVolume;
            // bgm.volume „ÅØÁí∞Â¢ÉÂ∑Æ„Åå„ÅÇ„Çã„ÅÆ„Åß„ÄÅÂÆüÈü≥Èáè„ÅØWebAudio(Gain)„ÅßÂà∂Âæ°
            bgm.volume = 1;
            bgmVolumeText.textContent = savedBgmVolume + '%';
        } else {
            // ÂàùÂõû„ÅØ„Éá„Éï„Ç©„É´„Éà15%
            bgm.volume = 1;
            bgmVolumeSlider.value = 15;
            bgmVolumeText.textContent = '15%';
        }
        
        const savedSeVolume = safeStorage.getItem('seVolume');
        if (savedSeVolume !== null) {
            seVolumeSlider.value = savedSeVolume;
            seVolume = savedSeVolume / 100;
            seVolumeText.textContent = savedSeVolume + '%';
        }
        
        
        
        
        /* bind bgm dropdown */
        const bgmCurrentBtn = document.getElementById('bgmCurrentBtn');
        const bgmListEl = document.getElementById('bgmList');

        function closeBgmList(){
            if (!bgmListEl) return;
            bgmListEl.classList.remove('open');
            bgmListEl.setAttribute('aria-hidden','true');
        }
        function toggleBgmList(){
            if (!bgmListEl) return;
            const open = bgmListEl.classList.toggle('open');
            bgmListEl.setAttribute('aria-hidden', open ? 'false' : 'true');
        }

        if (bgmCurrentBtn){
            bgmCurrentBtn.addEventListener('click', (e)=>{
                e.stopPropagation();
                toggleBgmList();
            });
        }

        document.querySelectorAll('.bgm-item').forEach(btn=>{
            btn.addEventListener('click', (e)=>{
                e.stopPropagation();
                setBgmTrack(btn.dataset.bgm);
                closeBgmList();
            });
        });

        // „É¢„Éº„ÉÄ„É´ÂÜÖ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Å§„Å§„ÄÅÂ§ñÂÅ¥„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', ()=> closeBgmList());

        // Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        settingsBtn.addEventListener('click', () => {
            settingsModal.classList.add('show');
            settingsBtn.style.display = 'none';
        });
        
        // Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        closeSettingsBtn.addEventListener('click', () => {
            settingsModal.classList.remove('show');
            settingsBtn.style.display = 'flex';
        });
        
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.classList.remove('show');
                settingsBtn.style.display = 'flex';
            }
        });
        
        // BGMÈü≥ÈáèË™øÊï¥
        bgmVolumeSlider.addEventListener('input', (e) => {
            const volume = e.target.value / 100;
            if (bgmGain) {
                bgmGain.gain.value = volume;
            } else if (bgm) {
                bgm.volume = volume;
            }
            bgmVolumeText.textContent = e.target.value + '%';
            safeStorage.setItem('bgmVolume', e.target.value);
        });
        
        bgmVolumeSlider.addEventListener('change', (e) => {
            const volume = e.target.value / 100;
            if (bgmGain) {
                bgmGain.gain.value = volume;
            } else if (bgm) {
                bgm.volume = volume;
            }
            bgmVolumeText.textContent = e.target.value + '%';
            safeStorage.setItem('bgmVolume', e.target.value);
        });
        
        // ÂäπÊûúÈü≥Èü≥ÈáèË™øÊï¥
        seVolumeSlider.addEventListener('input', (e) => {
            seVolume = e.target.value / 100;
            if (seMasterGain) seMasterGain.gain.value = seVolume;
            seVolumeText.textContent = e.target.value + '%';
            safeStorage.setItem('seVolume', e.target.value);
        });
        
        seVolumeSlider.addEventListener('change', (e) => {
            seVolume = e.target.value / 100;
            if (seMasterGain) seMasterGain.gain.value = seVolume;
            seVolumeText.textContent = e.target.value + '%';
            safeStorage.setItem('seVolume', e.target.value);
        });
        
        // „Çª„Éº„Éñ„Éá„Éº„ÇøÊõ∏„ÅçÂá∫„Åó
        exportSaveBtn.addEventListener('click', () => {
            const saveData = safeStorage.getItem('otofuGameData') || '';
            saveTextarea.value = saveData;
            saveTextarea.select();
        });
        
        // „Çª„Éº„Éñ„Éá„Éº„ÇøÂèñ„ÇäËæº„Åø
        importSaveBtn.addEventListener('click', () => {
            const data = saveTextarea.value.trim();
            if (!data) {
                settingsModal.classList.remove('show');
                settingsBtn.style.display = 'flex';
                showDialogue('„Çª„Éº„Éñ„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', true);
                return;
            }
            try {
                // Êñ∞ÂΩ¢ÂºèÔºà3, V2_, V1_„ÅßÂßã„Åæ„ÇãÔºâ„ÅãÊóßÂΩ¢ÂºèÔºàJSON„Åù„ÅÆ„Åæ„ÅæÔºâ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (data.startsWith(SAVE_VERSION) || data.startsWith(SAVE_VERSION_V2) || data.startsWith(SAVE_VERSION_V1)) {
                    // Êñ∞ÂΩ¢ÂºèÔºö„Åù„ÅÆ„Åæ„Åæ‰øùÂ≠ò„Åó„Å¶Ë™≠„ÅøËæº„Åø
                    safeStorage.setItem('otofuGameData', data);
                } else {
                    // ÊóßÂΩ¢ÂºèÔºöJSONÊ§úË®º„Åó„Å¶„Åã„Çâ‰øùÂ≠ò
                    const parsedData = JSON.parse(data);
                    
                    if (typeof parsedData !== 'object' || parsedData === null) {
                        throw new Error('ÁÑ°Âäπ„Å™„Éá„Éº„Çø');
                    }
                    
                    safeStorage.setItem('otofuGameData', data);
                }
                
                try {
                    loadGameData();
                    refreshUIFromState();
                } catch (e) {
                    settingsModal.classList.remove('show');
                    settingsBtn.style.display = 'flex';
                    showDialogue('„Çª„Éº„Éñ„Éá„Éº„Çø„ÅÆÂèñ„ÇäËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', true);
                    return;
                }
                
                startBGM();
                
                settingsModal.classList.remove('show');
                settingsBtn.style.display = 'flex';
                
                showDialogue('„Çª„Éº„Éñ„Éá„Éº„Çø„ÇíÂèñ„ÇäËæº„Åø„Åæ„Åó„ÅüÔºÅ', true);

            } catch (e) {
                settingsModal.classList.remove('show');
                settingsBtn.style.display = 'flex';
                showDialogue('„Çª„Éº„Éñ„Éá„Éº„Çø„ÅÆÂèñ„ÇäËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', true);
            }
        });
        
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let lastInteraction = Date.now();
        let isAnimating = false;
        let startDate = null;
        let collectedStars = 10;
        let maxStars = 999;
        let lastStarRegenTime = Date.now();
        let collectibleStarsArray = [];

let bonusMoonActive = false;
        let lastBonusMoonTime = 0;
        let bonusGiftActive = false;
        let lastBonusGiftTime = 0;
        
        // „ÉÄ„Ç§„É§„Ç∑„Çπ„ÉÜ„É†
        let collectedDiamonds = 0;
        let maxDiamonds = 99;
        let diamondSpawnedToday = 0; // ‰ªäÊó•Âá∫Áèæ„Åó„Åü„ÉÄ„Ç§„É§„ÅÆÊï∞
        let lastDiamondSpawnDate = null;
        
        // „Çπ„Ç≠„É´„Ç∑„Çπ„ÉÜ„É†
        let skillDiamondLevel = 0; // „ÉÄ„Ç§„É§Âá∫ÁèæÊï∞+1 (MAX 5)
        let skillSpeedLevel = 0;   // ÊòüÈñìÈöîÁü≠Á∏Æ (MAX 5, ÊúÄÂ§ß2.5ÁßíÁü≠Á∏Æ)
        let skillBonusLevel = 0;   // „Éú„Éº„Éä„ÇπÂá∫ÁèæÁ¢∫ÁéáUP (MAX 5, 1.5ÂÄç„Åæ„Åß)
        const maxSkillLevel = 5;
        
        // ÊîæÁΩÆÂ†±ÈÖ¨„Ç∑„Çπ„ÉÜ„É†
        let lastPlayTime = Date.now();
        let idleRewardClaimed = true; // Â†±ÈÖ¨„ÇíÂèó„ÅëÂèñ„Å£„Åü„Åã„Å©„ÅÜ„Åã
        
        // Áß∞Âè∑„Ç∑„Çπ„ÉÜ„É†
        let currentTitle = 'newcomer';
        let unlockedTitles = ['newcomer'];
        let titleProgress = {
            pixivCount: 0,
            talkCount: 0,
            shopPurchaseCount: 0,
            totalDiamonds: 0,
            totalStars: 0
        };
        
        const titles = {
            newcomer: { name: 'Êñ∞Êòü', color: '#FFD700', condition: '„Éá„Éï„Ç©„É´„Éà', requirement: null },
            pervert1: { name: '„Çπ„Ç±„Éô', color: '#FFB3D9', condition: 'pixiv„Çí500ÂõûË¶ã„Åõ„Çã', requirement: { type: 'pixiv', count: 500 } },
            pervert2: { name: 'Â§âÊÖã', color: 'rainbow', condition: 'pixiv„Çí1000ÂõûË¶ã„Åõ„Çã', requirement: { type: 'pixiv', count: 1000 } },
            pervert3: { name: '„Åä„Åò„Åï„Çì', color: 'gradient-white', condition: 'pixiv„Çí2000ÂõûË¶ã„Åõ„Çã', requirement: { type: 'pixiv', count: 2000 } },
            friend: { name: '„Åä„Å®„Äú„Åµ„ÅÆÂèã‰∫∫', color: '#90EE90', condition: '2000ÂõûË©±„Åó„Åã„Åë„Çã', requirement: { type: 'talk', count: 2000 } },
            caretaker: { name: '„Åä„Å®„Äú„Åµ„ÅÆ‰ªãË≠∑Â£´', color: '#90EE90', condition: '3000ÂõûË©±„Åó„Åã„Åë„Çã', requirement: { type: 'talk', count: 3000 } },
            stalker: { name: '„Çπ„Éà„Éº„Ç´„Éº', color: 'rainbow', condition: '5000ÂõûË©±„Åó„Åã„Åë„Çã', requirement: { type: 'talk', count: 5000 } },
            bestfriend: { name: '„Åä„Å®„Äú„Åµ„ÅÆË¶™Âèã', color: 'gradient-white', condition: '10000ÂõûË©±„Åó„Åã„Åë„Çã', requirement: { type: 'talk', count: 10000 } },
            lazy: { name: 'Êöá‰∫∫', color: '#90EE90', condition: '„É©„É≥„ÇØ200Âà∞ÈÅî', requirement: { type: 'rank', count: 200 } },
            neet: { name: '„Éã„Éº„Éà', color: 'rainbow', condition: '„É©„É≥„ÇØ300Âà∞ÈÅî', requirement: { type: 'rank', count: 300 } },
            serious: { name: '„Ç¨„ÉÅÂã¢', color: 'gradient-white', condition: '„É©„É≥„ÇØ400Âà∞ÈÅî', requirement: { type: 'rank', count: 400 } },
            sun: { name: 'Â§™ÈôΩ', color: 'gradient-white', condition: '„É©„É≥„ÇØ500Âà∞ÈÅî', requirement: { type: 'rank', count: 500 } },
            nolife: { name: 'ÂªÉ‰∫∫', color: 'rainbow', condition: '„Çπ„Ç≠„É´„ÇíÂÖ®„Å¶Lv5', requirement: { type: 'skillMax', count: 1 } },
            rich: { name: 'Áü≥Ê≤πÁéã', color: '#FFD700', condition: '„Ç∑„Éß„ÉÉ„Éó„Åß10ÂõûË≥ºÂÖ•', requirement: { type: 'shop', count: 10 } },
            diamond: { name: '„ÉÄ„Ç§„É§„É¢„É≥„Éâ', color: 'gradient-white', condition: '„ÉÄ„Ç§„É§„ÇíÂêàË®à300ÂÄãÁç≤Âæó', requirement: { type: 'diamondTotal', count: 300 } },
            star: { name: '‰∏ÄÁ≠âÊòü', color: 'gradient-white', condition: '„Çπ„Çø„Éº„ÇíÂêàË®à5000ÂÄãÁç≤Âæó', requirement: { type: 'starTotal', count: 5000 } },
            hero: { name: 'ÂãáËÄÖ', color: '#4169E1', condition: 'ËÉåÊôØ„Çí20ÂÄãÊâÄÊåÅ', requirement: { type: 'background', count: 20 } },
            demonlord: { name: 'È≠îÁéã', color: '#9370DB', condition: '„Ç≠„É£„É©„Çí15ÂÄãÊâÄÊåÅ', requirement: { type: 'character', count: 15 } }
        };
        
        
        // „ÉÜ„Çπ„Éà„É¢„Éº„ÉâÂà§ÂÆö
        function isTestMode() { return username === '„ÉÜ„Çπ„Éà'; }
        let lastCommandTime = 0;
        let commandCooldown = 500;
        
        // ÁµåÈ®ìÂÄ§„Éª„É©„É≥„ÇØ„Ç∑„Çπ„ÉÜ„É†
        let experience = 0;
        let rank = 1;
        const maxRank = 500;
        
        // „É©„É≥„ÇØÁâπÂÖ∏Ë®≠ÂÆö
        let currentCharacter = 'üåö';
        let currentBackground = 'night';
        let username = 'ÂêçÂâç„ÇíÂÖ•Âäõ';
        
        // „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥ÔºàÁç≤Âæó„Åó„Åü„Ç¢„Ç§„ÉÜ„É†Ôºâ
        let unlockedCharacters = ['üåö']; // „Éá„Éï„Ç©„É´„Éà„Åßüåö„ÅØÊâÄÊåÅ
        let unlockedBackgrounds = ['night']; // „Éá„Éï„Ç©„É´„Éà„ÅßÂ§úÁ©∫„ÅØÊâÄÊåÅ
        let ownedDecor = {}; // È£æ„Çä„Ç§„É≥„Éô„É≥„Éà„É™ÔºàÂõ∫ÊúâÔºâ
        let equippedDecor = [null, null, null]; // Ë£ÖÂÇô‰∏≠„ÅÆÈ£æ„ÇäÔºà3„Å§„Åæ„ÅßÔºâ
        let decorPlacements = [null, null, null]; // È£æ„Çä„ÅÆ‰ΩçÁΩÆÊÉÖÂ†± {x:0..1, y:0..1}
        
        // „Éü„ÉÉ„Ç∑„Éß„É≥„Ç∑„Çπ„ÉÜ„É†
        let missionProgress = {
            talkCount: 0,
            pixivCount: 0
        };
        let claimedMissions = [];
        
        // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„Ç∑„Çπ„ÉÜ„É†
        let dailyMissions = [];
        let dailyClaimedMissions = [];
        let dailyMissionProgress = {
            dailyTalkCount: 0,
            dailyPixivCount: 0,
            openedGacha: false,
            changedDecor: false
        };
        let lastDailyResetDate = null;
        
        // „Ç¨„ÉÅ„É£„Ç¢„Ç§„ÉÜ„É†ÂÆöÁæ©
        const gachaCharacters = [
            { emoji: 'üê∏', name: '„Ç´„Ç®„É´', rarity: 'common' },
            { emoji: 'ü¶≠', name: '„Ç¢„Ç∂„É©„Ç∑', rarity: 'common' },
            { emoji: 'üí©', name: '„ÅÜ„Çì„Å°', rarity: 'common' },
            { emoji: 'üëÅÔ∏è', name: '„Ç¢„Ç§', rarity: 'rare' },
            { emoji: 'ü¶ß', name: '„Ç™„É©„É≥„Ç¶„Éº„Çø„É≥', rarity: 'rare' },
            { emoji: 'ü•∫', name: '„Å¥„Åà„Çì', rarity: 'rare' },
            { emoji: 'üëπ', name: '„Ç™„Éã', rarity: 'sr' },
            { emoji: 'üëΩ', name: '„Ç®„Ç§„É™„Ç¢„É≥', rarity: 'sr' },
            { emoji: 'üê≤', name: '„Éâ„É©„Ç¥„É≥', rarity: 'ssr' },
            { emoji: 'üåû', name: '„Çµ„É≥', rarity: 'ssr' },
            { emoji: 'üòé', name: '„ÇØ„Éº„É´', rarity: 'shop' },
            { emoji: 'ü¶Ñ', name: '„É¶„Éã„Ç≥„Éº„É≥', rarity: 'shop' }
        ];
        
        const gachaBackgrounds = [
            { id: 'cards', name: '„Éà„É©„É≥„Éó', emoji: 'üÉè', rarity: 'shop' },
            { id: 'neoncandy', name: '„Éç„Ç™„É≥', emoji: 'üç¨', rarity: 'shop' },
            { id: 'fries', name: '„Éù„ÉÜ„Éà', emoji: 'üçü', rarity: 'shop' },
            { id: 'dice', name: '„É©„É≥„ÉÄ„É†', emoji: 'üé≤', rarity: 'shop' },
            { id: 'champagne', name: '„Ç∑„É£„É≥„Éë„É≥', emoji: 'ü•Ç', rarity: 'shop' },
            { id: 'disco', name: '„Éü„É©„Éº„Éú„Éº„É´', emoji: 'ü™©', rarity: 'shop' },
            { id: 'sea', name: 'Êµ∑', emoji: 'üèùÔ∏è', rarity: 'shop' },
            { id: 'morpho', name: '„É¢„É´„Éï„Ç©Ëù∂', emoji: 'ü¶ã', rarity: 'shop' },
            { id: 'snow', name: 'Èõ™ÊôØËâ≤', emoji: '‚ùÑÔ∏è', rarity: 'common' },
            { id: 'sakura', name: 'Ê°ú‰∏¶Êú®', emoji: 'üå∏', rarity: 'rare' },
            { id: 'forest', name: 'Ê£Æ', emoji: 'üå≤', rarity: 'rare' },
            { id: 'lava', name: 'Ê∫∂Â≤©', emoji: 'üî•', rarity: 'sr' },
            { id: 'music', name: 'Èü≥Ê•Ω', emoji: 'üéπ', rarity: 'sr' },
            { id: 'dream', name: 'Â§¢', emoji: 'üõå', rarity: 'ssr' },
            { id: 'aurora', name: '„Ç™„Éº„É≠„É©', emoji: 'üåå', rarity: 'ssr' },
            { id: 'rain', name: 'Èõ®', emoji: 'üåßÔ∏è', rarity: 'ssr' },
            { id: 'earth', name: 'Âú∞ÁêÉ', emoji: 'üåè', rarity: 'ssr' },
            { id: 'toilet', name: '„Éà„Ç§„É¨', emoji: 'üöΩ', rarity: 'ssr' },
            { id: 'love', name: 'ÊÅã', emoji: 'üíï', rarity: 'ssr' },
            { id: 'jellyfish', name: '„ÇØ„É©„Ç≤', emoji: 'ü™º', rarity: 'sr' },
            { id: 'capsule', name: '„Ç≥„Ç∫„Éü„ÉÉ„ÇØ', emoji: 'ü™ê', rarity: 'sr' },

            { id: 'money', name: '„Éû„Éç„Éº', emoji: 'üí∞', rarity: 'shop' },
            { id: 'jewel', name: '„Ç∏„É•„Ç®„É´', emoji: 'üíç', rarity: 'shop' },

            { id: 'tea', name: '„Çø„Éî„Ç™„Ç´„Éü„É´„ÇØ', emoji: 'üßã', rarity: 'sr' },
            { id: 'soda', name: '„ÇØ„É™„Éº„É†„ÇΩ„Éº„ÉÄ', emoji: 'ü•§', rarity: 'sr' },
            { id: 'wine', name: '„ÉØ„Ç§„É≥', emoji: 'üç∑', rarity: 'sr' },
            { id: 'film', name: '„Éï„Ç£„É´„É†', emoji: 'üéûÔ∏è', rarity: 'rare' },

        ];

        // „Ç∑„Éß„ÉÉ„ÉóÂ∞ÇÂ£≤Ôºà„Ç¨„ÉÅ„É£„Åã„Çâ„ÅØÂá∫„Å™„ÅÑÔºâ
        const SHOP_ONLY_CHARACTERS = ['üòé','ü¶Ñ'];
        const SHOP_ONLY_BACKGROUNDS = ['money','jewel'];

        // „Ç¨„ÉÅ„É£ÊéíÂá∫„Éó„Éº„É´Ôºà„Ç∑„Éß„ÉÉ„ÉóÂ∞ÇÂ£≤„ÇíÈô§Â§ñÔºâ
        const gachaCharactersPool = gachaCharacters.filter(c => !SHOP_ONLY_CHARACTERS.includes(c.emoji));
        const gachaBackgroundsPool = gachaBackgrounds.filter(b => !SHOP_ONLY_BACKGROUNDS.includes(b.id));

        
        const gachaDecors = [
            { emoji: 'üéà', name: '„Åµ„Çè„Åµ„ÇèÈ¢®Ëàπ', rarity: 'common' },
            { emoji: 'üç¶', name: '„ÇΩ„Éï„Éà„ÇØ„É™„Éº„É†', rarity: 'common' },
            { emoji: 'üç°', name: '„Å†„Çì„Åî', rarity: 'common' },
            { emoji: '‚òïÔ∏è', name: '„Ç≥„Éº„Éí„Éº', rarity: 'common' },
            { emoji: 'üçº', name: 'Âì∫‰π≥Áì∂', rarity: 'common' },
            { emoji: 'üëì', name: '„É°„Ç¨„Éç', rarity: 'common' },
            { emoji: 'üç∫', name: '„Éì„Éº„É´', rarity: 'common' },
            { emoji: 'üéÄ', name: '„É™„Éú„É≥', rarity: 'rare' },
            { emoji: 'üï∂Ô∏è', name: '„Çµ„É≥„Ç∞„É©„Çπ', rarity: 'rare' },
            { emoji: 'üé§', name: '„Éû„Ç§„ÇØ', rarity: 'rare' },
            { emoji: 'ü™¥', name: 'Ë¶≥ËëâÊ§çÁâ©', rarity: 'rare' },
            { emoji: '‚ÅâÔ∏è', name: '„Éû„Ç¨„Ç∏„É≥„Éû„Éº„ÇØ', rarity: 'rare' },
            { emoji: 'üß¢', name: '„Ç≠„É£„ÉÉ„Éó', rarity: 'rare' },
            { emoji: 'üßÅ', name: '„Ç´„ÉÉ„Éó„Ç±„Éº„Ç≠', rarity: 'sr' },
            { emoji: 'üçì', name: '„ÅÑ„Å°„Åî', rarity: 'sr' },
            { emoji: 'üéÆ', name: '„Ç≤„Éº„É†', rarity: 'sr' },
            { emoji: 'üé©', name: '„Ç∑„É´„ÇØ„Éè„ÉÉ„Éà', rarity: 'sr' },
            { emoji: 'ü•Ω', name: '„Ç¥„Éº„Ç∞„É´', rarity: 'sr' },
            { emoji: 'ü´ß', name: '„Åó„ÇÉ„Åº„ÇìÁéâ', rarity: 'ssr' },
            { emoji: 'üß∏', name: '„Åè„Åæ„Å¨„ÅÑ', rarity: 'ssr' },
            { emoji: 'üíã', name: '„Ç≠„Çπ', rarity: 'ssr' },

            { emoji: 'üè©', name: '„Éõ„ÉÜ„É´', rarity: 'rare' },
            { emoji: 'üí°', name: '„Å≤„Çâ„ÇÅ„Åç', rarity: 'rare' },
            { emoji: 'üí§', name: '„Çπ„É™„Éº„Éî„Éº', rarity: 'rare' },
            { emoji: 'üö¨', name: '„Çø„Éê„Ç≥', rarity: 'rare' },
            { emoji: 'üóø', name: '„É¢„Ç¢„Ç§', rarity: 'sr' },
];
        
        // „Éü„ÉÉ„Ç∑„Éß„É≥ÂÆöÁæ©
        const missions = [
            { id: 'talk_5', name: '5ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 5, reward: 3, rewardType: 'star' },
            { id: 'talk_20', name: '20ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 20, reward: 5, rewardType: 'star' },
            { id: 'talk_50', name: '50ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 50, reward: 10, rewardType: 'star' },
            { id: 'talk_100', name: '100ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 100, reward: 15, rewardType: 'star' },
            { id: 'talk_200', name: '200ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 200, reward: 1, rewardType: 'diamond' },
            { id: 'talk_500', name: '500ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 500, reward: 2, rewardType: 'diamond' },
            { id: 'talk_1000', name: '1000ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 1000, reward: 3, rewardType: 'diamond' },
            { id: 'talk_2000', name: '2000ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 2000, reward: 3, rewardType: 'diamond' },
            { id: 'talk_3000', name: '3000ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 3000, reward: 3, rewardType: 'diamond' },
            { id: 'talk_4000', name: '4000ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 4000, reward: 3, rewardType: 'diamond' },
            { id: 'talk_5000', name: '5000ÂõûË©±„Åó„Åã„Åë„Çã', type: 'talk', target: 5000, reward: 3, rewardType: 'diamond' },
            { id: 'pixiv_3', name: 'pixiv„Çí3ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 3, reward: 3, rewardType: 'star' },
            { id: 'pixiv_10', name: 'pixiv„Çí10ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 10, reward: 5, rewardType: 'star' },
            { id: 'pixiv_30', name: 'pixiv„Çí30ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 30, reward: 10, rewardType: 'star' },
            { id: 'pixiv_50', name: 'pixiv„Çí50ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 50, reward: 15, rewardType: 'star' },
            { id: 'pixiv_100', name: 'pixiv„Çí100ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 100, reward: 1, rewardType: 'diamond' },
            { id: 'pixiv_200', name: 'pixiv„Çí200ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 200, reward: 2, rewardType: 'diamond' },
  { id: 'pixiv_300', name: 'pixiv„Çí300ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 300, reward: 3, rewardType: 'diamond' },
  { id: 'pixiv_400', name: 'pixiv„Çí400ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 400, reward: 4, rewardType: 'diamond' },
  { id: 'pixiv_500', name: 'pixiv„Çí500ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 500, reward: 5, rewardType: 'diamond' },
  { id: 'pixiv_600', name: 'pixiv„Çí600ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 600, reward: 6, rewardType: 'diamond' },
  { id: 'pixiv_700', name: 'pixiv„Çí700ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 700, reward: 7, rewardType: 'diamond' },
  { id: 'pixiv_800', name: 'pixiv„Çí800ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 800, reward: 8, rewardType: 'diamond' },
  { id: 'pixiv_900', name: 'pixiv„Çí900ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 900, reward: 9, rewardType: 'diamond' },
  { id: 'pixiv_1000', name: 'pixiv„Çí1000ÂõûË¶ã„Åõ„Çã', type: 'pixiv', target: 1000, reward: 10, rewardType: 'diamond' },
            { id: 'rank_1', name: 'Rank 1 „Å´Âà∞ÈÅî', type: 'rank', target: 1, reward: 1, rewardType: 'star' },
            { id: 'rank_5', name: 'Rank 5„Å´Âà∞ÈÅî', type: 'rank', target: 5, reward: 5, rewardType: 'star' },
            { id: 'rank_10', name: 'Rank 10„Å´Âà∞ÈÅî', type: 'rank', target: 10, reward: 10, rewardType: 'star' },
            { id: 'rank_20', name: 'Rank 20„Å´Âà∞ÈÅî', type: 'rank', target: 20, reward: 15, rewardType: 'star' },
            { id: 'rank_50', name: 'Rank 50„Å´Âà∞ÈÅî', type: 'rank', target: 50, reward: 1, rewardType: 'diamond' },
            { id: 'rank_100', name: 'Rank 100„Å´Âà∞ÈÅî', type: 'rank', target: 100, reward: 3, rewardType: 'diamond' },
            { id: 'rank_120', name: 'Rank 120 „Å´Âà∞ÈÅî', type: 'rank', target: 120, reward: 3, rewardType: 'diamond' },
            { id: 'rank_150', name: 'Rank 150 „Å´Âà∞ÈÅî', type: 'rank', target: 150, reward: 3, rewardType: 'diamond' },
            { id: 'rank_180', name: 'Rank 180 „Å´Âà∞ÈÅî', type: 'rank', target: 180, reward: 3, rewardType: 'diamond' },
            { id: 'rank_220', name: 'Rank 220 „Å´Âà∞ÈÅî', type: 'rank', target: 220, reward: 3, rewardType: 'diamond' },
            { id: 'rank_250', name: 'Rank 250 „Å´Âà∞ÈÅî', type: 'rank', target: 250, reward: 3, rewardType: 'diamond' },
            { id: 'rank_275', name: 'Rank 275 „Å´Âà∞ÈÅî', type: 'rank', target: 275, reward: 3, rewardType: 'diamond' },
            { id: 'rank_300', name: 'Rank 300 „Å´Âà∞ÈÅî', type: 'rank', target: 300, reward: 3, rewardType: 'diamond' },
            { id: 'rank_350', name: 'Rank 350 „Å´Âà∞ÈÅî', type: 'rank', target: 350, reward: 3, rewardType: 'diamond' },
            { id: 'rank_400', name: 'Rank 400 „Å´Âà∞ÈÅî', type: 'rank', target: 400, reward: 3, rewardType: 'diamond' },
            { id: 'rank_450', name: 'Rank 450 „Å´Âà∞ÈÅî', type: 'rank', target: 450, reward: 3, rewardType: 'diamond' },
            { id: 'rank_500', name: 'Rank 500 „Å´Âà∞ÈÅî', type: 'rank', target: 500, reward: 3, rewardType: 'diamond' },
        ];
        
        // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥ÂÄôË£úÔºàÊòüÂ†±ÈÖ¨Ôºâ
        const dailyMissionTemplatesStar = [
            { type: 'dailyTalk', target: 5, name: '5Âõûüåö„Çí„Çø„ÉÉ„Éó„Åó„Çà„ÅÜ', reward: 2, rewardType: 'star' },
            { type: 'dailyTalk', target: 10, name: '10Âõûüåö„Çí„Çø„ÉÉ„Éó„Åó„Çà„ÅÜ', reward: 3, rewardType: 'star' },
            { type: 'dailyPixiv', target: 1, name: 'pixiv„Çí1ÂõûË¶ã„Çà„ÅÜ', reward: 2, rewardType: 'star' },
            { type: 'dailyPixiv', target: 3, name: 'pixiv„Çí3ÂõûË¶ã„Çà„ÅÜ', reward: 3, rewardType: 'star' },
            { type: 'openGacha', target: 1, name: '„Ç¨„ÉÅ„É£ÁîªÈù¢„ÇíÈñã„Åì„ÅÜ', reward: 2, rewardType: 'star' },
            { type: 'changeDecor', target: 1, name: 'È£æ„Çä„ÇíÂ§â„Åà„Çà„ÅÜ', reward: 2, rewardType: 'star' }
        ];
        
        // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥ÂÄôË£úÔºà„ÉÄ„Ç§„É§Â†±ÈÖ¨Ôºâ
        const dailyMissionTemplatesDiamond = [
            { type: 'dailyTalk', target: 5, name: '5Âõûüåö„Çí„Çø„ÉÉ„Éó„Åó„Çà„ÅÜ', reward: 1, rewardType: 'diamond' },
            { type: 'dailyTalk', target: 10, name: '10Âõûüåö„Çí„Çø„ÉÉ„Éó„Åó„Çà„ÅÜ', reward: 1, rewardType: 'diamond' },
            { type: 'dailyPixiv', target: 1, name: 'pixiv„Çí1ÂõûË¶ã„Çà„ÅÜ', reward: 1, rewardType: 'diamond' },
            { type: 'dailyPixiv', target: 3, name: 'pixiv„Çí3ÂõûË¶ã„Çà„ÅÜ', reward: 1, rewardType: 'diamond' },
            { type: 'openGacha', target: 1, name: '„Ç¨„ÉÅ„É£ÁîªÈù¢„ÇíÈñã„Åì„ÅÜ', reward: 1, rewardType: 'diamond' },
            { type: 'changeDecor', target: 1, name: 'È£æ„Çä„ÇíÂ§â„Åà„Çà„ÅÜ', reward: 1, rewardType: 'diamond' }
        ];
        
        // DOMË¶ÅÁ¥†
        const gameContainer = document.getElementById('game-container');
        const character = document.getElementById('character');
        const characterArea = document.getElementById('character-area');
        const speechBubble = document.getElementById('speech-bubble');
        const speechText = document.getElementById('speech-text');
        const usernameDisplay = document.getElementById('username-display');
        const usernameText = document.getElementById('username-text');
        const rankDisplay = document.getElementById('rank-display');
        const rankModal = document.getElementById('rank-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const gachaModal = document.getElementById('gacha-modal');
        const gachaPullBtnStar = document.getElementById('gacha-pull-btn-star');
        const gachaPullBtnDiamond = document.getElementById('gacha-pull-btn-diamond');
        const gachaResult = document.getElementById('gacha-result');
        const closeGachaBtn = document.getElementById('close-gacha-btn');
        const closetModal = document.getElementById('closet-modal');
        const closeClosetBtn = document.getElementById('close-closet-btn');
        const usernameModal = document.getElementById('username-modal');
        const usernameInput = document.getElementById('username-input');
        const usernameCharCount = document.getElementById('username-char-count');
        const usernameSaveBtn = document.getElementById('username-save-btn');
        const usernameCancelBtn = document.getElementById('username-cancel-btn');
        const placementArea = document.getElementById('placement-area');
        const missionModal = document.getElementById('mission-modal');
        const closeMissionBtn = document.getElementById('close-mission-btn');
        const missionList = document.getElementById('mission-list');
        
        // ÊòüÁ©∫ÁîüÊàê
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }
        
        // ËÉåÊôØ„Ç®„Éï„Çß„ÇØ„ÉàÁîüÊàê
        
        // üé≤„É©„É≥„ÉÄ„É†ËÉåÊôØÔºöËâ≤„Çí„É©„É≥„ÉÄ„É†„Å´Êõ¥Êñ∞ÔºàËÉåÊôØÂàáÊõøÊôÇ„Å´ÂøÖ„ÅöÂÅúÊ≠¢„Åô„ÇãÔºâ
        let diceInterval = null;
        let aquaInterval = null; // Ê≥¢Á¥ãËÉåÊôØÁî®„ÅÆ„Ç§„É≥„Çø„Éº„Éê„É´
        
        function startDiceBackground(){
            // Êó¢Â≠ò„Åå„ÅÇ„Çå„Å∞ÂÅúÊ≠¢
            if (diceInterval) {
                clearInterval(diceInterval);
                diceInterval = null;
            }
            const setRand = () => {
                const c1 = `hsl(${Math.floor(Math.random()*360)}, 85%, 48%)`;
                const c2 = `hsl(${Math.floor(Math.random()*360)}, 85%, 48%)`;
                const c3 = `hsl(${Math.floor(Math.random()*360)}, 85%, 22%)`;
                document.body.style.setProperty('--dice1', c1);
                document.body.style.setProperty('--dice2', c2);
                document.body.style.setProperty('--dice3', c3);
            };
            setRand();
            diceInterval = setInterval(setRand, 1400);
        }
        
        function startAquaBackground(){
            // Êó¢Â≠ò„Åå„ÅÇ„Çå„Å∞ÂÅúÊ≠¢
            if (aquaInterval) {
                clearInterval(aquaInterval);
                aquaInterval = null;
            }
            aquaInterval = setInterval(() => {
                if (currentBackground === 'aqua') {
                    const ripple = document.createElement('div');
                    ripple.className = 'ripple';
                    ripple.style.left = Math.random() * 100 + '%';
                    ripple.style.top = Math.random() * 100 + '%';
                    starsContainer.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 1500);
                }
            }, 2000);
        }

        function spawnRandomFallingEmojis(opts){
            const count = (opts && opts.count) ? opts.count : 22;
            const pool = ['ü§°','ü§ì','üëπ','üí©','üíÄ','üëÅÔ∏è','üëÑ','üëë','üôâ','ü¶û','ü™µ','üå∂Ô∏è','üçâ','ü´ë','üèÄ','ü™É','üìÄ','üõ¢Ô∏è','üß®','üßø','üíä','ü™Ü'];
            for(let i=0;i<count;i++){
                const e = document.createElement('div');
                e.className = 'dice-fall';
                e.textContent = pool[Math.floor(Math.random()*pool.length)];
                e.style.left = (Math.random()*100) + 'vw';
                e.style.fontSize = (20 + Math.random()*28).toFixed(0) + 'px';
                e.style.setProperty('--dx', (-45 + Math.random()*90).toFixed(1) + 'px');
                e.style.setProperty('--rot', (-220 + Math.random()*440).toFixed(1) + 'deg');
                const dur = 6 + Math.random()*10;
                e.style.animationDuration = dur.toFixed(2) + 's';
                e.style.animationDelay = (-(Math.random()*dur)).toFixed(2) + 's';
                starsContainer.appendChild(e);
            }
        }


function generateBackgroundEffect(bgType) {
            // Êó¢Â≠ò„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„Çí„ÇØ„É™„Ç¢
            starsContainer.innerHTML = '';
            // üé≤„É©„É≥„ÉÄ„É†ËÉåÊôØ„ÅÆ„Çø„Ç§„Éû„ÉºÂÅúÊ≠¢
            if (diceInterval) { clearInterval(diceInterval); diceInterval = null; }
            // üíßÊ≥¢Á¥ãËÉåÊôØ„ÅÆ„Çø„Ç§„Éû„ÉºÂÅúÊ≠¢
            if (aquaInterval) { clearInterval(aquaInterval); aquaInterval = null; }
            document.body.style.removeProperty('--dice1');
            document.body.style.removeProperty('--dice2');
            document.body.style.removeProperty('--dice3');
            
            switch(bgType) {
                case 'night':
                    // ÊòüÁ©∫„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 100; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.style.left = Math.random() * 100 + '%';
                        star.style.top = Math.random() * 100 + '%';
                        star.style.animationDelay = Math.random() * 3 + 's';
                        starsContainer.appendChild(star);
                    }
                    break;
                    
                case 'rainbow':
                    // Ëôπ„ÅÆÂÖâ„ÅÆÁ≤íÂ≠ê„Ç®„Éï„Çß„ÇØ„Éà
                    const rainbowColors = [
                        'rgba(255, 20, 147, 0.9)', // ÊøÉ„ÅÑ„Éî„É≥„ÇØ
                        'rgba(255, 69, 0, 0.9)',   // Ëµ§„Ç™„É¨„É≥„Ç∏
                        'rgba(255, 165, 0, 0.9)',  // „Ç™„É¨„É≥„Ç∏
                        'rgba(255, 215, 0, 0.9)',  // „Ç¥„Éº„É´„Éâ
                        'rgba(50, 205, 50, 0.9)',  // „É©„Ç§„É†„Ç∞„É™„Éº„É≥
                        'rgba(0, 191, 255, 0.9)',  // „Éá„Ç£„Éº„Éó„Çπ„Ç´„Ç§„Éñ„É´„Éº
                        'rgba(138, 43, 226, 0.9)', // „Éñ„É´„Éº„Éê„Ç§„Ç™„É¨„ÉÉ„Éà
                        'rgba(255, 0, 255, 0.9)',  // „Éû„Çº„É≥„Çø
                    ];
                    for (let i = 0; i < 70; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'rainbow-particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.background = rainbowColors[Math.floor(Math.random() * rainbowColors.length)];
                        particle.style.boxShadow = `0 0 15px ${rainbowColors[Math.floor(Math.random() * rainbowColors.length)]}`;
                        const duration = Math.random() * 5 + 4;
                        particle.style.animationDuration = duration + 's';
                        particle.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(particle);
                    }
                    // „Ç≠„É©„Ç≠„É©„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 50; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.className = 'rainbow-sparkle';
                        sparkle.style.left = Math.random() * 100 + '%';
                        sparkle.style.top = Math.random() * 100 + '%';
                        const color = rainbowColors[Math.floor(Math.random() * rainbowColors.length)];
                        sparkle.style.background = color;
                        sparkle.style.boxShadow = `0 0 10px ${color}`;
                        sparkle.style.animationDelay = Math.random() * 3 + 's';
                        starsContainer.appendChild(sparkle);
                    }
                    break;
                    
                case 'dream':
                    // Â§¢„ÅÆÂÖâ„ÅÆÁ≤íÂ≠ê„Ç®„Éï„Çß„ÇØ„ÉàÔºàÊüî„Çâ„Åã„ÅÑËâ≤Ôºâ
                    const dreamColors = [
                        'rgba(255, 107, 157, 0.8)', // „Éî„É≥„ÇØ
                        'rgba(255, 168, 180, 0.8)', // „Çµ„Éº„É¢„É≥„Éî„É≥„ÇØ
                        'rgba(255, 221, 204, 0.8)', // „Éî„Éº„ÉÅ
                        'rgba(255, 255, 221, 0.8)', // „Ç§„Ç®„É≠„Éº
                        'rgba(212, 255, 221, 0.8)', // „Éü„É≥„Éà„Ç∞„É™„Éº„É≥
                        'rgba(180, 244, 255, 0.8)', // „Çπ„Ç´„Ç§„Éñ„É´„Éº
                        'rgba(168, 157, 255, 0.8)', // „É©„Éô„É≥„ÉÄ„Éº
                    ];
                    for (let i = 0; i < 50; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'rainbow-particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.background = dreamColors[Math.floor(Math.random() * dreamColors.length)];
                        const duration = Math.random() * 5 + 4;
                        particle.style.animationDuration = duration + 's';
                        particle.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(particle);
                    }
                    // „Ç≠„É©„Ç≠„É©„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 30; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.className = 'rainbow-sparkle';
                        sparkle.style.left = Math.random() * 100 + '%';
                        sparkle.style.top = Math.random() * 100 + '%';
                        sparkle.style.background = dreamColors[Math.floor(Math.random() * dreamColors.length)];
                        sparkle.style.animationDelay = Math.random() * 3 + 's';
                        starsContainer.appendChild(sparkle);
                    }
                    break;

                case 'morpho':
                    spawnMorphoParticles({count: 14});
                    break;

                case 'cards':
                    spawnFallingCards({count: 18});
                    break;

                case 'neoncandy':
                    // „Éç„Ç™„É≥ÔºöCSSÔºà„Ç∞„É©„ÉáÔºãËâ≤Áõ∏Â§âÂåñÔºâ„ÅÆ„Åø
                    break;

                case 'fries':
                    spawnFriesSticks({count: 42});
                    break;

                case 'dice':
                    startDiceBackground();
                    spawnRandomFallingEmojis({count: 22});
                    break;
                
                case 'cosmos':
                    // ÂõûËª¢„Åô„ÇãÊòüÁ©∫ÔºàRank 100Ôºâ
                    for (let i = 0; i < 80; i++) {
                        const star = document.createElement('div');
                        star.className = 'rotating-star';
                        const radius = Math.random() * 200 + 100;
                        star.style.setProperty('--radius', radius + 'px');
                        star.style.left = '50%';
                        star.style.top = '50%';
                        const duration = Math.random() * 20 + 20;
                        star.style.animationDuration = duration + 's';
                        star.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(star);
                    }
                    // ‰∏≠ÂøÉ„Å´Ëºù„ÅèÊòü
                    for (let i = 0; i < 30; i++) {
                        const centerStar = document.createElement('div');
                        centerStar.className = 'star';
                        centerStar.style.left = (45 + Math.random() * 10) + '%';
                        centerStar.style.top = (45 + Math.random() * 10) + '%';
                        centerStar.style.animationDelay = Math.random() * 3 + 's';
                        starsContainer.appendChild(centerStar);
                    }
                    break;
                
                case 'matrix':
                    // Âπæ‰ΩïÂ≠¶Ê®°ÊßòÔºàRank 200Ôºâ
                    const shapes = ['circle', 'square', 'triangle'];
                    const matrixColors = [
                        'rgba(100, 200, 255, 0.5)',
                        'rgba(150, 100, 255, 0.5)',
                        'rgba(255, 100, 200, 0.5)',
                        'rgba(100, 255, 200, 0.5)'
                    ];
                    for (let i = 0; i < 25; i++) {
                        const shape = document.createElement('div');
                        shape.className = 'geo-shape';
                        const size = Math.random() * 60 + 30;
                        shape.style.width = size + 'px';
                        shape.style.height = size + 'px';
                        shape.style.left = Math.random() * 100 + '%';
                        shape.style.top = Math.random() * 100 + '%';
                        shape.style.borderColor = matrixColors[Math.floor(Math.random() * matrixColors.length)];
                        
                        const shapeType = shapes[Math.floor(Math.random() * shapes.length)];
                        if (shapeType === 'circle') {
                            shape.style.borderRadius = '50%';
                        } else if (shapeType === 'triangle') {
                            shape.style.width = '0';
                            shape.style.height = '0';
                            shape.style.border = 'none';
                            shape.style.borderLeft = (size/2) + 'px solid transparent';
                            shape.style.borderRight = (size/2) + 'px solid transparent';
                            shape.style.borderBottom = size + 'px solid ' + matrixColors[Math.floor(Math.random() * matrixColors.length)];
                        }
                        
                        const duration = Math.random() * 10 + 10;
                        shape.style.animationDuration = duration + 's';
                        shape.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(shape);
                    }
                    break;
                
                case 'aqua':
                    // Ê≥¢Á¥ãËÉåÊôØÔºàRank 300Ôºâ- „Çø„ÉÉ„Éó„ÅßÊ≥¢Á¥ã„ÅåÂ∫É„Åå„Çã
                    // Â∏∏ÊôÇ„É©„É≥„ÉÄ„É†„Å´Ê≥¢Á¥ã„ÅåÁô∫Áîü
                    startAquaBackground();
                    break;
                
                case 'metro':
                    // „É°„Éà„É≠„Éù„É™„ÇπÔºàRank 400Ôºâ- „Çπ„ÇØ„É≠„Éº„É´„Åô„ÇãË°ó‰∏¶„Åø
                    // „Éì„É´„Çí2„Çª„ÉÉ„ÉàÁîüÊàê„Åó„Å¶ÁÑ°Èôê„Çπ„ÇØ„É≠„Éº„É´
                    for (let set = 0; set < 2; set++) {
                        for (let i = 0; i < 15; i++) {
                            const building = document.createElement('div');
                            building.className = `city-building scroll-${set + 1}`;
                            const width = Math.random() * 80 + 50; // 50-130px
                            const height = Math.random() * 250 + 200; // 200-450px
                            building.style.width = width + 'px';
                            building.style.height = height + 'px';
                            building.style.left = (i * 140) + 'px';
                            
                            // „Ç¶„Ç£„É≥„Éâ„Ç¶„ÅÆÂÖâ„ÇíËøΩÂä†
                            const windows = Math.floor(height / 20) * Math.floor(width / 15);
                            for (let w = 0; w < Math.min(windows, 40); w++) {
                                if (Math.random() > 0.2) {
                                    const windowDiv = document.createElement('div');
                                    windowDiv.style.position = 'absolute';
                                    windowDiv.style.width = '10px';
                                    windowDiv.style.height = '10px';
                                    windowDiv.style.background = Math.random() > 0.5 ? '#ffeb3b' : '#ff9800';
                                    windowDiv.style.left = (Math.random() * (width - 20) + 8) + 'px';
                                    windowDiv.style.top = (Math.random() * (height - 20) + 8) + 'px';
                                    windowDiv.style.boxShadow = '0 0 8px rgba(255, 235, 59, 0.9)';
                                    building.appendChild(windowDiv);
                                }
                            }
                            
                            starsContainer.appendChild(building);
                        }
                    }
                    break;
                
                case 'hacker':
                    // „Éè„ÉÉ„Ç´„ÉºÔºàRank 500Ôºâ- „Çµ„Ç§„Éê„Éº„Çπ„Éö„Éº„ÇπÔºà„Ç≥„Éº„ÉâÈ¢®Ôºâ
                    const codeChars = ['0', '1', 'A', 'B', 'C', 'D', 'E', 'F', '{', '}', '[', ']', '<', '>', '/', '\\', '|', '*', '#', '$', '%', '&'];
                    for (let i = 0; i < 50; i++) {
                        const code = document.createElement('div');
                        code.className = 'cyber-code';
                        // „É©„É≥„ÉÄ„É†„Å™„Ç≥„Éº„ÉâÊñáÂ≠óÂàó„ÇíÁîüÊàê
                        let codeText = '';
                        const length = Math.floor(Math.random() * 10) + 5;
                        for (let j = 0; j < length; j++) {
                            codeText += codeChars[Math.floor(Math.random() * codeChars.length)];
                        }
                        code.textContent = codeText;
                        code.style.left = Math.random() * 100 + '%';
                        code.style.top = -(Math.random() * 100) + '%';
                        
                        const duration = Math.random() * 4 + 6;
                        code.style.animationDuration = duration + 's';
                        code.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(code);
                    }
                    break;

                case 'sea':
                    // Êµ∑ÔºöÈ≠ö„ÅåÂ∑¶Âè≥„Åã„ÇâÊ≥≥„Åê
                    spawnSeaFish({ count: 10 });
                    spawnSeaBubbles({ count: 14 });
                    break;

                case 'disco':
                    // „Éü„É©„Éº„Éú„Éº„É´ÔºöÁµµÊñáÂ≠ó„Å™„ÅóÔºàÂÖâÁÇπ„ÅÆ„ÅøÔºâ
                    spawnDiscoDots({
                        count: 55,
                        colors: [
                            'rgba(255,255,255,0.95)',
                            'rgba(120,210,255,0.85)',
                            'rgba(255,120,200,0.75)',
                            'rgba(255,220,120,0.75)'
                        ],
                        sizeMin: 4,
                        sizeMax: 10,
                        speedMin: 0.35,
                        speedMax: 0.7
                    });
                    break;

                case 'champagne':
                    spawnFloatingCircles({
                        count: 18,
                        colors: ['#fff9d6','#ffeaa0','#f5d76e'],
                        speedMin: 0.2,
                        speedMax: 0.4,
                        sizeMin: 6,
                        sizeMax: 12,
                        direction: 'up'
                    });
                    break;

                    
                case 'snow':
                    // Èõ™„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 50; i++) {
                        const snowflake = document.createElement('div');
                        snowflake.className = 'snowflake';
                        snowflake.style.left = Math.random() * 100 + '%';
                        snowflake.style.width = (Math.random() * 5 + 5) + 'px';
                        snowflake.style.height = snowflake.style.width;
                        const duration = Math.random() * 3 + 3;
                        snowflake.style.animationDuration = duration + 's';
                        // ÁîªÈù¢ÂÖ®‰Ωì„Å´ÂàÜÊï£„Åï„Åõ„Çã„Åü„ÇÅ„ÄÅË≤†„ÅÆÈÅÖÂª∂„ÅßÂàùÊúü‰ΩçÁΩÆ„ÇíË™øÊï¥
                        snowflake.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(snowflake);
                    }
                    // Ê∞¥Ëâ≤„ÅÆÈõ™„ÅÆÁµêÊô∂„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 15; i++) {
                        const crystal = document.createElement('div');
                        crystal.className = 'snowcrystal';
                        crystal.textContent = '‚ùÑ';
                        crystal.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 4 + 4;
                        crystal.style.animationDuration = duration + 's';
                        crystal.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(crystal);
                    }
                    break;
                    
                case 'forest':
                    // Ëëâ„Å£„Å±„Ç®„Éï„Çß„ÇØ„Éà
                    const leafColors = ['dark-green', 'medium-green', 'light-green'];
                    for (let i = 0; i < 30; i++) {
                        const leaf = document.createElement('div');
                        // „É©„É≥„ÉÄ„É†„Å´3Ëâ≤„Åã„ÇâÈÅ∏Êäû
                        const randomColor = leafColors[Math.floor(Math.random() * leafColors.length)];
                        leaf.className = 'leaf ' + randomColor;
                        leaf.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 4 + 4;
                        leaf.style.animationDuration = duration + 's';
                        // ÁîªÈù¢ÂÖ®‰Ωì„Å´ÂàÜÊï£„Åï„Åõ„Çã„Åü„ÇÅ„ÄÅË≤†„ÅÆÈÅÖÂª∂„ÅßÂàùÊúü‰ΩçÁΩÆ„ÇíË™øÊï¥
                        leaf.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(leaf);
                    }
                    break;
                    
                case 'rain':
                    // Èõ®„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 60; i++) {
                        const raindrop = document.createElement('div');
                        raindrop.className = 'raindrop';
                        raindrop.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 0.5 + 0.5;
                        raindrop.style.animationDuration = duration + 's';
                        raindrop.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(raindrop);
                    }
                    break;
                    
                case 'love':
                    // ÊÅã„ÅÆ„Éè„Éº„Éà„Ç®„Éï„Çß„ÇØ„Éà
                    const heartColors = ['pink-heart', 'red-heart'];
                    for (let i = 0; i < 40; i++) {
                        const heart = document.createElement('div');
                        const randomColor = heartColors[Math.floor(Math.random() * heartColors.length)];
                        heart.className = 'heart ' + randomColor;
                        heart.textContent = '‚ù§';
                        heart.style.left = Math.random() * 100 + '%';
                        heart.style.fontSize = (Math.random() * 20 + 20) + 'px';
                        const duration = Math.random() * 4 + 4;
                        heart.style.animationDuration = duration + 's';
                        heart.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(heart);
                    }
                    break;
                    
                case 'sakura':
                    // Ê°ú„ÅÆËä±„Å≥„Çâ„Ç®„Éï„Çß„ÇØ„ÉàÔºà3Ëâ≤Ôºâ
                    const petalColors = ['dark-pink', 'medium-pink', 'light-pink'];
                    for (let i = 0; i < 40; i++) {
                        const petal = document.createElement('div');
                        // „É©„É≥„ÉÄ„É†„Å´3Ëâ≤„Åã„ÇâÈÅ∏Êäû
                        const randomColor = petalColors[Math.floor(Math.random() * petalColors.length)];
                        petal.className = 'petal ' + randomColor;
                        petal.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 5 + 4;
                        petal.style.animationDuration = duration + 's';
                        petal.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(petal);
                    }
                    break;
                    
                case 'city':
                    // ÈÉΩ‰ºö„ÅÆÂÖâ„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 50; i++) {
                        const light = document.createElement('div');
                        light.className = 'city-light';
                        light.style.left = Math.random() * 100 + '%';
                        light.style.top = Math.random() * 100 + '%';
                        light.style.animationDelay = Math.random() * 2 + 's';
                        starsContainer.appendChild(light);
                    }
                    break;
                    
                case 'lava':
                    // Ê∫∂Â≤©„ÅÆÁÅ´Ëä±„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 40; i++) {
                        const spark = document.createElement('div');
                        spark.className = 'spark';
                        spark.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 3 + 2;
                        spark.style.animationDuration = duration + 's';
                        spark.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(spark);
                    }
                    // Èªí„ÅÑÁÖô„ÉªÁÅ∞„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 20; i++) {
                        const smoke = document.createElement('div');
                        smoke.className = 'lava-smoke';
                        smoke.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 4 + 3;
                        smoke.style.animationDuration = duration + 's';
                        smoke.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(smoke);
                    }
                    // Ê∫∂Â≤©„ÅÆÂ°ä„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 15; i++) {
                        const chunk = document.createElement('div');
                        chunk.className = 'lava-chunk';
                        chunk.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 3.5 + 2.5;
                        chunk.style.animationDuration = duration + 's';
                        chunk.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(chunk);
                    }
                    break;
                    
                case 'aurora':
                    // „Ç™„Éº„É≠„É©„ÅÆÂÖâ„ÅÆ„Ç´„Éº„ÉÜ„É≥
                    for (let i = 0; i < 5; i++) {
                        const wave = document.createElement('div');
                        wave.className = 'aurora-wave';
                        wave.style.animationDelay = (i * 2) + 's';
                        wave.style.left = (i * 25) + '%';
                        starsContainer.appendChild(wave);
                    }
                    // Êòü„ÇÇËøΩÂä†
                    for (let i = 0; i < 60; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.style.left = Math.random() * 100 + '%';
                        star.style.top = Math.random() * 100 + '%';
                        star.style.animationDelay = Math.random() * 3 + 's';
                        starsContainer.appendChild(star);
                    }
                    break;
                    
                case 'earth':
                    // Âú∞ÁêÉ„ÅÆËëâ„Å£„Å±„Ç®„Éï„Çß„ÇØ„ÉàÔºàÁ∑ëÂ§ö„ÇÅÔºâ
                    const earthLeafColors = [
                        'earth-blue', 
                        'earth-green', 'earth-green', 'earth-green', // Á∑ë„Çí3ÂÄç„Å´
                        'earth-teal', 'earth-teal' // ÈùíÁ∑ë„Çí2ÂÄç„Å´
                    ];
                    for (let i = 0; i < 30; i++) { // 25‚Üí30„Å´Â¢óÂä†
                        const leaf = document.createElement('div');
                        const randomColor = earthLeafColors[Math.floor(Math.random() * earthLeafColors.length)];
                        leaf.className = 'leaf ' + randomColor;
                        leaf.style.left = Math.random() * 100 + '%';
                        const duration = Math.random() * 4 + 4;
                        leaf.style.animationDuration = duration + 's';
                        leaf.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(leaf);
                    }
                    break;
                    
                case 'toilet':
                    // „Éà„Ç§„É¨„ÅÆüí©„Åå‰∏äÊòá
                    for (let i = 0; i < 20; i++) {
                        const poop = document.createElement('div');
                        poop.className = 'rising-item';
                        poop.textContent = 'üí©';
                        poop.style.left = Math.random() * 100 + '%';
                        poop.style.fontSize = (Math.random() * 20 + 18) + 'px';
                        const duration = Math.random() * 5 + 4;
                        poop.style.animationDuration = duration + 's';
                        poop.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(poop);
                    }
                    // „Éà„Ç§„É¨„ÅÆËå∂Ëâ≤„ÅÑÊ≥°„Åå‰∏äÊòá
                    for (let i = 0; i < 30; i++) {
                        const bubble = document.createElement('div');
                        bubble.className = 'bubble toilet-bubble';
                        bubble.style.left = Math.random() * 100 + '%';
                        const size = Math.random() * 15 + 8;
                        bubble.style.width = size + 'px';
                        bubble.style.height = size + 'px';
                        const duration = Math.random() * 5 + 4;
                        bubble.style.animationDuration = duration + 's';
                        bubble.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(bubble);
                    }
                    break;
                    
                case 'music':
                    // Èü≥Ê•Ω„ÅÆÈü≥Á¨¶„ÅåÈôç„Å£„Å¶„Åè„Çã
                    const musicNotes = ['‚ô™', '‚ô´', '‚ô¨'];
                    for (let i = 0; i < 35; i++) {
                        const note = document.createElement('div');
                        note.className = 'falling-item';
                        const selectedNote = musicNotes[Math.floor(Math.random() * musicNotes.length)];
                        note.textContent = selectedNote;
                        note.style.left = Math.random() * 100 + '%';
                        note.style.fontSize = (Math.random() * 25 + 20) + 'px';
                        // ‚ô™„ÅØÈªí„ÄÅ‚ô´‚ô¨„ÅØÁ¥´Á≥ª
                        if (selectedNote === '‚ô™') {
                            note.style.color = '#000000';
                        } else {
                            note.style.color = `hsl(${Math.random() * 60 + 260}, 70%, 60%)`; // Á¥´Á≥ª
                        }
                        const duration = Math.random() * 4 + 3;
                        note.style.animationDuration = duration + 's';
                        note.style.animationDelay = -(Math.random() * duration) + 's';
                        starsContainer.appendChild(note);
                    }
                    break;

                case 'jellyfish':
                    // ü™º„ÇØ„É©„Ç≤ÔºöÂ§ßÂ∞è„Åå‰∏ã„Åã„Çâ‰∏ä„Å∏ÊºÇ„ÅÜ
                    for (let i = 0; i < 16; i++) {
                        const jf = document.createElement('div');
                        jf.className = 'jellyfish-particle';
                        jf.textContent = 'ü™º';
                        const size = Math.random() * 26 + 18; // 18-44
                        jf.style.fontSize = size + 'px';
                        jf.style.left = Math.random() * 100 + '%';
                        const dur = Math.random() * 7 + 10; // 10-17s
                        jf.style.animationDuration = dur + 's';
                        jf.style.animationDelay = -(Math.random() * dur) + 's';
                        jf.style.opacity = (Math.random() * 0.25 + 0.35).toString();
                        starsContainer.appendChild(jf);
                    }
                    break;

                case 'capsule':
                    // „Ç≥„Ç∫„Éü„ÉÉ„ÇØÔºö„Ç®„Éï„Çß„ÇØ„Éà„Å™„ÅóÔºàËÉåÊôØ„ÅÆ„ÅøÔºâ
                    break;

                case 'money':
                    // ü™ô Â§ö„ÇÅÔºãÈÄü„ÇÅÔºãÂõûËª¢ÔºàÂÖâ„ÅÆ‰∏∏„ÅØÁÑ°„ÅóÔºâ
                    for (let i = 0; i < 16; i++) {
            const coin = document.createElement('div');
            coin.className = 'money-coin';
            coin.textContent = 'ü™ô';
            coin.style.left = Math.random() * 100 + '%';
            coin.style.fontSize = (Math.random() * 14 + 22) + 'px';
            const dur = Math.random() * 3 + 3; // faster fall (3-6s)
            coin.style.animationDuration = dur + 's';
            coin.style.animationDelay = -(Math.random() * dur) + 's';
            coin.style.setProperty('--spin', (Math.random()*360|0) + 'deg');
            starsContainer.appendChild(coin);
        }
                    
        // ‰∏∏„ÅÑ„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂ§¢ ËÉåÊôØÈ¢®„ÉªÈ´òÈÄü„Éª3Ëâ≤3„Çµ„Ç§„Ç∫Ôºâ
        const colors = ['circle-orange','circle-amber','circle-yellow'];
        const sizes = ['18px','26px','34px'];
        for (let i = 0; i < 22; i++) {
            const c = document.createElement('div');
            const color = colors[Math.floor(Math.random()*colors.length)];
            const size = sizes[Math.floor(Math.random()*sizes.length)];
            c.className = 'circle-fall ' + color;
            c.style.setProperty('--size', size);
            c.style.left = Math.random() * 100 + '%';
            const dur = Math.random() * 3 + 3; // fast 3-6s
            c.style.animationDuration = dur + 's';
            c.style.animationDelay = -(Math.random() * dur) + 's';
            starsContainer.appendChild(c);
        }

        break;
                    
                case 'jewel':
        // üí†Ôºà„Åù„ÅÆ„Åæ„ÅæÔºâ
        for (let i = 0; i < 12; i++) {
            const gem = document.createElement('div');
            gem.className = 'jewel-gem';
            gem.textContent = 'üí†';
            gem.style.left = Math.random() * 100 + '%';
            const dur = Math.random() * 8 + 12;
            gem.style.animationDuration = dur + 's';
            gem.style.animationDelay = -(Math.random() * dur) + 's';
            gem.style.setProperty('--spin', (Math.random()*360|0) + 'deg');
            starsContainer.appendChild(gem);
        }

        // „Åº„ÇÑ„Åë„ÅüÁôΩ„ÅÑÁéâÔºàÂ§¢„Å£„ÅΩ„ÅÑÔºâ
        const gsizes = ['24px','34px','46px'];
        for (let i = 0; i < 16; i++) {
            const g = document.createElement('div');
            g.className = 'jewel-glow';
            g.style.left = Math.random() * 100 + '%';
            g.style.setProperty('--gsize', gsizes[Math.floor(Math.random()*gsizes.length)]);
            const dur = Math.random() * 10 + 12;
            g.style.animationDuration = dur + 's';
            g.style.animationDelay = -(Math.random() * dur) + 's';
            starsContainer.appendChild(g);
        }
        break;

                case 'tea':
                    // Á¥ÖËå∂„Éü„É´„ÇØÔºöÊöñËâ≤„ÅÆ‰∏∏Ôºã„Åü„Åæ„Å´üçØ
                    {
                        const sizes = ['16px','22px','30px','36px'];
                        for (let i = 0; i < 20; i++) {
                            const d = document.createElement('div');
                            d.className = 'tea-dot';
                            d.style.left = Math.random() * 100 + '%';
                            d.style.setProperty('--tsize', sizes[Math.floor(Math.random()*sizes.length)]);
                            const dur = Math.random() * 8 + 10;
                            d.style.animationDuration = dur + 's';
                            d.style.animationDelay = -(Math.random() * dur) + 's';
                            starsContainer.appendChild(d);
                        }
}
                    break;

                case 'soda':
                    // „ÇØ„É™„Éº„É†„ÇΩ„Éº„ÉÄÔºöÊ≥°„Åå‰∏ä„Åå„ÇãÔºã„Åü„Åæ„Å´üçí
                    {
                        const bsizes = ['14px','18px','26px'];
                        for (let i = 0; i < 20; i++) {
                            const b = document.createElement('div');
                            b.className = 'soda-bubble';
                            b.style.left = Math.random() * 100 + '%';
                            b.style.setProperty('--bsize', bsizes[Math.floor(Math.random()*bsizes.length)]);
                            const dur = Math.random() * 10 + 10;
                            b.style.animationDuration = dur + 's';
                            b.style.animationDelay = -(Math.random() * dur) + 's';
                            starsContainer.appendChild(b);
                        }
                        for (let i = 0; i < 5; i++) {
                            const c = document.createElement('div');
                            c.className = 'soda-cherry';
                            c.textContent = 'üçí';
            c.style.fontSize = (Math.random() * 10 + 30) + 'px';
            c.style.setProperty('--spin', (Math.random()*360 + 360) + 'deg');
                            c.style.left = Math.random() * 100 + '%';
                            const dur = Math.random() * 10 + 16;
                            c.style.animationDuration = dur + 's';
                            c.style.animationDelay = -(Math.random() * dur) + 's';
                            starsContainer.appendChild(c);
                        }
                    }
                    break;

                case 'wine':
                    // „ÉØ„Ç§„É≥ÔºöÊ∑±„ÅÑËµ§Á¥´„ÅÆ‰∏∏Ôºã„Åü„Åæ„Å´üçá
                    {
                        const colors = ['rgba(160,30,80,0.70)','rgba(120,18,60,0.62)','rgba(210,90,140,0.35)'];
                        const sizes = ['14px','18px','26px'];
                        for (let i = 0; i < 16; i++) {
                            const d = document.createElement('div');
                            d.className = 'wine-dot';
                            d.style.left = Math.random() * 100 + '%';
                            d.style.setProperty('--wsize', sizes[Math.floor(Math.random()*sizes.length)]);
                            d.style.setProperty('--wcolor', colors[Math.floor(Math.random()*colors.length)]);
                            const dur = Math.random() * 9 + 11;
                            d.style.animationDuration = dur + 's';
                            d.style.animationDelay = -(Math.random() * dur) + 's';
                            starsContainer.appendChild(d);
                        }
                        }
                    break;

                case 'film':
                    // „Éï„Ç£„É´„É†ÔºöËêΩ‰∏ã„Å™„ÅóÔºà„Éé„Ç§„Ç∫„Å®ÈöéË™ø„Å†„ÅëÔºâ
                    break;

            }
        }


        // Ê±éÁî®Ôºö‰∏∏„ÅÑÁ≤íÔºàÁµµÊñáÂ≠ó„Å™„ÅóÔºâ„Çí‰∏ä‰∏ã„Å´ÊµÅ„Åô
        
        
        
        
        
        function spawnFriesSticks(opts){
            const count = (opts && opts.count) ? opts.count : 42;
            for(let i=0;i<count;i++){
                const s = document.createElement('div');
                s.className = 'fries-stick';
                s.style.left = (Math.random()*100) + 'vw';

                const w = (6 + Math.random()*7).toFixed(0) + 'px';
                const h = (22 + Math.random()*38).toFixed(0) + 'px';
                s.style.setProperty('--w', w);
                s.style.setProperty('--h', h);

                s.style.setProperty('--dx', (-35 + Math.random()*70).toFixed(1) + 'px');
                s.style.setProperty('--rot', (-25 + Math.random()*50).toFixed(1) + 'deg');

                const dur = 6 + Math.random()*7;
                s.style.animationDuration = dur.toFixed(2) + 's';
                s.style.animationDelay = (-(Math.random()*dur)).toFixed(2) + 's';

                starsContainer.appendChild(s);
            }
        }


function spawnFallingCards(opts){
            const count = (opts && opts.count) ? opts.count : 18;
            const suits = ['‚ô¶Ô∏è','‚ô•Ô∏è','‚ô£Ô∏è','‚ô†Ô∏è'];
            for(let i=0;i<count;i++){
                const c = document.createElement('div');
                c.className = 'card-fall';
                c.textContent = suits[Math.floor(Math.random()*suits.length)];
                c.style.left = (Math.random()*100) + 'vw';
                c.style.fontSize = (22 + Math.random()*26).toFixed(0) + 'px';

                // Ê®™ÊµÅ„Çå„Å®ÂõûËª¢
                c.style.setProperty('--dx', (-40 + Math.random()*80).toFixed(1) + 'px');
                c.style.setProperty('--rot', (-180 + Math.random()*360).toFixed(1) + 'deg');

                const dur = 7 + Math.random()*9;
                c.style.animationDuration = dur.toFixed(2) + 's';
                c.style.animationDelay = (-(Math.random()*dur)).toFixed(2) + 's';

                starsContainer.appendChild(c);
            }
        }


function spawnMorphoParticles(opts){
            const count = (opts && opts.count) ? opts.count : 12;
            for(let i=0;i<count;i++){
                const p = document.createElement('div');
                p.className = 'morpho-particle';

                const isButterfly = Math.random() < 0.35;
                p.textContent = isButterfly ? 'ü¶ã' : '‚Ä¢';

                p.style.left = (Math.random()*100)+'vw';
                p.style.fontSize = isButterfly
                    ? (18 + Math.random()*18)+'px'
                    : (6 + Math.random()*6)+'px';

                if(!isButterfly){
                    p.style.color = 'rgba(255,255,255,0.85)';
                }

                p.style.setProperty('--dx', (-40 + Math.random()*80).toFixed(1)+'px');
                p.style.setProperty('--rot', (-20 + Math.random()*40).toFixed(1)+'deg');

                const dur = 14 + Math.random()*12;
                p.style.animationDuration = dur+'s';
                p.style.animationDelay = (-(Math.random()*dur))+'s';

                starsContainer.appendChild(p);
            }
        }


        function spawnSeaBubbles(opts){
            const count = (opts && opts.count) ? opts.count : 14;
            for(let i=0;i<count;i++){
                const b = document.createElement('div');
                b.className = 'sea-bubble';
                b.style.setProperty('--x', (Math.random()*100) + 'vw');
                const size = (6 + Math.random()*14).toFixed(0) + 'px';
                b.style.setProperty('--s', size);
                b.style.setProperty('--dx', (-20 + Math.random()*40).toFixed(1) + 'px');
                const dur = 8 + Math.random()*8;
                b.style.animationDuration = dur.toFixed(2) + 's';
                b.style.animationDelay = (-(Math.random()*dur)).toFixed(2) + 's';
                starsContainer.appendChild(b);
            }
        }


function spawnSeaFish(opts){
            const count = (opts && opts.count) ? opts.count : 10;
            const fishSet = ['üê†','üêü','üê°'];
            for (let i = 0; i < count; i++) {
                const f = document.createElement('div');
                f.className = 'sea-fish';
                f.textContent = fishSet[Math.floor(Math.random() * fishSet.length)];
                f.style.top = (8 + Math.random() * 72).toFixed(2) + 'vh';
                f.style.fontSize = (22 + Math.random() * 22).toFixed(0) + 'px';

                const scale = 0.85 + Math.random() * 0.7;
                f.style.setProperty('--s', scale.toFixed(3));

                const dy = -30 + Math.random() * 60;
                f.style.setProperty('--dy', dy.toFixed(1) + 'px');

                const r = -8 + Math.random() * 16;
                f.style.setProperty('--r', r.toFixed(1) + 'deg');

                const fromLeft = Math.random() < 0.5;
                f.style.setProperty('--fx', fromLeft ? '-1' : '1');
                f.style.animationName = fromLeft ? 'swim-right' : 'swim-left';

                const dur = 10 + Math.random() * 10;
                f.style.animationDuration = dur.toFixed(2) + 's';
                f.style.animationTimingFunction = 'linear';
                f.style.animationIterationCount = 'infinite';
                f.style.animationDelay = (-(Math.random() * dur)).toFixed(2) + 's';

                starsContainer.appendChild(f);
            }
        }

function spawnDiscoDots(opts){
            const count = opts.count ?? 40;
            const colors = opts.colors ?? ['rgba(255,255,255,0.9)'];
            const sizeMin = opts.sizeMin ?? 4;
            const sizeMax = opts.sizeMax ?? 10;
            const speedMin = opts.speedMin ?? 0.35;
            const speedMax = opts.speedMax ?? 0.7;

            for (let i = 0; i < count; i++) {
                const d = document.createElement('div');
                d.className = 'floating-circle';

                const size = (Math.random() * (sizeMax - sizeMin) + sizeMin);
                d.style.width = size + 'px';
                d.style.height = size + 'px';

                const col = colors[Math.floor(Math.random() * colors.length)];
                // „Åè„Å£„Åç„Çä„Åó„ÅüÂÖâÁÇπÔºà‰∏≠ÂøÉÊòé„Çã„Åè„ÄÅÂ§ñÂÅ¥ÈÄèÊòéÔºâ
                d.style.background = `radial-gradient(circle, rgba(255,255,255,0.95) 0%, ${col} 45%, rgba(255,255,255,0.0) 75%)`;
                d.style.opacity = '0.95';

                d.style.left = (Math.random() * 100) + '%';
                d.style.top = (-20 - Math.random() * 40) + 'px';
                d.style.setProperty('--ty', (110 + Math.random() * 20) + 'vh');

                // Ê®™ÊåØ„Çå„ÇíÂ∞ë„ÅóÂ§ß„Åç„ÇÅ„Å´„Åó„Å¶„ÄåÂõû„Å£„Å¶„ÇãÊÑü„Åò„Äç
                d.style.setProperty('--dx', (Math.random() * 120 - 60) + 'px');

                const speed = Math.random() * (speedMax - speedMin) + speedMin;
                const duration = Math.max(6, Math.min(24, 12 / speed));
                d.style.animationDuration = duration + 's';
                d.style.animationDelay = (-(Math.random() * duration)) + 's';

                starsContainer.appendChild(d);
            }
        }

function spawnFloatingCircles(opts) {
            const count = opts.count ?? 12;
            const colors = opts.colors ?? ['rgba(255,255,255,0.7)'];
            const sizeMin = opts.sizeMin ?? 6;
            const sizeMax = opts.sizeMax ?? 14;
            const speedMin = opts.speedMin ?? 0.2;
            const speedMax = opts.speedMax ?? 0.5;
            const direction = opts.direction ?? 'down'; // 'up' or 'down'

            for (let i = 0; i < count; i++) {
                const c = document.createElement('div');
                c.className = 'floating-circle';

                const size = (Math.random() * (sizeMax - sizeMin) + sizeMin);
                c.style.width = size + 'px';
                c.style.height = size + 'px';

                const base = colors[Math.floor(Math.random() * colors.length)];
                // Ê≥°„Å£„ÅΩ„ÅèÔºö‰∏≠Â§Æ„ÇíÂ∞ë„ÅóÊòé„Çã„Åè
                c.style.background = `radial-gradient(circle at 35% 30%, rgba(255,255,255,0.85), ${base} 55%, rgba(255,255,255,0.0) 72%)`;

                // ‰ΩçÁΩÆ
                c.style.left = (Math.random() * 100) + '%';
                if (direction === 'up') {
                    c.style.bottom = (-20 - Math.random() * 40) + 'px';
                    c.style.setProperty('--ty', (-110 - Math.random() * 20) + 'vh');
                } else {
                    c.style.top = (-20 - Math.random() * 40) + 'px';
                    c.style.setProperty('--ty', (110 + Math.random() * 20) + 'vh');
                }

                // Ê®™Êè∫„Çå
                c.style.setProperty('--dx', (Math.random() * 60 - 30) + 'px');

                // „Çπ„Éî„Éº„Éâ ‚Üí durationÔºàÈÄü„ÅÑ„Åª„Å©Áü≠„ÅÑÔºâ
                const speed = Math.random() * (speedMax - speedMin) + speedMin; // 0.2„Äú0.5ÊÉ≥ÂÆö
                const duration = Math.max(6, Math.min(30, 12 / speed)); // 0.2=>60(‰∏äÈôê30), 0.4=>30
                c.style.animationDuration = duration + 's';
                c.style.animationDelay = (-(Math.random() * duration)) + 's';

                starsContainer.appendChild(c);
            }
        }


        // LocalStorage„Åã„Çâ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        // „Çª„Éº„Éñ„Éá„Éº„Çø„ÅÆ„Ç®„É≥„Ç≥„Éº„Éâ„Éª„Éá„Ç≥„Éº„Éâ
        const SAVE_VERSION = '3'; // „Éê„Éº„Ç∏„Éß„É≥Ë≠òÂà•Â≠êÔºàV3=LZString+EncodedURIComponentÔºâ
        const SAVE_VERSION_V2 = 'V2_'; // Êóß„Éê„Éº„Ç∏„Éß„É≥ÔºàV2=LZString+Base64Ôºâ
        const SAVE_VERSION_V1 = 'V1_'; // Êóß„Éê„Éº„Ç∏„Éß„É≥ÔºàV1=Base64„ÅÆ„ÅøÔºâ
        
        // JSON„ÇíÂõ∫ÂÆöÈ†ÜÈÖçÂàó„Å´Â§âÊèõ„Åó„Å¶LZStringÂúßÁ∏Æ
        function encodeSaveData(data) {
            // Âõ∫ÂÆöÈ†Ü„ÅÆÈÖçÂàó„Å´Â§âÊèõ
            const arr = [
                data.lastInteraction,
                data.startDate,
                data.collectedStars,
                data.lastStarRegenTime,
                data.experience,
                data.rank,
                data.currentCharacter,
                data.currentBackground,
                data.unlockedCharacters,
                data.unlockedBackgrounds,
                data.username,
                data.ownedDecor,
                data.equippedDecor,
                data.decorPlacements,
                data.missionProgress,
                data.claimedMissions,
                data.dailyMissions,
                data.dailyClaimedMissions,
                data.dailyMissionProgress,
                data.lastDailyResetDate,
                data.collectedDiamonds,
                data.diamondSpawnedToday,
                data.lastDiamondSpawnDate,
                data.skillDiamondLevel,
                data.skillSpeedLevel,
                data.skillBonusLevel,
                data.lastPlayTime,
                data.idleRewardClaimed,
                data.currentTitle,
                data.unlockedTitles,
                data.titleProgress
            ];
            
            // JSONÊñáÂ≠óÂàóÂåñ„Åó„Å¶LZStringÂúßÁ∏ÆÔºàEncodedURIComponent„ÅØBase64„Çà„ÇäÁü≠„ÅÑÔºâ
            const jsonStr = JSON.stringify(arr);
            const compressed = LZString.compressToEncodedURIComponent(jsonStr);
            
            // „Éê„Éº„Ç∏„Éß„É≥ÊñáÂ≠ó„ÇíÂÖàÈ†≠„Å´‰ªò‰∏é
            return SAVE_VERSION + compressed;
        }
        
        // Base64/LZString„Çí„Éá„Ç≥„Éº„Éâ„Åó„Å¶Âõ∫ÂÆöÈ†ÜÈÖçÂàó„Åã„ÇâJSON„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Âæ©ÂÖÉ
        function decodeSaveData(encoded) {
            // „Éê„Éº„Ç∏„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØ
            if (encoded.startsWith(SAVE_VERSION)) {
                // V3ÂΩ¢ÂºèÔºàLZString+EncodedURIComponentÔºâ
                const compressed = encoded.substring(SAVE_VERSION.length);
                const jsonStr = LZString.decompressFromEncodedURIComponent(compressed);
                const arr = JSON.parse(jsonStr);
                
                return arrayToObject(arr);
            } else if (encoded.startsWith(SAVE_VERSION_V2)) {
                // V2ÂΩ¢ÂºèÔºàLZString+Base64Ôºâ
                const compressed = encoded.substring(SAVE_VERSION_V2.length);
                const jsonStr = LZString.decompressFromBase64(compressed);
                const arr = JSON.parse(jsonStr);
                
                return arrayToObject(arr);
            } else if (encoded.startsWith(SAVE_VERSION_V1)) {
                // V1ÂΩ¢ÂºèÔºàBase64„ÅÆ„ÅøÔºâ
                const base64 = encoded.substring(SAVE_VERSION_V1.length);
                const jsonStr = decodeURIComponent(escape(atob(base64)));
                const arr = JSON.parse(jsonStr);
                
                return arrayToObject(arr);
            } else {
                // ÊóßÂΩ¢ÂºèÔºàJSONÔºâ
                return JSON.parse(encoded);
            }
        }
        
        // ÈÖçÂàó„Çí„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ
        function arrayToObject(arr) {
            return {
                lastInteraction: arr[0],
                startDate: arr[1],
                collectedStars: arr[2],
                lastStarRegenTime: arr[3],
                experience: arr[4],
                rank: arr[5],
                currentCharacter: arr[6],
                currentBackground: arr[7],
                unlockedCharacters: arr[8],
                unlockedBackgrounds: arr[9],
                username: arr[10],
                ownedDecor: arr[11],
                equippedDecor: arr[12],
                decorPlacements: arr[13],
                missionProgress: arr[14],
                claimedMissions: arr[15],
                dailyMissions: arr[16],
                dailyClaimedMissions: arr[17],
                dailyMissionProgress: arr[18],
                lastDailyResetDate: arr[19],
                collectedDiamonds: arr[20],
                diamondSpawnedToday: arr[21],
                lastDiamondSpawnDate: arr[22],
                skillDiamondLevel: arr[23],
                skillSpeedLevel: arr[24],
                skillBonusLevel: arr[25],
                lastPlayTime: arr[26],
                idleRewardClaimed: arr[27],
                currentTitle: arr[28],
                unlockedTitles: arr[29],
                titleProgress: arr[30]
            };
        }
        
        function loadGameData() {
            const savedData = safeStorage.getItem('otofuGameData');
            if (savedData) {
                try {
                    // „Éá„Ç≥„Éº„ÉâÔºàÊóßÂΩ¢Âºè„ÉªÊñ∞ÂΩ¢Âºè‰∏°ÂØæÂøúÔºâ
                    const data = decodeSaveData(savedData);
                    
                    lastInteraction = data.lastInteraction || Date.now();
                    startDate = data.startDate || Date.now();
                    collectedStars = data.collectedStars !== undefined ? data.collectedStars : 10;
                    lastStarRegenTime = data.lastStarRegenTime || Date.now();
                    experience = data.experience || 0;
                    rank = data.rank || 1;
                    currentCharacter = data.currentCharacter || 'üåö';
                    currentBackground = data.currentBackground || 'night';
                    unlockedCharacters = data.unlockedCharacters || ['üåö'];
                    unlockedBackgrounds = data.unlockedBackgrounds || ['night'];
                    username = data.username || 'ÂêçÂâç„ÇíÂÖ•Âäõ';
                    ownedDecor = data.ownedDecor || {};
                    equippedDecor = data.equippedDecor || [null, null, null];
                    decorPlacements = data.decorPlacements || [null, null, null];
                    missionProgress = data.missionProgress || { talkCount: 0, pixivCount: 0 };
                    claimedMissions = data.claimedMissions || [];
                    dailyMissions = data.dailyMissions || [];
                    dailyClaimedMissions = data.dailyClaimedMissions || [];
                    dailyMissionProgress = data.dailyMissionProgress || { dailyTalkCount: 0, dailyPixivCount: 0, openedGacha: false, changedDecor: false };
                    lastDailyResetDate = data.lastDailyResetDate || null;
                    collectedDiamonds = data.collectedDiamonds || 0;
                    diamondSpawnedToday = data.diamondSpawnedToday || 0;
                    lastDiamondSpawnDate = data.lastDiamondSpawnDate || null;
                    skillDiamondLevel = (data.skillDiamondLevel !== undefined && data.skillDiamondLevel !== null) ? data.skillDiamondLevel : 0;
                    skillSpeedLevel = (data.skillSpeedLevel !== undefined && data.skillSpeedLevel !== null) ? data.skillSpeedLevel : 0;
                    skillBonusLevel = (data.skillBonusLevel !== undefined && data.skillBonusLevel !== null) ? data.skillBonusLevel : 0;
                    lastPlayTime = data.lastPlayTime || Date.now();
                    idleRewardClaimed = (data.idleRewardClaimed !== undefined) ? data.idleRewardClaimed : true;
                    currentTitle = data.currentTitle || 'newcomer';
                    unlockedTitles = data.unlockedTitles || ['newcomer'];
                    titleProgress = data.titleProgress || { pixivCount: 0, talkCount: 0, shopPurchaseCount: 0, totalDiamonds: 0, totalStars: 0 };
                } catch (e) {
                    // „Éá„Ç≥„Éº„ÉâÂ§±ÊïóÊôÇ„ÅØÂàùÊúüÂåñ
                    initializeDefaultData();
                }
            } else {
                initializeDefaultData();
            }
            
            // ÁâπÂÖ∏„ÇíÈÅ©Áî®
            character.textContent = currentCharacter;
            
            // ËÉåÊôØ„ÇØ„É©„ÇπÔºàmorpho„ÅÆ„Åø hue-shift „ÇíËøΩÂä†Ôºâ
            const keepModal = document.body.classList.contains('modal-open') ? ' modal-open' : '';
            document.body.className = (currentBackground + '-bg') + (currentBackground === 'morpho' ? ' hue-shift' : '') + keepModal;

            
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
            generateBackgroundEffect(currentBackground);
            usernameText.textContent = username;
            
            // „ÉÜ„Çπ„Éà„É¢„Éº„Éâ
            if (isTestMode()) {
                collectedStars = 500;
                collectedDiamonds = 50;
                rank = 100;
                // ÂÖ®„Ç≠„É£„É©„ÇØ„Çø„ÉºËß£Êîæ
                unlockedCharacters = ['üåö', 'üêµ', 'ü§°', 'üåù', 'üê∏', 'ü¶≠', 'üëÅÔ∏è', 'ü¶ß', 'üëπ', 'üëΩ', 'üê≤', 'üåû'];
                // ÂÖ®ËÉåÊôØËß£Êîæ
                unlockedBackgrounds = ['night', 'snow', 'forest', 'rain', 'rainbow', 'city', 'sakura', 'lava', 'aurora', 'dream', 'earth', 'toilet', 'music', 'love', 'cosmos', 'matrix', 'aqua', 'metro', 'hacker'];
                // ÂÖ®È£æ„ÇäËß£ÊîæÔºàÂêÑ1ÂÄãÔºâ
                ownedDecor = {
                    'üéà': 1, 'üç¶': 1, 'üç°': 1, '‚òïÔ∏è': 1,
                    'üéÄ': 1, 'üï∂Ô∏è': 1, 'üé§': 1, 'ü™¥': 1,
                    'üßÅ': 1, 'üçì': 1, 'üéÆ': 1, 'üé©': 1,
                    'ü´ß': 1, 'üß∏': 1
                };
                updateStarCounter();
                updateDiamondCounter();
                updateRankDisplay();
            } else {
                // „ÉÄ„Ç§„É§„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
                updateDiamondCounter();
            }
            
            // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Å®ÁîüÊàê
            checkAndResetDailyMissions();
            
            // È£æ„Çä„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
            renderPlaceableDecor();
        }
        
        // „Éá„Éï„Ç©„É´„Éà„Éá„Éº„Çø„ÅßÂàùÊúüÂåñ
        function initializeDefaultData() {
            startDate = Date.now();
            collectedStars = 10;
            lastStarRegenTime = Date.now();
            experience = 0;
            rank = 1;
            currentCharacter = 'üåö';
            currentBackground = 'night';
            unlockedCharacters = ['üåö'];
            unlockedBackgrounds = ['night'];
            username = 'ÂêçÂâç„ÇíÂÖ•Âäõ';
            ownedDecor = {};
            equippedDecor = [null, null, null];
            decorPlacements = [null, null, null];
            missionProgress = { talkCount: 0, pixivCount: 0 };
            claimedMissions = [];
            dailyMissions = [];
            dailyClaimedMissions = [];
            dailyMissionProgress = { dailyTalkCount: 0, dailyPixivCount: 0, openedGacha: false, changedDecor: false };
            lastDailyResetDate = null;
            collectedDiamonds = 0;
            diamondSpawnedToday = 0;
            lastDiamondSpawnDate = null;
            skillDiamondLevel = 0;
            skillSpeedLevel = 0;
            skillBonusLevel = 0;
            lastPlayTime = Date.now();
            idleRewardClaimed = true;
            currentTitle = 'newcomer';
            unlockedTitles = ['newcomer'];
            titleProgress = { pixivCount: 0, talkCount: 0, shopPurchaseCount: 0, totalDiamonds: 0, totalStars: 0 };
        }
        
        // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„ÅÆ„É™„Çª„ÉÉ„Éà„Å®ÁîüÊàê
        function checkAndResetDailyMissions() {
            const today = new Date().toDateString();
            
            // Êó•‰ªò„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åü„Çâ„É™„Çª„ÉÉ„Éà
            if (lastDailyResetDate !== today) {
                lastDailyResetDate = today;
                dailyMissionProgress = {
                    dailyTalkCount: 0,
                    dailyPixivCount: 0,
                    openedGacha: false,
                    changedDecor: false
                };
                dailyClaimedMissions = []; // „Éá„Ç§„É™„ÉºÂèó„ÅëÂèñ„ÇäÁä∂ÊÖã„ÇÇ„É™„Çª„ÉÉ„Éà
                
                // Êñ∞„Åó„ÅÑ„Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„Çí3ÂÄãÁîüÊàêÔºö1ÂÄã„ÅØ„ÉÄ„Ç§„É§Â†±ÈÖ¨„ÄÅ2ÂÄã„ÅØÊòüÂ†±ÈÖ¨
                const shuffledDiamond = [...dailyMissionTemplatesDiamond].sort(() => Math.random() - 0.5);
                const shuffledStar = [...dailyMissionTemplatesStar].sort(() => Math.random() - 0.5);
                
                dailyMissions = [
                    { id: `daily_${today}_0`, ...shuffledDiamond[0] }, // 1ÂÄãÁõÆÔºö„ÉÄ„Ç§„É§Â†±ÈÖ¨
                    { id: `daily_${today}_1`, ...shuffledStar[0] },    // 2ÂÄãÁõÆÔºöÊòüÂ†±ÈÖ¨
                    { id: `daily_${today}_2`, ...shuffledStar[1] }     // 3ÂÄãÁõÆÔºöÊòüÂ†±ÈÖ¨
                ];
                
                saveGameData();
            }
            
            // „ÉÄ„Ç§„É§„ÅÆÊó•‰ªò„É™„Çª„ÉÉ„Éà
            if (lastDiamondSpawnDate !== today) {
                diamondSpawnedToday = 0;
                lastDiamondSpawnDate = today;
                saveGameData();
            }
        }
        
        // LocalStorage„Å´„Éá„Éº„Çø‰øùÂ≠ò
        function saveGameData() {
            const data = {
                lastInteraction: lastInteraction,
                startDate: startDate,
                collectedStars: collectedStars,
                lastStarRegenTime: lastStarRegenTime,
                experience: experience,
                rank: rank,
                currentCharacter: currentCharacter,
                currentBackground: currentBackground,
                unlockedCharacters: unlockedCharacters,
                unlockedBackgrounds: unlockedBackgrounds,
                username: username,
                ownedDecor: ownedDecor,
                equippedDecor: equippedDecor,
                decorPlacements: decorPlacements,
                missionProgress: missionProgress,
                claimedMissions: claimedMissions,
                dailyMissions: dailyMissions,
                dailyClaimedMissions: dailyClaimedMissions,
                dailyMissionProgress: dailyMissionProgress,
                lastDailyResetDate: lastDailyResetDate,
                collectedDiamonds: collectedDiamonds,
                diamondSpawnedToday: diamondSpawnedToday,
                lastDiamondSpawnDate: lastDiamondSpawnDate,
                skillDiamondLevel: skillDiamondLevel,
                skillSpeedLevel: skillSpeedLevel,
                skillBonusLevel: skillBonusLevel,
                lastPlayTime: lastPlayTime,
                idleRewardClaimed: idleRewardClaimed,
                currentTitle: currentTitle,
                unlockedTitles: unlockedTitles,
                titleProgress: titleProgress
            };
            
            // „Ç®„É≥„Ç≥„Éº„Éâ„Åó„Å¶‰øùÂ≠ò
            const encoded = encodeSaveData(data);
            safeStorage.setItem('otofuGameData', encoded);
        }
        
        // Êòü„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
        function updateStarCounter() {
            if (isTestMode()) { collectedStars = 500; }
            document.getElementById('star-counter').textContent = `‚≠êÔ∏è √ó ${collectedStars}`;
            updateButtonStates();
        }
        
        // „ÉÄ„Ç§„É§„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
        function updateDiamondCounter() {
            if (isTestMode()) { collectedDiamonds = 50; }
            document.getElementById('diamond-counter').textContent = `üíé √ó ${collectedDiamonds}`;
        }
        
        // „É©„É≥„ÇØË°®Á§∫Êõ¥Êñ∞
        function updateRankDisplay() {
            document.getElementById('rank-display').textContent = `Rank ${rank}`;
        }
        
        // ÁµåÈ®ìÂÄ§„ÇíËøΩÂä†„Åó„Å¶„É©„É≥„ÇØ„Ç¢„ÉÉ„Éó„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        function addExperience(amount) {
            experience += amount;
            
            // „É©„É≥„ÇØ„Ç¢„ÉÉ„Éó„ÅÆË®àÁÆóÔºà100ÁµåÈ®ìÂÄ§„Åî„Å®„Å´„É©„É≥„ÇØ„Ç¢„ÉÉ„ÉóÔºâ
            const newRank = Math.floor(experience / 100) + 1;
            
            if (newRank > rank && newRank <= maxRank) {
                rank = newRank;
                updateRankDisplay();
                showDialogue(`„É©„É≥„ÇØ„Ç¢„ÉÉ„ÉóÔºÅRank ${rank} „Å´„Å™„Å£„Åüüéâ`, true);
                
                // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅßËÉåÊôØ„ÇíËß£Êîæ
                if (rank === 100 && !unlockedBackgrounds.includes('cosmos')) {
                    unlockedBackgrounds.push('cosmos');
                    showDialogue('Êñ∞„Åó„ÅÑËÉåÊôØ„Äå„Ç≥„Çπ„É¢„Äç„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅüí´', true);
                } else if (rank === 200 && !unlockedBackgrounds.includes('matrix')) {
                    unlockedBackgrounds.push('matrix');
                    showDialogue('Êñ∞„Åó„ÅÑËÉåÊôØ„Äå„Éû„Éà„É™„ÉÉ„ÇØ„Çπ„Äç„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅüî∑', true);
                } else if (rank === 300 && !unlockedBackgrounds.includes('aqua')) {
                    unlockedBackgrounds.push('aqua');
                    showDialogue('Êñ∞„Åó„ÅÑËÉåÊôØ„Äå„Ç¢„ÇØ„Ç¢„Äç„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅüíß', true);
                } else if (rank === 400 && !unlockedBackgrounds.includes('metro')) {
                    unlockedBackgrounds.push('metro');
                    showDialogue('Êñ∞„Åó„ÅÑËÉåÊôØ„Äå„É°„Éà„É≠„Éù„É™„Çπ„Äç„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅüèôÔ∏è', true);
                } else if (rank === 500 && !unlockedBackgrounds.includes('hacker')) {
                    unlockedBackgrounds.push('hacker');
                    showDialogue('Êñ∞„Åó„ÅÑËÉåÊôØ„Äå„Éè„ÉÉ„Ç´„Éº„Äç„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅüíª', true);
                }
            }
            
            saveGameData();
        }
        
        // „Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°ÂäπÁä∂ÊÖãÊõ¥Êñ∞
        function updateButtonStates() {
            const pixivBtn = document.getElementById('pixiv-btn');
            const gachaBtn = document.getElementById('gacha-btn');
            
            if (collectedStars >= 3) {
                pixivBtn.classList.remove('disabled');
            } else {
                pixivBtn.classList.add('disabled');
            }
            
            if (collectedStars >= 10) {
                gachaBtn.classList.remove('disabled');
            } else {
                gachaBtn.classList.add('disabled');
            }
        }
        
        // Êó•Êï∞„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
        // Êó¢Â≠ò„ÅÆÊòü„ÇíÊõ¥Êñ∞Ôºà„Ç≠„É£„É©„ÇØ„Çø„ÉºÂ§âÊõ¥ÊôÇÔºâ
        function updateExistingStars() {
            const stars = document.querySelectorAll('.collectible-star');
            let starColors;
            
            // „Ç≠„É£„É©„ÇØ„Çø„Éº„Å´Âøú„Åò„Å¶Êòü„ÅÆÁ®ÆÈ°û„ÇíË®≠ÂÆö
            switch(currentCharacter) {
                case 'ü§°': // „Éî„Ç®„É≠
                    starColors = ['ü©∏', 'üî™'];
                    break;
                case 'üêµ': // „Çµ„É´
                    starColors = ['üçå', '‚ùì'];
                    break;
                case 'üåù': // „É†„Éº„É≥
                    starColors = ['üí´', '‚ú®'];
                    break;
                case 'üê∏': // „Ç´„Ç®„É´
                    starColors = ['üíß', 'üíö'];
                    break;
                case 'ü¶≠': // „Ç¢„Ç∂„É©„Ç∑
                    starColors = ['üßä', 'üêü'];
                    break;
                case 'üëÅÔ∏è': // „Ç¢„Ç§
                    starColors = ['üëª', 'üñ§'];
                    break;
                case 'ü¶ß': // „Ç™„É©„É≥„Ç¶„Éº„Çø„É≥
                    starColors = ['üçå', 'üçé'];
                    break;
                case 'üí©': // „ÅÜ„Çì„Å°
                    starColors = ['ü§é', 'üßª'];
                    break;
                case 'ü•∫': // „Å¥„Åà„Çì
                    starColors = ['‚ö´Ô∏è', 'üü°'];
                    break;
                case 'üëπ': // „Ç™„Éã
                    starColors = ['ü©∏', 'üî™'];
                    break;
                case 'üëΩ': // „Ç®„Ç§„É™„Ç¢„É≥
                    starColors = ['üöÄ', 'üëæ'];
                    break;
                case 'üê≤': // „Éâ„É©„Ç¥„É≥
                    starColors = ['üî•', 'üîÆ'];
                    break;
                case 'üåû': // „Çµ„É≥
                    starColors = ['‚òÄÔ∏è', '‚ú®'];
                    break;
                case 'üòé': // „ÇØ„Éº„É´
                    starColors = ['ü§ò', 'üçæ'];
                    break;
                case 'ü¶Ñ': // „É¶„Éã„Ç≥„Éº„É≥
                    starColors = ['üó°Ô∏è', 'üõ°Ô∏è'];
                    break;
                default: // „Éá„Éï„Ç©„É´„ÉàÔºàüåö„Å™„Å©Ôºâ
                    starColors = ['‚≠êÔ∏è', 'üåü'];
            }
            
            stars.forEach(star => {
                // „ÉÄ„Ç§„É§„ÅØ„Åù„ÅÆ„Åæ„ÅæÁ∂≠ÊåÅ
                if (star.dataset.isDiamond === 'true') {
                    return;
                }
                // „É©„É≥„ÉÄ„É†„Å´Êòü„ÅÆÁ®ÆÈ°û„ÇíÂÜçË®≠ÂÆö
                star.textContent = starColors[Math.floor(Math.random() * starColors.length)];
            });
        }
        
        // ÂèéÈõÜÂèØËÉΩ„Å™Êòü„ÇíÁîüÊàê
        function spawnCollectibleStars() {
            const activeStars = characterArea.querySelectorAll(".collectible-star").length;
            if (activeStars >= 10) return;

            
            
            const star = document.createElement('div');
            star.className = 'collectible-star';
            
            // „ÉÄ„Ç§„É§„ÅÆÂá∫ÁèæÂà§ÂÆöÔºö1Êó•„ÅÆ‰∏äÈôê„ÅØskillDiamondLevel„Å´Âøú„Åò„Å¶Â¢óÂä†ÔºàÂü∫Êú¨1 + „Çπ„Ç≠„É´„É¨„Éô„É´Ôºâ
            const maxDiamondsPerDay = 1 + skillDiamondLevel;
            const isDiamond = diamondSpawnedToday < maxDiamondsPerDay && Math.random() < 0.05;
            
            if (isDiamond) {
                star.textContent = 'üíé';
                star.dataset.isDiamond = 'true';
                diamondSpawnedToday++;
                saveGameData();
            } else {
                // „Ç≠„É£„É©„ÇØ„Çø„Éº„Å´Âøú„Åò„Å¶Êòü„ÅÆÁ®ÆÈ°û„ÇíÂ§âÊõ¥
                let starColors;
                switch(currentCharacter) {
                    case 'ü§°': // „Éî„Ç®„É≠
                        starColors = ['ü©∏', 'üî™'];
                        break;
                    case 'üêµ': // „Çµ„É´
                        starColors = ['üçå', '‚ùì'];
                        break;
                    case 'üåù': // „É†„Éº„É≥
                        starColors = ['üí´', '‚ú®'];
                        break;
                    case 'üê∏': // „Ç´„Ç®„É´
                        starColors = ['üíß', 'üíö'];
                        break;
                    case 'ü¶≠': // „Ç¢„Ç∂„É©„Ç∑
                        starColors = ['üßä', 'üêü'];
                        break;
                    case 'üëÅÔ∏è': // „Ç¢„Ç§
                        starColors = ['üëª', 'üñ§'];
                        break;
                    case 'ü¶ß': // „Ç™„É©„É≥„Ç¶„Éº„Çø„É≥
                        starColors = ['üçå', 'üçé'];
                        break;
                    case 'üí©': // „ÅÜ„Çì„Å°
                        starColors = ['ü§é', 'üßª'];
                        break;
                    case 'ü•∫': // „Å¥„Åà„Çì
                        starColors = ['‚ö´Ô∏è', 'üü°'];
                        break;
                    case 'üëπ': // „Ç™„Éã
                        starColors = ['ü©∏', 'üî™'];
                        break;
                    case 'üëΩ': // „Ç®„Ç§„É™„Ç¢„É≥
                        starColors = ['üöÄ', 'üëæ'];
                        break;
                    case 'üê≤': // „Éâ„É©„Ç¥„É≥
                        starColors = ['üî•', 'üîÆ'];
                        break;
                    case 'üåû': // „Çµ„É≥
                        starColors = ['‚òÄÔ∏è', '‚ú®'];
                        break;
                    case 'üòé': // „ÇØ„Éº„É´
                        starColors = ['ü§ò', 'üçæ'];
                        break;
                    case 'ü¶Ñ': // „É¶„Éã„Ç≥„Éº„É≥
                        starColors = ['üó°Ô∏è', 'üõ°Ô∏è'];
                        break;
                    default: // „Éá„Éï„Ç©„É´„ÉàÔºàüåö„Å™„Å©Ôºâ
                        starColors = ['‚≠êÔ∏è', 'üåü'];
                }
                star.textContent = starColors[Math.floor(Math.random() * starColors.length)];
            }
            
            // üåö„ÅÆÂë®„Çä„Å´„É©„É≥„ÉÄ„É†„Å´ÈÖçÁΩÆÔºàÂÖ®‰ΩìÁöÑ„Å´Â∞ë„Åó‰∏ã„Å´Ôºâ
            let x, y;
            const angle = Math.random() * Math.PI * 2;
            const distance = 80 + Math.random() * 100;
            x = Math.cos(angle) * distance;
            y = Math.sin(angle) * distance;
            
            // Êòü„Ç´„Ç¶„É≥„Çø„Éº„ÅÆÈ´ò„Åï„ÇíÂèñÂæóÔºàÁ¥Ñ80pxÁ®ãÂ∫¶Ôºâ
            const minTopPosition = 100; // Êòü„Ç´„Ç¶„É≥„Çø„ÉºË°®Á§∫„ÅÆ‰∏ã
            
            // Ë®àÁÆó„Åï„Çå„Åü‰ΩçÁΩÆ
            const calculatedTop = window.innerHeight * 0.55 + y;
            
            // minTopPosition„Çà„Çä‰∏ä„Å´„ÅØÈÖçÁΩÆ„Åó„Å™„ÅÑ
            if (calculatedTop < minTopPosition) {
                // ‰∏ä„Å´Âá∫„Å¶„Åó„Åæ„ÅÜÂ†¥Âêà„ÅØ„ÄÅ‰∏ãÂÅ¥„Å´ÈÖçÁΩÆ
                y = Math.abs(y);
            }
            
            star.style.left = `calc(50% + ${x}px)`;
            star.style.top = `calc(55% + ${y}px)`;
            star.style.animationDelay = Math.random() * 2 + 's';
            
            // „Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
            star.addEventListener('click', (e) => {
                e.stopPropagation();
                collectStar(star);
            });
            
            star.addEventListener('touchend', (e) => {
                e.preventDefault();
                e.stopPropagation();
                collectStar(star);
            });
            
            characterArea.appendChild(star);
            collectibleStarsArray.push(star);
}
        
        // Êòü„ÇíÂõûÂèé
        function collectStar(starElement) {
            if (!starElement) return;
            if (starElement.classList.contains('collected')) return;
            
            const isDiamond = starElement.dataset.isDiamond === 'true';
            
            if (isDiamond) {
                // „ÉÄ„Ç§„É§„ÇíÂõûÂèé
                if (collectedDiamonds >= maxDiamonds) return;
                starElement.classList.add('collected');
                collectedDiamonds++;
                titleProgress.totalDiamonds++;
                updateDiamondCounter();
                addExperience(10);
                saveGameData();
                playStarSound();
                checkTitleUnlocks();
            } else {
                // Êòü„ÇíÂõûÂèé
                if (collectedStars >= maxStars) return;
                starElement.classList.add('collected');
                collectedStars++;
                titleProgress.totalStars++;
                updateStarCounter();
                addExperience(5);
                saveGameData();
                playStarSound();
                checkTitleUnlocks();
            }
            
            setTimeout(() => {
    if (starElement && starElement.parentNode) {
        starElement.parentNode.removeChild(starElement);
    }
    const index = collectibleStarsArray.indexOf(starElement);
    if (index > -1) {
        collectibleStarsArray.splice(index, 1);
    }
}, 500);
}
        
        // „Éú„Éº„Éä„ÇπÊúà„ÇíÁîüÊàê
        function spawnBonusMoon() {
            if (bonusMoonActive) return;
            
            const now = Date.now();
            // ÊúÄÂæå„ÅÆ„Éú„Éº„Éä„ÇπÊúà„Åã„ÇâÂ∞ë„Å™„Åè„Å®„ÇÇ2ÂàÜÁµåÈÅé„Åó„Å¶„ÅÑ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã
            if (now - lastBonusMoonTime < 120000) return;
            
            bonusMoonActive = true;
            lastBonusMoonTime = now;
            
            const moon = document.createElement('div');
            moon.className = 'bonus-moon';
            moon.textContent = 'üåõ';
            
            // Êòü„Ç´„Ç¶„É≥„Çø„Éº„Çà„Çä‰∏ã„Å´ÈÖçÁΩÆÔºà15%„Äú80%„ÅÆÁØÑÂõ≤Ôºâ
            const topPosition = Math.random() * 65 + 15; // 15-80%„ÅÆÁØÑÂõ≤
            moon.style.top = topPosition + '%';
            moon.style.left = '-100px';
            
            // „Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
            moon.addEventListener('click', (e) => {
                e.stopPropagation();
                collectBonusMoon(moon);
            });
            
            moon.addEventListener('touchend', (e) => {
                e.preventDefault();
                e.stopPropagation();
                collectBonusMoon(moon);
            });
            
            document.getElementById('game-container').appendChild(moon);
            
            // 8ÁßíÂæå„Å´Ëá™ÂãïÂâäÈô§Ôºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæåÔºâ
            setTimeout(() => {
                if (moon && moon.parentNode) {
                    moon.parentNode.removeChild(moon);
                }
                bonusMoonActive = false;
            }, 8000);
        }
        
        // „Éú„Éº„Éä„ÇπÊúà„ÇíÂõûÂèé
        function collectBonusMoon(moonElement) {
            if (!moonElement || moonElement.classList.contains('collected')) return;
            
            moonElement.classList.add('collected');
            
            // Êòü„Çí20ÂÄãËøΩÂä†ÔºàÊúÄÂ§ßÂÄ§„ÇíË∂Ö„Åà„Å™„ÅÑÔºâ
            const starsToAdd = Math.min(20, maxStars - collectedStars);
            collectedStars += starsToAdd;
            updateStarCounter();
            addExperience(25);
            saveGameData();
            
            playStarSound();
            
            // ÁâπÂà•„Å™„Çª„É™„Éï
            const bonusDialogues = [
                '„Éú„Éº„Éä„Çπ„Åç„Åüüåõ‚ú®',
                '„É©„ÉÉ„Ç≠„Éºüåõüåü',
                '„ÅÜ„Åä„Åä„Åäüåõüåõ',
                '„Åæ„Åò„Åãüåõ‚ú®‚ú®',
                'Á•ûÂºï„Åçüåõü§°'
            ];
            showDialogue(bonusDialogues[Math.floor(Math.random() * bonusDialogues.length)]);
            
            setTimeout(() => {
                if (moonElement && moonElement.parentNode) {
                    moonElement.parentNode.removeChild(moonElement);
                }
                bonusMoonActive = false;
            }, 500);
        }
        
        // „Éú„Éº„Éä„Çπ„ÇÆ„Éï„Éà„ÇíÁîüÊàê
        function spawnBonusGift() {
            if (bonusGiftActive) return;
            
            const now = Date.now();
            // ÊúÄÂæå„ÅÆ„Éú„Éº„Éä„Çπ„ÇÆ„Éï„Éà„Åã„ÇâÂ∞ë„Å™„Åè„Å®„ÇÇ5ÂàÜÁµåÈÅé„Åó„Å¶„ÅÑ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã
            if (now - lastBonusGiftTime < 300000) return;
            
            bonusGiftActive = true;
            lastBonusGiftTime = now;
            
            const gift = document.createElement('div');
            gift.className = 'bonus-gift';
            gift.textContent = 'üéÅ';
            
            // „É©„É≥„ÉÄ„É†„Å™È´ò„Åï„Å´ÈÖçÁΩÆÔºà15%„Äú80%„ÅÆÁØÑÂõ≤Ôºâ
            const topPosition = Math.random() * 65 + 15;
            gift.style.top = topPosition + '%';
            gift.style.left = '-100px';
            
            // „Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
            gift.addEventListener('click', (e) => {
                e.stopPropagation();
                collectBonusGift(gift);
            });
            
            gift.addEventListener('touchend', (e) => {
                e.preventDefault();
                e.stopPropagation();
                collectBonusGift(gift);
            });
            
            document.getElementById('game-container').appendChild(gift);
            
            // 10ÁßíÂæå„Å´Ëá™ÂãïÂâäÈô§Ôºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæåÔºâ
            setTimeout(() => {
                if (gift && gift.parentNode) {
                    gift.parentNode.removeChild(gift);
                }
                bonusGiftActive = false;
            }, 10000);
        }
        
        // „Éú„Éº„Éä„Çπ„ÇÆ„Éï„Éà„ÇíÂõûÂèé
        function collectBonusGift(giftElement) {
            if (!giftElement || giftElement.classList.contains('collected')) return;
            
            giftElement.classList.add('collected');
            
            // „ÉÄ„Ç§„É§„Çí1„Äú5ÂÄã„É©„É≥„ÉÄ„É†„Å´ËøΩÂä†
            const diamondsToAdd = Math.floor(Math.random() * 5) + 1;
            collectedDiamonds = Math.min(collectedDiamonds + diamondsToAdd, maxDiamonds);
            updateDiamondCounter();
            addExperience(100);
            saveGameData();
            
            playStarSound();
            
            // ÁâπÂà•„Å™„Çª„É™„Éï
            const giftDialogues = [
                `üíé${diamondsToAdd}ÂÄã„Åç„ÅüüéÅ‚ú®`,
                `„ÉÄ„Ç§„É§${diamondsToAdd}ÂÄãÔºÅüéÅüíé`,
                `„ÅÜ„Åä„Åäüíé√ó${diamondsToAdd}ÔºÅüéÅ`,
                `Á•ûÂºï„ÅçüéÅüíé${diamondsToAdd}`,
                `„Åæ„Åò„ÅãüéÅ‚ú®üíé${diamondsToAdd}`
            ];
            showDialogue(giftDialogues[Math.floor(Math.random() * giftDialogues.length)]);
            
            setTimeout(() => {
                if (giftElement && giftElement.parentNode) {
                    giftElement.parentNode.removeChild(giftElement);
                }
                bonusGiftActive = false;
            }, 600);
        }
        
        // È£æ„Çä„ÅÆÈÖçÁΩÆÁØÑÂõ≤„ÇíÂèñÂæó
        function getPlacementBounds() {
            const gameRect = gameContainer.getBoundingClientRect();
            const statusArea = document.getElementById('interaction-area');
            const usernameArea = document.getElementById('username-display');
            const rankArea = document.getElementById('rank-display');

            let top = 0;
            let bottom = gameRect.height;

            // ‰∏äÈÉ®„ÅÆUIÔºà„É¶„Éº„Ç∂„Éº„Éç„Éº„É†„ÄÅ„É©„É≥„ÇØÔºâ„ÅÆ‰∏ã
            if (usernameArea || rankArea) {
                top = 120; // Âõ∫ÂÆöÂÄ§
            }
            
            // ‰∏ãÈÉ®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç®„É™„Ç¢„ÅÆ‰∏ä
            if (statusArea) {
                const r = statusArea.getBoundingClientRect();
                bottom = Math.min(bottom, (r.top - gameRect.top) - 20);
            }

            return {
                top: top,
                bottom: bottom,
                width: gameRect.width,
                height: bottom - top
            };
        }

        // „Éá„Éï„Ç©„É´„Éà„ÅÆÈÖçÁΩÆ‰ΩçÁΩÆ
        function defaultPlacementForSlot(slot, bounds) {
            const positions = [
                { x: 0.15, y: 0.3 },  // Â∑¶‰∏ä
                { x: 0.75, y: 0.3 },  // Âè≥‰∏ä
                { x: 0.5, y: 0.6 }    // ‰∏≠Â§Æ‰∏ã
            ];
            return positions[slot] || { x: 0.5, y: 0.5 };
        }

        // clampÈñ¢Êï∞
        function clamp(val, min, max) {
            return Math.min(Math.max(val, min), max);
        }

        // È£æ„Çä„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderPlaceableDecor() {
            if (!placementArea) return;

            // „É¢„Éº„ÉÄ„É´Ë°®Á§∫‰∏≠„ÅØÈùûË°®Á§∫
            if (document.body.classList.contains('modal-open') || 
                closetModal.classList.contains('show') || 
                gachaModal.classList.contains('show') || 
                usernameModal.classList.contains('show') ||
                rankModal.classList.contains('show')) {
                placementArea.style.display = 'none';
                return;
            }
            
            placementArea.style.display = '';
            placementArea.innerHTML = '';

            const bounds = getPlacementBounds();

            for (let i = 0; i < 3; i++) {
                const emoji = equippedDecor[i];
                if (!emoji) continue;

                if (!decorPlacements[i]) decorPlacements[i] = defaultPlacementForSlot(i, bounds);

                const el = document.createElement('div');
                el.className = 'placeable-decor';
                el.textContent = emoji;
                el.dataset.slot = String(i);

                const px = decorPlacements[i].x * bounds.width;
                const py = bounds.top + (decorPlacements[i].y * bounds.height);
                el.style.left = `${px}px`;
                el.style.top = `${py}px`;

                let dragging = false;
                let longPressTimer = null;
                let offsetX = 0;
                let offsetY = 0;
                let startX = 0;
                let startY = 0;
                let hasMoved = false;

                const onDown = (e) => {
                    if (document.body.classList.contains('modal-open')) return;
                    
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    startX = clientX;
                    startY = clientY;
                    hasMoved = false;
                    
                    const rect = el.getBoundingClientRect();
                    offsetX = clientX - rect.left;
                    offsetY = clientY - rect.top;
                    
                    // Èï∑Êäº„ÅóÂà§ÂÆöÔºà300msÔºâ
                    longPressTimer = setTimeout(() => {
                        dragging = true;
                        el.classList.add('dragging');
                    }, 300);
                };

                const cancelLongPress = () => {
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }
                };

                const onMove = (e) => {
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    
                    // ÁßªÂãïË∑ùÈõ¢Ë®àÁÆó
                    const distance = Math.sqrt(Math.pow(clientX - startX, 2) + Math.pow(clientY - startY, 2));
                    
                    if (!dragging) {
                        // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÂâçÔºö10px‰ª•‰∏äÂãï„ÅÑ„Åü„Çâ„Ç≠„É£„É≥„Çª„É´
                        if (distance > 10) {
                            hasMoved = true;
                            cancelLongPress();
                        }
                        return;
                    }
                    
                    // „Éâ„É©„ÉÉ„Ç∞‰∏≠
                    e.preventDefault();
                    e.stopPropagation();

                    const gameRect = gameContainer.getBoundingClientRect();
                    const b = getPlacementBounds();
                    const rect = el.getBoundingClientRect();

                    const x = (clientX - gameRect.left) - offsetX;
                    const y = (clientY - gameRect.top) - offsetY;

                    const maxX = b.width - rect.width;
                    const minY = b.top;
                    const maxY = b.bottom - rect.height;

                    const cx = clamp(x, 0, maxX);
                    const cy = clamp(y, minY, maxY);

                    el.style.left = `${cx}px`;
                    el.style.top = `${cy}px`;
                };

                const onUp = (e) => {
                    cancelLongPress();
                    
                    if (!dragging) {
                        return;
                    }
                    
                    e.preventDefault();
                    e.stopPropagation();
                    dragging = false;
                    el.classList.remove('dragging');
                    
                    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÂÆåÂÖ®„Å´ÂÅúÊ≠¢
                    el.style.animation = 'none';
                    
                    // 0.1ÁßíÂæå„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÂÜçÈñãÔºà„Ç≠„É£„É©„ÇØ„Çø„Éº„Å®ÂêåÊúüÔºâ
                    setTimeout(() => {
                        el.style.animation = 'float 3s ease-in-out infinite';
                    }, 100);

                    const gameRect = gameContainer.getBoundingClientRect();
                    const b = getPlacementBounds();
                    const rect = el.getBoundingClientRect();

                    const x = rect.left - gameRect.left;
                    const y = rect.top - gameRect.top;

                    decorPlacements[i] = {
                        x: x / b.width,
                        y: (y - b.top) / b.height
                    };
                    saveGameData();
                };

                el.addEventListener('mousedown', onDown);
                el.addEventListener('mousemove', onMove);
                el.addEventListener('mouseup', onUp);
                el.addEventListener('mouseleave', () => {
                    if (!dragging) {
                        cancelLongPress();
                    }
                });
                el.addEventListener('touchstart', onDown, { passive: true });
                el.addEventListener('touchmove', onMove, { passive: false });
                el.addEventListener('touchend', onUp, { passive: false });
                el.addEventListener('touchcancel', () => {
                    cancelLongPress();
                    if (dragging) {
                        el.classList.remove('dragging');
                        dragging = false;
                    }
                }, { passive: true });

                placementArea.appendChild(el);
            }
        }

        // ÂäπÊûúÈü≥
        function playSound(frequency, duration, volume = 0.3) {
            // ÂàùÂõû„ÅÆ„É¶„Éº„Ç∂„ÉºÊìç‰ΩúÂæå„Å´È≥¥„Çâ„ÅôÂâçÊèê„ÄÇÂøµ„ÅÆ„Åü„ÇÅÂÜçÈñã„ÇíË©¶„Åô
            resumeAudio();

            // seContext / seMasterGain „ÅØ initAudioGraph() „ÅßÁî®ÊÑè„Åï„Çå„Çã
            if (!seContext || !seMasterGain) return;

            const oscillator = seContext.createOscillator();
            const gainNode = seContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(seMasterGain);

            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';

            // ÂÄãÂà•Èü≥Èáè * „Éû„Çπ„Çø„ÉºÔºà„Çπ„É©„Ç§„ÉÄ„ÉºÔºâ „ÅßÊúÄÁµÇÈü≥Èáè
            const base = Math.max(0.0001, volume);
            gainNode.gain.setValueAtTime(base, seContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, seContext.currentTime + duration);

            oscillator.start(seContext.currentTime);
            oscillator.stop(seContext.currentTime + duration);
        }
        
        function playStarSound() {
            playSound(800, 0.15, 0.2);
            setTimeout(() => playSound(1000, 0.1, 0.15), 50);
        }
        
        function playCharacterSound() {
            playSound(300, 0.1, 0.25);
        }
        
        function playActionSound() {
            playSound(700, 0.12, 0.2);
            setTimeout(() => playSound(900, 0.12, 0.18), 60);
            setTimeout(() => playSound(1100, 0.15, 0.15), 120);
        }
        
        function playCollectAllSound() {
            // „Ç≠„É©„Ç≠„É©„Åó„Åü‰∏äÊòáÈü≥
            playSound(600, 0.08, 0.25);
            setTimeout(() => playSound(700, 0.08, 0.25), 40);
            setTimeout(() => playSound(800, 0.08, 0.25), 80);
            setTimeout(() => playSound(900, 0.08, 0.25), 120);
            setTimeout(() => playSound(1000, 0.08, 0.25), 160);
            setTimeout(() => playSound(1200, 0.15, 0.3), 200);
        }
        
        // „Çª„É™„Éï„Éá„Éº„Çø
        const allDialogues = [
            "„ÇìÔºü„Å™„Å´Ôºüüåö", "„Åä„Åò„Åï„Çì‰ªäÂøô„Åó„ÅÑ„Çì„Å†„Åë„Å©üôâ", "„Çø„ÉÉ„Éó„Åô„Çì„Å™„Çà...ü§°ü§°",
            "üê∏", "‰Ωï„ÅãÁî®Ôºüü•∞", "Ë©±„Åó„Åã„Åë„Å¶„Åè„Çå„Çã„ÅÆÔºüüåöüåö",
            "„ÅØ„ÅÅ...„Åæ„Åò„ÅßÁµµÊèè„Åë„Å™„ÅÑ„Çì„Å†„Çà„Å™üåöüåö", "„Åä„Åò„Åï„ÇìÁóÖ„Çì„Åß„Çã„Çèüê∏üê∏",
            "„É°„É≥„Çø„É´„ÇÑ„Å∞„ÅÑüôâüôâ", "„Åæ„Åò„Åã...„Åæ„ÅüÊèè„Åë„Å™„ÅÑüôâüê∏",
            "ÊßãÂõ≥Á†¥Á∂ª„Åó„Å¶„Çã„Çèü§°ü§°", "Ëá™ÂàÜ„ÅÆÁµµ„Åå‰∏ãÊâã„Åô„Åé„Çãü•∞ü•∞",
            "pixivË¶ã„Å¶„Åü„ÇâÊôÇÈñìÊ∫∂„Åë„Åüü§°ü§°", "TwitterË¶ã„Çã„Å†„Åë„ÅÆÊó•„ÄÖ„Å™„Çì„Å†„Çà„Å™üåö",
            "BLÊº´ÁîªË™≠„Çì„Åß„Çã„Åª„ÅÜ„Åå„Éû„Ç∑üôâüôâ", "„Çπ„É©„É≥„Éó„Åô„Åé„Å¶Ëæõ„ÅÑü•∞ü•∞",
            "Á≠ãËÇâÊèè„Åë„Å™„ÅÑ„Çì„Å†„Çà„Å™...üåöüåö", "„Çπ„Éö„Éº„ÇπËÅ¥„ÅÑ„Å¶„ÇÇÊèè„Åë„Å™„ÅÑü•∞",
            "Ë§êËâ≤Áî∑Â≠êÊèè„Åç„Åü„ÅÑ„ÅÆ„Å´Êèè„Åë„Å™„ÅÑüåö", "ËÑá„Éï„Çß„ÉÅ„Å™„ÅÆ„Å´ËÑá„ÅåÊèè„Åë„Å™„ÅÑü•∞ü•∞",
            "„Åæ„Åò„Åß‰ªäÊó•Ë™øÂ≠ê„ÅÑ„ÅÑÔºÅü•∞ü•∞", "ÁµµÊèè„Åè„ÅÆ„Åæ„Åò„ÅßÊ•Ω„Åó„ÅÑÔºÅüåöüåö",
            "„Åì„ÅÆÊßãÂõ≥ÂÆåÁíß„Åò„ÇÉ„Çìü§°ü§°", "„Éï„Ç©„É≠„ÉØ„ÉºÂ¢ó„Åà„Å¶Â¨â„Åó„ÅÑüê∏üê∏",
            "„ÅÑ„ÅÑ„Å≠„Åü„Åè„Åï„Çì„Å§„ÅÑ„ÅüÔºÅüôâü•∞", "RT„Åï„Çå„Åæ„Åè„Å£„Å¶„Çãü§°üåö",
            "Á≠ãËÇâÂÆåÁíß„Å´Êèè„Åë„ÅüÔºÅü•∞ü•∞", "„ÇÅ„Å°„ÇÉ„Åè„Å°„ÇÉ„ÅÑ„ÅÑÁµµÊèè„Åë„Åüüåöüåö",
            "„Åæ„Åò„Åã„ÄÅ„Éê„Ç∫„Å£„Å¶„Çãüê∏ü§°", "„Åì„ÅÆÁ≠ãËÇâ„Åà„Å£„Å°„Å†„Å™üôâüôâ",
            "„Åß„ÇÇ„Åæ„Å†ÊîπÂñÑÁÇπ„ÅÇ„Çã„Å™ü•∞", "‰ªñ„ÅÆ‰∫∫„Å®ÊØî„Åπ„Åü„ÇâÂæÆÂ¶ô„Åã„ÇÇü§°ü§°",
            "Ëâ≤Â°ó„Çä„Ç¥„Éü„Åô„Åéüåöüåö", "Á∑öÁîªÊ±ö„Åô„Åé„Å¶ÁÑ°ÁêÜü•∞ü•∞",
            "Áµµ„ÅåÊ∞óÊåÅ„Å°ÊÇ™„ÅÑüôâüôâ", "„Éê„É©„É≥„Çπ„Åä„Åã„Åó„ÅÑ„Çì„Å†„Çà„Å™ü§°üê∏",
            
            // „Å°„ÅÑ„Åã„ÇèÈñ¢ÈÄ£
            "„Å°„ÅÑ„Åã„ÇèÂèØÊÑõ„Åô„Åé„ÇÑ„Ççü•∞ü•∞",
            "„Å°„ÅÑ„Åã„Çè„Ç∞„ÉÉ„Ç∫Ê¨≤„Åó„ÅÑüåöüåö", "„Å°„ÅÑ„Åã„ÇèË¶ã„Å¶„Çã„Å®Áôí„Åï„Çå„Çãüê∏üê∏",
            
            // „Éú„É≥„Éê„Éº„Åï„ÇìÈñ¢ÈÄ£
            "„Éú„É≥„Éê„Éº„Åï„Çì„ÅÆÁµµ„Åæ„Åò„ÅßÂ•Ω„Åçü§°ü§°", "„Éú„É≥„Éê„Éº„Åï„Çì„ÅÆÂ°ó„ÇäÁ•û„Åô„Åé„Çãü•∞ü•∞",
            "„Éú„É≥„Éê„Éº„Åï„Çì„Åø„Åü„ÅÑ„Å´Êèè„Åç„Åü„ÅÑüåöüåö",
            
            // „Ç®„É≥„Éö„É©ÊßòÈñ¢ÈÄ£
            "„Ç®„É≥„Éö„É©Êßò„ÅÆÊñ∞‰Ωú„Åç„ÅüÔºÅüôâüôâ",
            "„Ç®„É≥„Éö„É©Êßò„ÅÆÂãïÁîªË¶ã„Çã„Åúü§°ü§°", "„Ç®„É≥„Éö„É©ÊßòÊúÄÈ´ò„Å™„Çì„Å†„Çà„Å™ü•∞ü•∞",
            "„Ç®„É≥„Éö„É©Êßò„ÅÆÂÆüÊ≥Å„Åä„ÇÇ„Çç„ÅÑüåöüåö", "„Ç®„É≥„Éö„É©Êßò„ÅÆÊñ∞‰ΩúÂæÖ„Å£„Å¶„Åüüê∏üê∏",
            
            // „Ç∑„Éô„É™„Ç¢„É≥„Éè„Çπ„Ç≠„Éº„ÉªÁãºÁä¨Èñ¢ÈÄ£
            "Â≠êÁä¨„ÅÆÂãïÁîªË¶ã„Å¶„Çã„Å®Âπ∏„Åõü•∞ü•∞", "„Éè„Çπ„Ç≠„Éº„Åã„Çè„ÅÑ„Åô„Åé„ÇÑ„Ççüåöüåö",
            "YouTubeË¶ã„Å¶„Åü„ÇâÊôÇÈñìÊ∫∂„Åë„Åüüê∏üê∏",
            
            // ‰ªï‰∫ãÂ´å„ÅÑ
            "‰ªï‰∫ãË°å„Åç„Åü„Åè„Å™„ÅÑüåöüåö", "‰ªï‰∫ãËæõ„Åô„Åé„Çãüê∏üê∏",
            "‰ªï‰∫ã„ÇÑ„ÇÅ„Åü„ÅÑüôâüôâ", "Áµµ„Å†„ÅëÊèè„ÅÑ„Å¶Áîü„Åç„Åü„ÅÑü•∞ü•∞",
            
            // ‰∫åÊ¨°ÂÖÉ„ÅÆÁî∑„ÅÆÂ•Ω„Åø
            "Ë§êËâ≤ËÇå„Åà„Å£„Å°„Åô„Åé„Çãü§°ü§°",
            "ËÑá„Åæ„Åò„ÅßÂ•Ω„Åçü•∞ü•∞", "ËÖπÁ≠ã„ÇÑ„Å∞„ÅÑüåöüåö",
            "„Éî„Ç¢„Çπ„Å§„ÅÑ„Å¶„ÇãÁî∑Â•Ω„Åçüê∏üê∏", "„Éà„É©„Ç§„Éê„É´„Çø„Éà„Ç•„Éº„Åà„Å£„Å°üôâüôâ",
            "Èªí„Çø„É≥„ÇØ„Éà„ÉÉ„Éó„ÅÆÁ≠ãËÇâ„Åæ„Åò„ÅßÂ∞ä„ÅÑü•∞ü•∞",
            
            // È£ü‰∫ãÈñ¢ÈÄ£
            "ËíôÂè§„Çø„É≥„É°„É≥È£ü„Åπ„Åü„ÅÑüåöüåö", "Ëæõ„ÅÑ„ÇÇ„ÅÆÈ£ü„Åπ„Çã„Åúüê∏üê∏",
            "‰ªäÊó•„ÅØ„ÅÇ„Çì„ÅæÈ£ü„Åπ„Å¶„Å™„ÅÑüôâ",
            
            // ‰∏ã„Éç„Çø
            "„Å°„Çì„Å°„Çìü§°", "„Å°„Çì„Å°„ÇìÊèè„Åç„Åü„ÅÑüôâüôâ",
            
            // Áµµ„Å∏„ÅÆ„Çπ„Éà„Ç§„ÉÉ„ÇØ„Åï„Éª„Çπ„É©„É≥„Éó
            "„ÇÇ„Å£„Å®‰∏äÊâã„Åè„Å™„Çä„Åü„ÅÑüåöüåö", "„Åæ„Å®„ÇÇ„Å™Áµµ„ÅåÊèè„Åë„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åü„ÅÑü•∞ü•∞",
            "„Ç≥„É≥„Éà„É©„Éù„Çπ„Éà„ÅåÊ±∫„Åæ„Çâ„Å™„ÅÑüôâüôâ", "ÁµµÊüÑÂàÜÊûê„Åó„Å¶„Åü„ÇâÊôÇÈñìÊ∫∂„Åë„Åüü§°ü§°",
            "‰ªäÊó•„ÅØ„Çπ„É©„É≥„Éó„Å†„Çèüê∏üê∏", "Áµµ„Åå‰∏ãÊâã„Åô„Åé„Å¶Ê≠ª„Å´„Åü„ÅÑüåöüåö",
            "1‰∏á„ÅÑ„ÅÑ„Å≠ÁõÆÊåá„Åô„Åúü•∞ü•∞",
            
            // ÈçµÂû¢ÂºïÁî®„ÉªÊÇ™Âè£
            "È°îÁ†¥Á∂ª„Åó„Å¶„ÇãÁµµ„ÅßÁ¨ë„Å£„Å¶„Åó„Åæ„ÅÜüôâüôâ", "„Åì„ÅÆÁµµÈ°î„Åä„Åã„Åó„ÅÑ„Å†„Ççü§°ü§°",
            "„Éá„ÉÉ„Çµ„É≥ÁãÇ„ÅÑ„Åô„Åé„ÇÑ„Ççüåöüåö", "„Åì„ÅÆÁµµ„ÅßÁ¨ë„Å£„Å¶„Åó„Åæ„ÅÜüê∏üê∏",
            
            // Âè£Áôñ
            
            "‰ªäÊó•„ÅØÁ≠ãËÇâÊèè„Åè„Åúü•∞ü•∞",
            "„Ç≥„É≥„Éà„É©„Éù„Çπ„ÉàÊÑèË≠ò„Åô„Çã„Åúüåöüåö", "ÁµµÊüÑÂàÜÊûê„Åô„Çã„Åãüê∏üê∏",
            "„ÇÇ„Å£„Å®‰∏äÊâã„Åè„Å™„Çä„Åü„ÅÑü•∞ü•∞", "‰ªäÊó•„ÅØË§êËâ≤Êèè„Åè„Åúüôâüôâ",
            
            // ---- Êñ∞Ë¶èËøΩÂä†„Çª„É™„Éï ----
            "‰∏ÄËò≠„Å£„Å¶„Å°„Çá„Å£„Å®„Éà„ÉÉ„Éî„É≥„Ç∞„Åó„Åü„Çâ1500ÂÜÜ„Åè„Çâ„ÅÑ„Å´„Å™„Çã„Çà„Å™üôâ",
            "„Ç¢„Çπ„Éë„É©„Ç¨„Çπü•∞",
            "22:22üåö",
            "„Éè„É†„Å°„ÇìÔºÅ„Éè„É†„Å°„ÇìËß¶„Çã„Åß„ÅôÔºÅü§°",
            "„Å™„Çì„ÅßÂ•≥ÊÄßÁµµÊèè„Åç„Å£„Å¶ÂÖ®Âì°Áå´È£º„Å£„Å¶„Çã„Çì„Å†Ôºüüê∏",
            "„Ç∑„Éô„É™„Ç¢„É≥„Éè„Çπ„Ç≠„ÉºÈ£º„ÅÑ„Å¶„Åá„Äúü•∞ü•∞",
            "ÈçµÂû¢ÂºïÁî®„É™„ÉÑ„Ç§„Éº„Éà„Å†„Åë„ÅåÂîØ‰∏Ä„ÅÆÊ•Ω„Åó„Åøüôâüôâ",
            "„Éê„Çπ„Ç±ÈÉ®„Å®ËªΩÈü≥ÈÉ®„Å®„Çµ„ÉÉ„Ç´„ÉºÈÉ®„ÅÆÁî∑„ÄÅÁµêÂ©ö„Åó„Å¶„Åè„Çåüåöüåö",
            "ChuÔºÅ ÂèØÊÑõ„Åè„Å¶„Åî„ÇÅ„Çì‚ô™ü§°ü•∞",
            "Ë™øÂ≠ê‰πó„Å£„Å¶„Éü„ÉÉ„Ç∑„Éß„É≥Â¢ó„ÇÑ„Åó„Åô„Åé„Åü„Åã„ÇÇ „Åô„Åæ„Å¨üê∏",
            "Ëàê„ÇÅ„ÅüÈ°îÊèè„Åè„Å™üëπ",
            "Êùø„ÉÅ„Éß„Ç≥„Åø„Åü„ÅÑ„Å™ËÖπÁ≠ãÊèè„Åè„ÅÆ„ÇÑ„ÇÅ„Å¶„Åè„Çåüôâ",
            "„ÉØ„É≥„Éâ„É≠„Å£„Å¶Ë®Ä„Å£„Å¶ÂÆü„ÅØ3ÊôÇÈñì„Åè„Çâ„ÅÑ„Åã„Åë„Å¶„ÇãÁµµÊèè„Åç„Å®„Åã„ÅÑ„Åù„ÅÜüåö",
            "Â∞ëÂ•≥Êº´Áîª„Å£„Å¶„Å©„Å£„Å°„Åã„ÅåÈ¢®ÈÇ™„Å´„Å™„Å£„Å¶ÁúãÁóÖ„Å´Ë°å„Åè„Ç∑„ÉÅ„É•„Ç®„Éº„Ç∑„Éß„É≥„ÇÑ„Åü„Çâ„Å®Â§ö„Åè„Å™„ÅÑÔºüü§°",
            "Âèó„Åë„Å†„Åã„Çâ„Å®„ÅÑ„Å£„Å¶„Å°„Çì„Å°„Çì„ÅåÂ∞è„Åï„Åè„Å¶„ÅÑ„ÅÑ„Çè„Åë„Åò„ÇÉ„Å™„ÅÑüôâüôâ",
            "„Éù„ÉÅ„É≥„Ç≠ü•∞",
            "„Ç∑„Éô„É™„Ç¢„É≥„Éè„Çπ„Ç≠„Éº„Å£„Å¶Êì¨‰∫∫Âåñ„Åó„Åü„Çâ„Ç§„Ç±„É°„É≥„ÅåÁ¥ÑÊùü„Åï„Çå„Çã„Éì„Ç∏„É•„Åó„Å¶„Çã„Çà„Å™üåöüåö",
            "ÂêçÂâç„Å´„ÄåÁâô„Äç„Å®„Åã„ÄåÈæç„Äç„Å®„Åã„Å§„ÅÑ„Å¶„ÇãÁî∑„Ç≠„É£„É©„ÄÅÂ§ß‰Ωì„Åä„Åò„Åï„Çì„ÅÆÂ•Ω„ÅøË™¨üê∏",
            "Ë§êËâ≤„Çø„Éà„Ç•„Éº„Éî„Ç¢„Çπ„Å†„Å£„Åü„Çâ„Å™„Çì„Åß„ÇÇ„ÅÑ„ÅÑ„Çè„Åë„Åò„ÇÉ„Å™„ÅÑ„Çì„Åß„Åô „Åä„Åò„Åï„Çì„ÅØ„ÄåÈ≠Ç„Äç„ÇíË¶ã„Å¶„ÅÑ„Çã„Çì„Åß„ÅôüëÅÔ∏è",
            "„ÅÇ„Å£ „Ç∑„ÉÜ„Ç£„Éò„Éñ„É≥Ë¶ã„Åæ„Åó„Åüü§°",
            "„Åù„Çç„Åù„Çç‰ºëÊÜ©„Åó„Å™„ÅÑÔºüü•∞",
            "„ÇÇ„Åó„Éé„Éº„É´„ÉÉ„ÇØ„Åß„Çø„ÉÉ„ÉóÈÄ£Êâì„Åï„Çå„Å¶„Å¶„Åì„ÅÆ„Çª„É™„ÉïÂÖ®ÁÑ∂Ë™≠„Åæ„Çå„Å¶„Å™„Åã„Å£„Åü„Çâ„Å©„ÅÜ„Åó„Çà„ÅÜüôâ",
            "„ÉØ„ÇØ„ÉØ„ÇØ„Åï„Çì„Å£„Å¶‰ªä‰Ωï„Åó„Å¶„Çã„Çì„Å†„Ççüåö",
            "BLÊº´Áîª„Å®„ÅãÂêå‰∫∫Ë™å„Å£„Å¶ÊØéÂõû‰∏ãÊ∫ñÂÇô„Å®„Åã„Åó„Å¶„Å™„ÅÑ„Åë„Å©„ÅÇ„Çå„Å©„ÅÜ„Å™„Å£„Å¶„Çì„Å†üê∏",
            "„Ç∞„ÉüË∂Ö„ÅÜ„ÇÅ„Åáü•∞ü•∞",
            "„Åü„Åæ„Å´ÂïÜÂ∫óË°ó„Å´„Å©„ÅÜ„ÇÑ„Å£„Å¶ÁîüË®à„ÇíÁ´ã„Å¶„Å¶„Çã„ÅÆ„Åã„Çè„Åã„Çâ„Å™„ÅÑË¨é„ÅÆÂ∫ó„Å™„ÅÑÔºüü§°",
            
            // ÁîüÊ¥ª„ÉªÊó•Â∏∏
            "ÊúÄËøëÊúùËµ∑„Åç„Çå„Å™„Åè„Å™„Å£„Å¶„Åç„Åü",
            "Â§ßÂ••Ë®òRTAË¶ã„Çã„Å®È¨±„ÅåÊîπÂñÑ„Åô„Çã",
            "„Å≤„Çâ„Åç„Å£„Å±„Å™„Åó„Å†„Åã„ÇâÁõÆ„Åå‰πæ„ÅÑ„Å¶„Åç„Åü",
            "„Åü„Åæ„Å´„ÅØÊ®™„Å´„ÇÇÂãï„Åç„Åü„ÅÑ„Å™",
            "YouTube„Å®pixiv„Å®TwitterË¶ã„Å¶„Åü„Çâ‰ºëÊó•„ÅåÁµÇ„Çè„Å£„Å¶„Çã",
            "„ÇÇ„Åó„Åã„Åó„Å¶ÊöáÔºü",
            "„Åä„Åò„Åï„Çì„Å®Êúù„Åæ„ÅßË™û„ÇäÊòé„Åã„Åù„ÅÜü•∏",
            "ÈÄ£Êâì„Åó„Å¶„Çã„Å®ËÖïÁñ≤„Çå„Å™„ÅÑÔºü",
            "ËÄ≥„Åã„ÅçASMR„Å£„Å¶„ÅÑ„ÅÑ„Çà„Å≠",
            "„Ç≥„Éº„ÉâÊõ∏„Åè„ÅÆÁñ≤„Çå„Åüü•±",
            "„Çµ„Éñ„Çπ„ÇØÂÖ•„Å£„Å¶„Å™„Çì„Åß„ÇÇË¶ã„Çå„Çã„Å£„Å¶„Å™„Çã„Å®ÈÄÜ„Å´Ë¶≥„ÇãÊ∞ó„Å™„Åè„Å™„Çã„Çà„Å≠",
            "Â∞èÂûãÁä¨„Çà„ÇäÂ§ßÂûãÁä¨Ê¥æüê∂",
            "„Çπ„ÉöËá™ÂàÜ„ÅßÈñã„Åè„ÅÆ„Å£„Å¶„Éè„Éº„Éâ„É´È´ò„ÅÑ„Çà„Å≠",
            "Ââç„Éñ„É©„ÉÉ„ÇØ„Éá„Éì„É´Âê∏„Å£„Å¶„Åù„ÅÜ„Å£„Å¶Ë®Ä„Çè„Çå„Åü„Åë„Å©„ÅÇ„ÇåÊÇ™Âè£„Å†„Å®ÊÄù„ÅÜ",
            "Èô∞„Ç≠„É£„Åô„Åé„Å¶ÊØéÂõûÁæéÂÆπÂ∏´„Åï„Çì„Å®„ÅÆ‰ºöË©±Âõ∞„Çã",
            "‰ªäÊó•„ÇÇÊù•„Å¶„Åè„Çå„Å¶„ÅÇ„Çä„Åå„Å®„ÅÜüåö",
            "ÁÑºËÇâ„Å£„Å¶„Çø„É≥„Åå‰∏ÄÁï™‰∏äÊâã„ÅÑ„Çà„Å™",
            "„Çπ„Éö„Åß‰∏Ä‰∫∫„ÅßË©±„ÅóÁ∂ö„Åë„Çâ„Çå„Çã‰∫∫„Å£„Å¶„Åô„Åî„ÅÑ„Çà„Å™",
            
            // Twitter„ÉªSNS
            "Twitter„ÅÆ„Çø„Ç§„É†„É©„Ç§„É≥„Å´ËààÂë≥„Å™„ÅÑ„ÇÇ„ÅÆ„ÅåÂª∂„ÄÖ„Å®ÊµÅ„Çå„Å¶„Åè„Çã„ÅÆÂ´å„Çà„Å≠",
            
            // „Ç≤„Éº„É†Èñ¢ÈÄ£
            "„Åì„ÅÆËÉåÊôØ„ÅÑ„ÅÑ„Çà„Å≠",
            "„ÇÇ„ÅÜ„Ç¨„ÉÅ„É£„Ç≥„É≥„Éó„Åó„ÅüÔºü",
            "Ê¨°„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„ÅØ„ÅÑ„Å§„Å´„Å™„Çã„ÅÆ„Åã„Å≠",
            "„Åù„Çç„Åù„Çç„ÇÑ„Çã‰∫ã„Å™„Åè„Å™„Å£„Å¶„Åç„ÅüÔºü",
            "„Éê„Ç∞„ÅåË¶ã„Å§„Åã„Å£„Åü„ÇâÊïô„Åà„Å¶„Å≠",
            "„Å©„ÅÜ„Åõ„Åä„Åò„Åï„Çì„ÅÆ„Çª„É™„Éï„Åò„ÇÉ„Å™„Åè„Å¶ÁµåÈ®ìÂÄ§„Å®„Éü„ÉÉ„Ç∑„Éß„É≥„ÅåÁõÆÂΩì„Å¶„Å™„Çì„Åß„Åó„Çáüòü",
            "„ÅΩ„Å°„Å£",
            "if(tap){}",
            "tap_count += 1",
            "„ÉÜ„Ç≠„Çπ„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì",
            "„Åì„Åì„Çí„Éü„ÉÉ„Ç∑„Éß„É≥„ÅÆ„Åü„ÇÅ„Å´‰ΩïÂçÉÂõû„ÇÇ„Çø„ÉÉ„Éó„Åô„Çã„ÅÆÂÜ∑Èùô„Å´ËÄÉ„Åà„Å¶ÁãÇ„Å£„Å¶„Çã„Åû",
            
            // ÊÄßÁôñ„ÉªÂ•Ω„ÅøË™û„Çä
            "ÁôæÂêà„Å£„Å¶„Å©„Åì„Åå„ÅÑ„ÅÑ„Çì„Å†",
            "Â•Ω„Åç„Å™„Ç≠„É£„É©„ÅÆ‰π≥È¶ñ„ÅÆËâ≤„ÇíÊÉ≥ÂÉè„Åó„Å¶„Åü„Çâ1Êó•„ÅåÁµÇ„Çè„Å£„Å¶„Åü",
            "„Å°„Çì„Å°„Çì„ÅØ„Åß„Åã„Åë„Çä„ÇÉ„ÅÑ„ÅÑ„Å£„Å¶„ÇÇ„Çì„Åò„ÇÉ„Å™„ÅÑ „Åù„ÅÆ„Ç≠„É£„É©„Å´Âêà„Çè„Åõ„ÅüÊúÄÈÅ©„Å™„Çµ„Ç§„Ç∫„Åå„ÅÇ„Çã",
            "„Éî„Ç¢„Çπ„ÅÆÈñã„ÅëÊñπ„Åß„ÇÇ„Ç®„É≠„Åï„ÅåÂ§â„Çè„Çã„Çà„Å≠ ÁîªÈã≤„Å®Ê∂à„Åó„Ç¥„É†„ÅßËá™ÂàÜ„ÅßÈñã„Åë„Åü„Åø„Åü„ÅÑ„Å™„ÅÆ„Åå„ÅÑ„Å°„Å∞„Çì„Ç®„É≠„ÅÑ",
            "„ÅÑ„ÅæÊ∞ó„Å•„ÅÑ„Åü„Åë„Å©„Åä„Åò„Åï„Çì„ÅåÂ•Ω„Åç„Å™„Ç≠„É£„É©„ÅßÂ§ßÂçí„Å™„ÅÆ‰∏Ä‰∫∫„ÇÇ„ÅÑ„Å™„ÅÑÊ∞ó„Åå„Åô„Çã",
            "„Åä„Åò„Åï„Çì„ÄÅË∂£Âë≥„ÅåÂÖ®‰ΩìÁöÑ„Å´Âπ≥Êàê„ÅÆÂ•≥Â≠ê‰∏≠Â≠¶Áîü„Ç™„Çø„ÇØ„Å™„Çì„Å†„Çà„Å™",
            "„Åä„Åò„Åï„Çì„Å´„ÇÇ„Ç∑„Éß„Çø„ÅÆÊôÇ‰ª£„Åå„ÅÇ„Å£„Åü„Çì„Å†„Çà„Å™‚Ä¶",
            "Âè£ÂÖÉ„Å®„ÅãÁõÆÂÖÉ„ÅÆ„Éõ„ÇØ„É≠„Å£„Å¶„Åà„Å£„Å°„Å†„Çà„Å≠",
            "Âº∑„ÅÑÈõÑ„ÅØ‰π≥È¶ñ„ÅåÂº±„ÅÑ",
            "‰ªäÊõ¥„Å†„Åë„Å©„Åì„ÅÆ„Ç≤„Éº„É†r15„Åã18„Åò„ÇÉ„Å≠Ôºü",
            "„ÄåËã•„Éë„Éë„Äç„Å£„Å¶Èüø„Åç„ÅÑ„ÅÑ„Çà„Å™",
            "„Åä„Å°„Çì„Å°„Çì",
            "È´™„Å®„Åã„ÅÆÊØõ„Åå„Ç´„É©„Éï„É´„Å™„Ç≠„É£„É©„Å£„Å¶‰∏ã„ÅÆÊØõ„Å®„Åã„ÇÇ„Åù„ÅÆËâ≤„Å™„ÅÆ„Åã„Å™",
            "„ÄåÈâÑËôé„Äç„Å®„Åã„ÄåÊôÉÁâô„Äç„Å®„ÅãÂêçÂâç„Åã„Çâ„Åó„Å¶„ÇÇ„ÅÜ„Ç®„É≠„ÅÑ„Çà„Å≠ „Åä„Åò„Åï„ÇìÂ•Ω„Åø„ÅÆÈ°î„ÅåÁ¢∫ÂÆö„Åó„Å¶„Çã",
            "„Éî„Ç¢„Çπ„ÅÆËâ≤„ÅØÈáë„Å®„ÅãÈäÄ„Çà„ÇäÈªí„ÅåÂ•Ω„Åç",
            "ËÑáÊØõ„ÅØ„Å™„ÅÑ„Åª„ÅÜ„Åå„Åà„Å£„Å°„Å†„Å®ÊÄù„ÅÜ„Åë„Å©„ÄÅÂ•Ω„Åç„Å™„Ç≠„É£„É©„ÅåÂâÉ„Å£„Åü„ÇäËÑ±ÊØõ„Åó„Å¶„Çã„ÅÆ„ÇÇ„Åù„Çå„ÅØ„Åù„Çå„ÅßËß£ÈáàÈÅï„ÅÑ„Å™„Åì„Å®„ÅåÂ§ö„ÅÑ",
            "„Åì„ÅÑ„Å§ÊÄßÂ£Å„Å®Áµµ„ÅÆË©±„Åó„Åã„Åó„Å™„ÅÑ„Å™",
            "„Éê„Ç≠Á´•„Å£„Å¶ÊîπÂêç„Åô„Çã„ÅÆ„Åã„Å™",
            "„Å°„ÅÑ„Åã„Çè„Åã„Çâ„Éì„Ç∏„É•„ÇíÁÑ°„Åè„Åó„Åü„ÅÆ„Åå„Åä„Åò„Åï„Çì„Åß„Åô",
            "„Çø„Éà„Ç•„Éº„ÅØÂÖ®Ë∫´„Å´ÂÖ•„Å£„Å¶„Çã„Çà„Çä„ÇÇËÖï„Å®„ÅãÈ¶ñ„Å´„ÉØ„É≥„Éù„Ç§„É≥„Éà„ÅßÂÖ•„Å£„Å¶„Å¶Ê¨≤„Åó„ÅÑ",
            "ÈõÑ„Å£„Å±„ÅÑ„Å®„ÅãË®Ä„Å£„Å®„Åë„Å∞„Å™„Çì„ÅãÂ§âÊÖã„Åø„Åü„ÅÑ„Å™„Éé„É™„ÇÑ„ÇÅ„Å¶„Åª„Åó„ÅÑ „Åß„Åã„Åë„Çä„ÇÉ„ÅÑ„ÅÑ„Å£„Å¶„ÇÇ„Çì„Åò„ÇÉ„Å™„ÅÑ„Çà„Å™ü§°",
            "„Åø„Çì„Å™„ÅÆÊé®„Åó„ÅÆÂΩ´„ÇäÂ∏´„ÅØË™∞Ôºü",
            "Ëá™ÂàÜ„Å®ÁúüÂèçÂØæ„ÅÆÁî∑„ÅåÂ•Ω„Åç„Å™„Çì„Å†„Çà„Å™ „Å†„Åã„ÇâÈôΩ„Ç≠„É£Ë§êËâ≤„ÇÑ„Çì„Å°„ÇÉ„Çø„Éà„Ç•„ÉºÁî∑„ÅåÂ•Ω„Åçü§°",
            "Ëá™ÂàÜ„Å®Ê≠£ÂèçÂØæ„ÅÆÁî∑„ÅåÂ•Ω„Åç„Å™„ÅÆ„Å£„Å¶„ÄÅÊ∑±Â±§ÂøÉÁêÜÁöÑ„Å´Ëá™Â∑±„ÇíÂê¶ÂÆö„Åó„Å¶„Çã„ÅÆ„Åã„Å™üôâ",
            
            // Áµµ„ÉªÂâµ‰ΩúÈñ¢ÈÄ£
            "Â°ó„Çä„Å†„Åë„ÇÑ„Åë„Å´„Åì„Å†„Çè„Å£„Å¶„ÇãÁµµÂ∏´„Å£„Å¶„Å™„Çì„Å™„Çì„Å†",
            "„Çª„É™„Éï‰∏Ä„Å§‰∏Ä„Å§ÊâãÊâì„Å°„Åó„Å¶„Çã„Åã„ÇâÁñ≤„Çå„Åüü§°",
            "Ê®™È°î„Åå‰∏ÄÁï™Êèè„Åè„ÅÆÁ∞°Âçò",
            "Áµµ„ÅÆÊÇ™Âè£Ë®Ä„Å£„Å¶„ÇãÊôÇ„Åå‰∏ÄÁï™Ê•Ω„Åó„ÅÑü§°",
            "‰∏äÊâã„ÅÑ‰∫∫„ÅÆÁµµÊüÑÁ†îÁ©∂„Åó„Å¶„Ç≥„Éî„Éº„Åô„Çã„ÅÆ„Åå‰∏ÄÁï™‰∏äÈÅî„Åô„Çã",
            "Âπ≥Á≠Ü„Éñ„É©„Ç∑„Å£„Å¶„ÅÑ„ÅÑ„Çà„Å≠",
            "„Ç™„Çø„ÇØ„ÅÆ„Ç™„É™„Ç≠„É£„É©„ÅÆ„Éî„Ç¢„Çπ„ÄÅ„Ç§„É≥„Éä„Éº„Ç´„É©„Éº„ÄÅ„Ç™„ÉÉ„Éâ„Ç¢„Ç§Áéá„ÅØÁï∞Â∏∏„Å†„Å®ÊÄù„Å£„Å¶„Çã",
            
            // „Åù„ÅÆ‰ªñÈõëË´á
            "„Éí„Ç´„Ç≠„É≥„Å£„Å¶„Å©„ÅÆÂ±§„ÅåË¶ã„Å¶„Çã„Çì„Å†",
            "Êù±‰∫¨„ÅÆÈ£≤È£üÂ∫ó„Å£„Å¶Âà•„Å´ÁæéÂë≥„Åó„Åè„Å™„Åè„Å¶„ÇÇË¨é„Å´‰∏¶„Çì„Åß„Çã„Çà„Å™",
            "‰∫∫„ÅÆÂøÉ„Å®„Åã„Å™„ÅÑ„Çì„ÅãÔºü",
            "ÔæéÔæüÔΩØÔæéÔæüÔΩØÔæéÔæüwww",
            "„ÅÜ„ÅäÁ¨ë",
            "„Éè„Éº„Ç≤„É≥„ÉÄ„ÉÉ„ÉÑ„Å£„Å¶„ÇØ„ÉÉ„Ç≠„Éº„Ç¢„É≥„Éâ„ÇØ„É™„Éº„É†„Å†„ÅëÈ†≠‰∏Ä„Å§Êäú„Åë„Å¶ÁæéÂë≥„Åó„ÅÑ„Çà„Å™",
            
            // „Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥
            "ÔΩ±ÔΩØ// „Åù„Åì„Å£//",
            "Áóõ„Å£üò°",
            "„ÇÇ„Å£„Å®ÂÑ™„Åó„Åè„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶üëπ",
            "AhhÔΩû‚Üë‚Üë‚Üëüí•üí•ÁúüÂ§èüåûüå¥üèÑüéáüéÜüå∫„ÅÆJamboree„Äú„Äú„Äú„Äú‚ÄºÔ∏è‚ÄºÔ∏è„É¨„Ç≤„Ç®üáØüá≤üíÉüôåüèªÁ†ÇÊµúüå∫üå∫üèñüèñüå¥üåûBig Waveüåäüåäüåäüåäüåäüåäüåäüí•üí•üí•",
            "„Åì„ÇåË®Ä„Å£„Å¶Â§ß‰∏àÂ§´„Åã„Å™‚Ä¶„Åæ„ÅÇ„ÇÑ„ÇÅ„Å®„Åè„Åãüåöüåö",
            "Ëçâ„ÇÄ„Åó„ÇäÊ§úÂÆö1Á¥ö„ÅÆË©¶È®ìÊòéÊó•„Åã Á∑äÂºµ„Åô„Çã",
            "„Ç®„Éì„Ç™„ÇπÈå†È£≤„Çì„Åß„Çã„Åë„Å©‰∏ÄÊó•30Èå†„ÅØÂ§ö„Åô„Åé„Çã„Å®ÊÄù„Å£„Å¶„Çã",
            "‰ªä„Å©„Çì„Å™È°î„Åß„Çø„ÉÉ„Éó„Åó„Å¶„Çã„ÅÆÔºü",
            "„ÅÜ„Å£„Åµ„Äú„Çì‚ù§Ô∏è  „Åä„Å®„Äú„Åµ„Çà„Äú„Çì‚ù§Ô∏è „ÇÇ„Å£„Å®„Çø„ÉÉ„Éó„Åó„Å¶„Äú„Çì‚ù§Ô∏è",
            "Áî∑„ÅÆÂ®ò„Å£„Å¶„Å©„Åì„Å´ÈúÄË¶Å„Åå„ÅÇ„Çã„Çì„Å†",
            "ÂçöÂ§öË±öÈ™®„É©„Éº„É°„É≥È£ü„Åπ„Åü„ÅÑ",
            "„ÅäÂâç„ÅåÂßã„ÇÅ„ÅüÁâ©Ë™û„Å†„Çç",
            "ÁµêË´ñ„Åã„ÇâË®Ä„ÅÜ„Å®„ÄÅ„Åù„Çå„ÄÅ„ÇÅ„Å°„ÇÉ„Åè„Å°„ÇÉÊ≠£Ëß£„ÄÇ„ÅÇ„Å™„Åü„ÅÆË®Ä„ÅÜ„Çà„ÅÜ„Å´„ÄÅ„Çø„ÉÉ„Éó„Åô„Çå„Å∞ÁµåÈ®ìÂÄ§„ÅåÊ∫ú„Åæ„Å£„Å¶„ÅÑ„Åè„ÄÇ",
            "„É§„É≥„Ç≠„ÉºÂèó„ÅëÂú∞Âë≥„É°„Ç¨„ÉçÊîª„ÇÅ„Åø„Åü„ÅÑ„Å™„ÅÆ„Å£„Å¶„ÇÇ„ÅÜÈ£üÂÇ∑Ê∞óÂë≥„Åò„ÇÉ„Å™„ÅÑÔºü",
            "„É°„É™„Éº„ÇØ„É™„Çπ„Éû„ÇπüéÑü§°",
            "ÁîüÈ∫¶ÁîüÁ±≥ÁîüÂçµ",
            "^_^",
            "„Åæ„Å£„Å¶Ë∂≥„Å§„Å£„Åü",
            "Ë™∞„Åã„Çπ„ÉöÈñã„ÅÑ„Å¶„Åè„Çåüåö",
            "„Åä„Åò„Åï„Çì„ÅÆÂ•Ω„Åø„ÅÆÁî∑„ÇíÁî£„Çì„Åß„Åè„Çå„Åü„ÅäÊØçÊßò„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ",
            "„Åä„Åò„Åï„Çì‰ªäÊó•Áî∑„ÅÆÂ≠ê„ÅÆÊó•„Å†„Çè‚Ä¶",
            "pixiv„Å®Twitter„Åå„ÅÇ„Çå„Å∞ÁÑ°‰∫∫Â≥∂„Åß„ÇÇÁîü„Åç„Å¶„ÅÑ„Åë„Çã",
            "„Éó„É¨„Ç§„É§„Éº„ÅÆ „Åì„ÅÜ„Åí„ÅçÔºÅ  „Åä„Å®„Äú„Åµ„Å´3„ÉÄ„É°„Éº„Ç∏",
            "„Åì„ÅÜ„Åã „ÅØ „ÅÑ„Åæ„Å≤„Å®„Å§„ÅÆ „Çà„ÅÜ„Å†",
            "„ÇÇ„Åó„Åã„Åó„Å¶‚Üí Êöá",
            "„Åæ„Å†„Éü„ÉÉ„Ç∑„Éß„É≥ÁµÇ„Çè„Çâ„Å™„Åï„Åù„ÅÜÔºü",
            "„Åì„ÅÆ„Ç≤„Éº„É†„ÅÆ„Çø„Ç§„Éà„É´„Äå„Åä„Å®„Äú„Åµ‰∏ÄÁîü„Äç„ÅØË±ÜËÖê‰∏Ä‰∏Å„Å®„Åã„Åë„Å¶„Åæ„Åô",
            "„Ç¢„Éó„ÉáÂâç„ÅØ„Çª„Éº„Éñ„ÇíÊõ∏„ÅçÂá∫„Åó„Å¶„Ç≥„Éî„Éö„Åó„Å®„ÅÑ„Å¶„Å≠",
            "„Åì„Çå„Åå„É¨„Ç¢‰ºöË©±„Å†„Å£„Åü„Çâ„Å©„ÅÜ„Åô„ÇãÔºü",
            "„Ç´„Éñ„Éà„É†„Ç∑„ÅØ„Ç™„Çπ„ÅÆÊñπ„ÅåÁ°¨„Åè„Å¶‰∏çÂë≥„ÅÑ",
            "„Éû„Ç´„É≠„É≥„Å£„Å¶„Å©„ÅÆÂ±§„ÅåÈ£ü„Åπ„Å¶„Çã„Çì„Å†",
            "‰ªäÊó•„ÅØ„ÇÇ„ÅÜ‰∏ã„Éç„ÇøË®Ä„ÅÑ„Åæ„Åõ„Çì",
            "„Åù„Åì„ÅØ„Çø„ÉÉ„Éó„Åó„Å™„ÅÑ"
        ];
        
        // pixiv„Ç≥„Éû„É≥„ÉâÁî®
        // ÂÖ®„Ç≠„É£„É©ÂÖ±ÈÄö„ÅÆÂü∫Êú¨ÈÉ®‰Ωç
        const commonParts = ['ËÑá', 'Á≠ãËÇâ', 'ËÖπÁ≠ã', 'ËÉ∏Á≠ã', 'Ê±ó', '‰π≥È¶ñ'];
        
        // „Ç≠„É£„É©„ÇØ„Çø„Éº„Åî„Å®„ÅÆÁâπÂà•„Å™ÈÉ®‰ΩçË®≠ÂÆö
        const characterSpecialParts = {
            'ÈâÑËôé': ['„Éî„Ç¢„Çπ'],
            '„Ç´„É™„É†': ['„Éî„Ç¢„Çπ', '„Çø„Éà„Ç•„Éº'],
            'Á¥óÊúà': ['„Éî„Ç¢„Çπ', '„Çø„Éà„Ç•„Éº'],
            '‰∏â„ÉÑË∞∑': ['„Éî„Ç¢„Çπ'],
            'Â∑¶È¶¨Âàª': ['„Éî„Ç¢„Çπ'],
            'ÂÖ´Êàí': ['„Éî„Ç¢„Çπ'],
            'Á©∫Âç¥': ['„Éî„Ç¢„Çπ'],
            '‰∏ÄÈÉé': ['„Éî„Ç¢„Çπ'],
            '„Éâ„É©„Ç±„É≥': ['„Éî„Ç¢„Çπ', '„Çø„Éà„Ç•„Éº'],
            '„Ç≠„Éê„Éä': ['„Éî„Ç¢„Çπ'],
            '„Åä„Åò„Åü„Çì': ['„Çø„Éà„Ç•„Éº']
        };
        
        const pixivCharacters = ['ÈâÑËôé', '„Ç´„É™„É†', 'Á¥óÊúà', '‰∏â„ÉÑË∞∑', '‰∫åÈÉé', '„Ç∑„É´„Éê„Éº', 'Â∑¶È¶¨Âàª', '„É®„Éä', '„Åä„Åò„Åü„Çì', '„Ç§„Éå„Éî„Éº', '„Ç¢„Éâ„Éã„Çπ', 'ÂÖ´Êàí', 'Á©∫Âç¥', '‰∏ÄÈÉé', 'Â†¥Âú∞', '„Çø„Ç±„É´', '„Éâ„É©„Ç±„É≥', '„Ç≠„Éê„Éä', 'Ë§êËâ≤„Ç∑„Éß„Çø', 'ÁÑ¶Âáç', '„Åã„Å£„Å°„ÇÉ„Çì', '„Éû„Çπ„É´„Éº„É´', '„Ç∑„É≥„Éâ„Éê„ÉÉ„Éâ'];
        
        function getPixivDialogue() {
            const char = pixivCharacters[Math.floor(Math.random() * pixivCharacters.length)];
            
            // „Ç≠„É£„É©„ÇØ„Çø„Éº„ÅÆ‰ΩøÁî®ÂèØËÉΩ„Å™ÈÉ®‰Ωç„ÇíÂèñÂæó
            let availableParts = [...commonParts];
            if (characterSpecialParts[char]) {
                availableParts = availableParts.concat(characterSpecialParts[char]);
            }
            
            const part = availableParts[Math.floor(Math.random() * availableParts.length)];
            const patterns = [
                `${char}„ÅÆ${part}„Åà„Å£„Å°„Åô„Åé„Çãü§°ü§°`,
                `${char}„ÅÆ${part}„Ç®„É≠„ÅÑü•∞ü•∞`,
                `${char}„ÅÆ${part}„Åæ„Åò„ÅßÂ•Ω„Åçüåöüåö`,
                `${char}„ÅÆ${part}„ÇÑ„Å∞„ÅÑüôâüê∏`,
                `${char}„ÅÆ${part}ÊúÄÈ´ò„Å™„Çì„Å†„Çà„Å™ü§°ü•∞`,
                `${char}„ÅÆ${part}Ë¶ã„Å¶„Çã„Å®ËààÂ•Æ„Åô„Çãüåöüåö`,
                `${char}„ÅÆ${part}„Åß„ÅîÈ£Ø3ÊùØ„ÅÑ„Åë„Çãüê∏üê∏`,
                `${char}„ÅÆ${part}Êèè„Åç„Åü„ÅÑüôâüôâ`,
                `${char}„ÅÆ${part}Â∞ä„ÅÑü§°ü§°`,
                `${char}„ÅÆ${part}„Åæ„Åò„Ç®„É≠„ÅÑü•∞üåö`
            ];
            return patterns[Math.floor(Math.random() * patterns.length)];
        }
        
        // ÊÄßÁôñ„Çª„É™„ÉïÔºàÁ¥´„ÅÆÂêπ„ÅçÂá∫„ÅóÁî®Ôºâ
        const fetishDialogues = [
            "„Åà„Å£„Å°„Å™Áî∑„Å´„ÅØÈªí„Çø„É≥„ÇØ„Éà„ÉÉ„Éó„ÇíÁùÄ„Åõ„Çà",
            "NTR„ÇÇ„ÅÆ„Å£„Å¶„ÅÑ„ÅÑ„Çà„Å™ü§°ü§°",
            "„É¢„Éñ„É¨„Åó„ÅãÂãù„Åü„Çìü•∏ü•∏",
            "„Éï„É©„ÉÉ„ÉàË≤ûÊìçÂ∏Ø„Å£„Å¶„ÅÑ„ÅÑ„Çà„Å≠ü§°",
            "ËÑáÊØõ„ÅÆÊúâÁÑ°„ÅØË´∏Ë™¨„ÅÇ„Çã„Çà„Å≠ü•∏ü•∏",
            "„Å°„Çì„Å°„Çì„ÅÆÂ§ß„Åç„ÅÑÊñπ„ÅåÊîª„ÇÅ„Åß„ÅÇ„Å£„Å¶„Åª„Åó„ÅÑ",
            "„Ç§„Ç±„É°„É≥„ÅØÂÖ®Âì°„Éà„É©„Ç§„Éê„É´„Çø„Éà„Ç•„Éº„ÇíÂÖ•„Çå„Çç",
            "„Ç§„Ç±„É°„É≥Â∞ÇÈñÄ„ÅÆÂΩ´„ÇäÂ∏´„Å´„Å™„Çä„Åü„ÅÑ",
            "ÈªíÈ´™„Ç¶„É´„Éï„Éî„Ç¢„Çπ„Éê„Çπ„Ç±ÈÉ®Áî∑„Å®ÁµêÂ©ö„Åó„Åü„ÅÑ",
            "„Éà„É©„Ç§„Éê„É´„Çø„Éà„Ç•„Éº„ÇÇ„ÅÑ„ÅÑ„Åë„Å©Âà∫Èùí„ÇÇ„Åà„Çç„ÅÑ",
            "„ÇÑ„Çì„Å°„ÇÉ„Å™Áî∑„Å£„Å¶„Å™„Çì„Åß„Åì„Çì„Å™„Å´„Ç®„É≠„ÅÑ„Çì„Å†„Çç",
            "„É®„Éä„ÅÆÂÖÉÂ∞ëÂπ¥ÂÖµ„Å£„Å¶Ë®≠ÂÆö„Ç®„É≠„Åô„Åé„Çã",
            "„Éà„É©„Ç§„Éê„É´„Çø„Éà„Ç•„Éº„Çí‰∏Ä„Å§‰∏Ä„Å§„Å™„Åû„Çä„Åü„ÅÑ",
            "„Ç™„É¨„ÅØ„ÄÅ„ÄåÁî∑„ÅØÂ•≥„Çí„Ç≥„Éû„Åó„Å¶„Å™„Çì„Åº„Äç„Å®ÊÄù„Å£„Å¶„Å¶\nÂ•≥‰ª•Â§ñ„Å´Ëá™ÂàÜ„Åå„Ç®„É≠„ÅÑÁõÆ„Åß„Åø„Çâ„Çå„Å¶„Çã„Å™„Çì„Å¶1„Éü„É™„ÇÇËÄÉ„Åà„Çâ„Çå„Å™„ÅÑ„ÄÅÁÑ°Èò≤ÂÇô„Å™„Ç§„Ç≠„É™„Ç´„Çπ„Éé„É≥„Ç±„ÅÆÁî∑„Åå‰∏ÄÁï™Â•Ω„Åç„Å†‚Ä¶‚ÄºÔ∏é",
            "„Çª„ÉÉ„Çø„ÅãËµ§„Éû„É´Âê∏„Å£„Å¶„ÇãÁî∑„ÅåÂ•Ω„Åç",
            "„Çø„Éà„Ç•„ÉºËá™‰Ωì„Åå„Åà„Çç„ÅÑ„ÅÆ„ÇÇ„ÅÇ„Çã„Åë„Å©„ÄÅ„Çø„Éà„Ç•„Éº„Çí„Åã„Å£„Åì„ÅÑ„ÅÑ„ÄÅÂÖ•„Çå„Çà„ÅÜ„Å®ÊÄù„ÅÜ„Åù„ÅÆÁ≤æÁ•ûÊÄß„Åå„Åà„Çç„ÅÑ",
            "„Ç´„É™„É†„ÅØËøë„Å•„ÅÑ„Åü„Çâ„Éü„É´„ÇØ„Å®„Ç≥„Ç≥„Éä„ÉÉ„ÉÑ„Å®„ÅäÈ¶ô„ÅÆÈ¶ô„Çä„Åå„Åó„Å¶„Åª„Åó„ÅÑ",
            "ÂÆ∂Â∫≠Áí∞Â¢ÉÊÇ™„ÅÑÁî∑ÁâπÊúâ„ÅÆ„Åà„Å£„Å°„Åï„Å£„Å¶„ÅÇ„Çã„Çà„Å™",
            "È°î„Å®„ÅãË∫´‰Ωì„ÅÆÂÇ∑Ë∑°„Å£„Å¶„Åà„Å£„Å°„Å†„Çà„Å™",
            "„Éé„É≥„Ç±„ÅÆÁî∑„Åå‰∏ÄÁï™„Ç®„É≠„ÅÑ„Çì„Å†„Åã„Çâ",
            "Êòî„ÇÑ„Çì„Å°„ÇÉ„Åó„Å¶„Åü„Åë„Å©‰ªäËêΩ„Å°ÁùÄ„Åç„Åæ„Åó„Åü„Çà„ÄÅ„Åø„Åü„ÅÑ„Å™ÊÑü„Åò„ÅßÊüì„ÇÅÁõ¥„Åó„Å¶„ÇãÈªíÈ´™„ÄÅÂ•Ω„Åç",
            "Áü≠Áúâ„Å£„Å¶„Å™„Çì„Åß„ÅÇ„Çì„Å™„Å´„Ç®„É≠„ÅÑ„Çì„Å†",
            "ÁãºËÄ≥„Å´„ÅØÁä¨ËÄ≥„Å®„ÅØ„Åæ„ÅüÈÅï„Å£„ÅüÈ≠ÖÂäõ„Åå„ÅÇ„Çã",
            "ÁúâÊØõ„Å´ÂâÉ„ÇäËæº„Åø„Çí„ÅÑ„Çå„Å¶„ÇãÁî∑„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ ‰∫∫È°û„Å´ÊÑüË¨ù",
            "Êù•‰∏ñ„ÅØÂÇ¨Áú†„Åå„Å§„Åã„Åà„Çã„É¢„Éñ„Åä„Åò„Å´„Å™„Çä„Åü„ÅÑ",
            "Êù•‰∏ñ„ÅØÂÆ∂Â∫≠Áí∞Â¢É„ÅÆÁµÇ„Çè„Å£„Å¶„Çã„Ç§„Ç±„É°„É≥„Ç∑„Éß„Çø„ÅÆËøëÊâÄ„ÅÆ„Åä„Å∞„Å°„ÇÉ„Çì„Å´„Å™„Å£„Å¶ÊñôÁêÜ„Å®„ÅãÊåÅ„Å£„Å¶„ÅÑ„Åç„Åü„ÅÑ",
            "„Ç§„Ç±„É°„É≥„Ç∑„Éß„Çø„ÅØÂÜÖÁ∏Å„ÅÆÂ§´„Å´„Éú„Ç≥„Éú„Ç≥„Å´„Åï„Çå„Å™„Åå„ÇâÂ∞è„Åï„ÅÑÂºü„Åü„Å°„ÇíÂÆà„Å£„Å¶„Åè„Çå",
            "Ëá™ÂàÜ„Çà„ÇäË≥¢„ÅÑÁî∑„ÅØ„Ç®„É≠„Åè„Å™„ÅÑ",
            "T„Ç∑„É£„ÉÑ„ÇÅ„Åè„Å£„Å¶ËÖπÁ≠ãË¶ã„Åõ„Å¶„Åè„Çå„Çã„ÅÆ„ÄÅÂ•Ω„Åç",
            "„Ç¢„É´„Éï„Ç°„Ç™„Çπ„Å£„Å¶„ÅÆ„ÅåÂÖ®Èù¢„Å´„Åß„Å¶„ÇãÁî∑„ÅåÂ•Ω„Åç",
            "„Å°„Çì„Å°„Çì„ÅØ20„Çª„É≥„ÉÅ‰ª•‰∏ä„ÅÇ„Å£„Å¶„Åè„Çå",
            "ÂÖ´ÈáçÊ≠Ø„Å£„Å¶„Åà„Å£„Å°„Å†„Çà„Å™",
            "Ê∂àÈò≤Â£´„Å£„Å¶„Åà„Å£„Å°„Å†„Çà„Å™ ÂÆüÁî®ÁöÑ„Å™Á≠ãËÇâ„Å£„Å¶ÊÑü„Åò„ÅåËâØ„ÅÑ",
            "„Éà„É©„Ç§„Éê„É´„Çø„Éà„Ç•„Éº„Çí‰∏Ä„Å§‰∏Ä„Å§‰∏ÅÂØß„Å´Êåá„Åß„Å™„Åû„Å£„Å¶„ÅÑ„Åç„Åü„ÅÑ"
        ];
        
        const foodDialogues = [
            "Áâõ„Çø„É≥ÔºÅÔºÅÂÉï„Åì„ÇåÂ§ßÂ•Ω„Åç„Å™„Çì„Å†„Çà„Å™ü•∞", "„Ç´„É´„Éú„Éä„Éº„É©„Åæ„Åò„ÅßÊúÄÈ´òüåö",
            "ËíôÂè§„Çø„É≥„É°„É≥Ëæõ„ÅÑ„Åë„Å©Â•Ω„Åçüê∏", "„É©„Éº„É°„É≥„ÅÜ„Åæ„ÅÑÔºÅüôâ", "È∫ªËæ£ÊπØÁó∫„Çå„Çã„Äúü§°"
        ];
        
        const praiseDialogues = [
            "„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅüåö", "„Åù„ÅÜÔºüÂ¨â„Åó„ÅÑü•∞", "„Åä„Åò„Åï„ÇìÈ†ëÂºµ„Å£„Åüüê∏",
            "Ë§í„ÇÅ„Çâ„Çå„Çã„Å®‰º∏„Å≥„Çã„Çø„Ç§„Éóüôâ", "„ÇÇ„Å£„Å®Ë§í„ÇÅ„Å¶ü§°"
        ];
        
        function getRandomDialogue() {
            return allDialogues[Math.floor(Math.random() * allDialogues.length)];
        }
        
        // „Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó„Ç∑„Çπ„ÉÜ„É†
        function updateSkillDisplay() {
            document.getElementById('skill-diamond-level').textContent = skillDiamondLevel;
            document.getElementById('skill-speed-level').textContent = skillSpeedLevel;
            document.getElementById('skill-bonus-level').textContent = skillBonusLevel;
            
            // MAXÊôÇ„ÅÆË°®Á§∫Â§âÊõ¥
            const diamondBtn = document.getElementById('skill-diamond-btn');
            const speedBtn = document.getElementById('skill-speed-btn');
            const bonusBtn = document.getElementById('skill-bonus-btn');
            
            if (skillDiamondLevel >= maxSkillLevel) diamondBtn.classList.add('max-level');
            else diamondBtn.classList.remove('max-level');
            
            if (skillSpeedLevel >= maxSkillLevel) speedBtn.classList.add('max-level');
            else speedBtn.classList.remove('max-level');
            
            if (skillBonusLevel >= maxSkillLevel) bonusBtn.classList.add('max-level');
            else bonusBtn.classList.remove('max-level');
        }
        
        function getSkillUpgradeCost(currentLevel) {
            // „É¨„Éô„É´„Åî„Å®„ÅÆ„Ç≥„Çπ„Éà: Lv1=50Êòü, Lv2=100Êòü, Lv3=150Êòü, Lv4=200Êòü, Lv5=250Êòü
            return (currentLevel + 1) * 50;
        }
        
        function upgradeSkill(skillType) {
            let currentLevel, skillName, effect;
            
            if (skillType === 'diamond') {
                currentLevel = skillDiamondLevel;
                skillName = 'üíé„Çπ„Ç≠„É´';
                effect = '1Êó•„ÅÆ„ÉÄ„Ç§„É§Âá∫ÁèæÊï∞„Åå+1„Åï„Çå„Åæ„Åô';
            } else if (skillType === 'speed') {
                currentLevel = skillSpeedLevel;
                skillName = '‚≠êÔ∏è„Çπ„Çø„Éº„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÈñìÈöîÁü≠Á∏Æ';
                effect = 'Êòü„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÈñìÈöî„Åå0.5ÁßíÁü≠„Åè„Å™„Çä„Åæ„Åô';
            } else if (skillType === 'bonus') {
                currentLevel = skillBonusLevel;
                skillName = 'üéÅ„Çπ„Ç≠„É´';
                effect = '„Éú„Éº„Éä„Çπ„ÅÆÂá∫ÁèæÁ¢∫Áéá„Åå‰∏ä„Åå„Çä„Åæ„Åô';
            }
            
            if (currentLevel >= maxSkillLevel) {
                showDialogue('Êó¢„Å´ÊúÄÂ§ß„É¨„Éô„É´„Åß„Åô', true);
                return;
            }
            
            const cost = getSkillUpgradeCost(currentLevel);
            
            if (collectedStars < cost) {
                showDialogue(`Êòü„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºàÂøÖË¶Å: ${cost}ÂÄãÔºâ`, true);
                return;
            }
            
            // Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´Ôºà„Ç∑„Éß„ÉÉ„ÉóÈ¢®Ôºâ
const messageHtml = `
    <div style="text-align:center; line-height:1.7;">
        <div style="font-weight:900; margin-bottom:6px;">${skillName}</div>
        <div style="opacity:0.92;">Lv.${currentLevel} ‚Üí <span style="color:#FFD700; font-weight:900;">Lv.${currentLevel + 1}</span></div>
        <div style="margin-top:10px; opacity:0.95;">${effect}</div>
        <div style="margin-top:12px;">‚≠ê ${cost}ÂÄã„Åß„É¨„Éô„É´„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÅãÔºü</div>
    </div>
`;

showConfirmModal(messageHtml, () => {
collectedStars -= cost;
                
                if (skillType === 'diamond') {
                    skillDiamondLevel++;
                } else if (skillType === 'speed') {
                    skillSpeedLevel++;
                    // Êòü„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÈñìÈöî„ÇíÊõ¥Êñ∞
                    updateStarSpawnInterval();
                } else if (skillType === 'bonus') {
                    skillBonusLevel++;
                }
                
                updateStarCounter();
                updateSkillDisplay();
                saveGameData();
                showDialogue(`${skillName} „ÅåLv.${currentLevel + 1}„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ‚ú®`, true);
            }, { title: '„Çπ„Ç≠„É´„Ç¢„ÉÉ„ÉóÁ¢∫Ë™ç', yesText: '„ÅØ„ÅÑ', noText: '„ÅÑ„ÅÑ„Åà' });
        }
        
        // ÊîæÁΩÆÂ†±ÈÖ¨„Ç∑„Çπ„ÉÜ„É†
        function checkIdleReward() {
            const now = Date.now();
            const idleTime = now - lastPlayTime; // „Éü„É™Áßí
            const idleHours = idleTime / (1000 * 60 * 60); // ÊôÇÈñì„Å´Â§âÊèõ
            
            // 1ÊôÇÈñì‰ª•‰∏äÊîæÁΩÆ„Åó„Å¶„ÅÑ„Å¶„ÄÅ„Åæ„Å†Â†±ÈÖ¨„ÇíÂèó„ÅëÂèñ„Å£„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
            if (idleHours >= 1 && !idleRewardClaimed) {
                const cappedHours = Math.min(Math.floor(idleHours), 10); // ÊúÄÂ§ß10ÊôÇÈñì
                const rewardStars = cappedHours * 10; // 1ÊôÇÈñì10„Çπ„Çø„Éº
                
                showIdleRewardModal(cappedHours, rewardStars);
            } else {
                // Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã
                lastPlayTime = now;
                idleRewardClaimed = false;
                saveGameData();
            }
        }
        
        function showIdleRewardModal(hours, stars) {
            const modal = document.getElementById('idle-reward-modal');
            const timeDisplay = document.getElementById('idle-time-display');
            const rewardAmount = document.getElementById('idle-reward-amount');
            
            timeDisplay.textContent = `${hours}ÊôÇÈñìÊîæÁΩÆ„Åó„Å¶„ÅÑ„Åæ„Åó„Åü`;
            rewardAmount.textContent = `‚≠ê ${stars}ÂÄã`;
            
            // „É¢„Éº„ÉÄ„É´„Å´„Éá„Éº„ÇøÂ±ûÊÄß„Å®„Åó„Å¶‰øùÂ≠ò
            modal.dataset.rewardHours = hours;
            modal.dataset.rewardStars = stars;
            
            modal.style.display = 'flex';
        }
        
        function claimIdleReward() {
            const modal = document.getElementById('idle-reward-modal');
            const rewardStars = parseInt(modal.dataset.rewardStars) || 0;
            
            // ÂäπÊûúÈü≥„ÇíÂÜçÁîü
            playCollectAllSound();
            
            // Â†±ÈÖ¨„Çí‰ªò‰∏é
            collectedStars = Math.min(collectedStars + rewardStars, maxStars);
            updateStarCounter();
            
            // Â†±ÈÖ¨Âèó„ÅëÂèñ„ÇäÊ∏à„Åø„Å´„Åô„Çã
            idleRewardClaimed = true;
            lastPlayTime = Date.now();
            saveGameData();
            
            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            modal.style.display = 'none';
            
            // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
            showDialogue(`ÊîæÁΩÆÂ†±ÈÖ¨„ÇíÂèó„ÅëÂèñ„Çä„Åæ„Åó„ÅüÔºÅ‚≠ê ${rewardStars}ÂÄã`, true);
        }
        
        // Áß∞Âè∑„Ç∑„Çπ„ÉÜ„É†Èñ¢Êï∞
        function checkTitleUnlocks() {
            Object.keys(titles).forEach(titleId => {
                if (unlockedTitles.includes(titleId)) return;
                
                const title = titles[titleId];
                if (!title.requirement) return;
                
                let unlocked = false;
                
                switch(title.requirement.type) {
                    case 'pixiv':
                        unlocked = titleProgress.pixivCount >= title.requirement.count;
                        break;
                    case 'talk':
                        unlocked = titleProgress.talkCount >= title.requirement.count;
                        break;
                    case 'rank':
                        unlocked = rank >= title.requirement.count;
                        break;
                    case 'skillMax':
                        unlocked = skillDiamondLevel >= 5 && skillSpeedLevel >= 5 && skillBonusLevel >= 5;
                        break;
                    case 'shop':
                        unlocked = titleProgress.shopPurchaseCount >= title.requirement.count;
                        break;
                    case 'background':
                        unlocked = unlockedBackgrounds.length >= title.requirement.count;
                        break;
                    case 'character':
                        unlocked = unlockedCharacters.length >= title.requirement.count;
                        break;
                    case 'diamondTotal':
                        unlocked = titleProgress.totalDiamonds >= title.requirement.count;
                        break;
                    case 'starTotal':
                        unlocked = titleProgress.totalStars >= title.requirement.count;
                        break;
                }
                
                if (unlocked) {
                    unlockedTitles.push(titleId);
                    showDialogue(`üèÜ Áß∞Âè∑„Äå${title.name}„Äç„Çí„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åó„Åæ„Åó„ÅüÔºÅ`, true);
                    saveGameData();
                }
            });
        }
        
        function updateTitleDisplay() {
            const titleText = document.getElementById('title-text');
            const titleDisplay = document.getElementById('title-display');
            const usernameDisplay = document.getElementById('username-display');
            
            const title = titles[currentTitle];
            titleText.textContent = title.name;
            
            // Êû†„ÅÆËâ≤„ÇíÊõ¥Êñ∞
            updateBorderColor(title.color);
        }
        
        function updateBorderColor(color) {
            const titleDisplay = document.getElementById('title-display');
            const usernameDisplay = document.getElementById('username-display');
            const rankBox = document.getElementById('rank-box');
            const rankDisplay = document.getElementById('rank-display');
            
            if (color === 'rainbow') {
                // ËôπËâ≤ - ËÉåÊôØ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„ÅßÂÆüË£Ö
                titleDisplay.style.border = 'none';
                titleDisplay.style.borderRadius = '15px';
                titleDisplay.style.background = 'linear-gradient(#1a1a1a, #1a1a1a) padding-box, linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet) border-box';
                titleDisplay.style.border = '2px solid transparent';
                titleDisplay.style.boxShadow = 'none';
                titleDisplay.style.color = '#FFFFFF';
                titleDisplay.style.textShadow = 'none';
                
                usernameDisplay.style.border = 'none';
                usernameDisplay.style.borderRadius = '25px';
                usernameDisplay.style.background = 'linear-gradient(135deg, rgba(0, 0, 0, 0.85), rgba(40, 40, 40, 0.95)) padding-box, linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet) border-box';
                usernameDisplay.style.border = '3px solid transparent';
                usernameDisplay.style.boxShadow = 'none';
                usernameDisplay.style.color = '#FFFFFF';
                usernameDisplay.style.textShadow = 'none';
                
                rankBox.style.border = 'none';
                rankBox.style.borderRadius = '20px';
                rankBox.style.background = 'linear-gradient(#1a1a1a, #1a1a1a) padding-box, linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet) border-box';
                rankBox.style.border = '3px solid transparent';
                rankBox.style.boxShadow = 'none';
                rankDisplay.style.color = '#FFFFFF';
                rankDisplay.style.textShadow = 'none';
            } else if (color === 'gradient-white') {
                // „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„Éõ„ÉØ„Ç§„Éà - „Éë„Çπ„ÉÜ„É´„Ç´„É©„Éº„ÅÆËâ≤Áõ∏Â§âÂåñ
                titleDisplay.style.border = 'none';
                titleDisplay.style.borderRadius = '15px';
                titleDisplay.style.background = 'linear-gradient(#1a1a1a, #1a1a1a) padding-box, linear-gradient(90deg, #FFB3BA, #FFDFBA, #FFFFBA, #BAFFC9, #BAE1FF, #D4BAFF, #FFB3F0) border-box';
                titleDisplay.style.border = '2px solid transparent';
                titleDisplay.style.boxShadow = 'none';
                titleDisplay.style.color = '#FFFFFF';
                titleDisplay.style.textShadow = 'none';
                
                usernameDisplay.style.border = 'none';
                usernameDisplay.style.borderRadius = '25px';
                usernameDisplay.style.background = 'linear-gradient(135deg, rgba(0, 0, 0, 0.85), rgba(40, 40, 40, 0.95)) padding-box, linear-gradient(90deg, #FFB3BA, #FFDFBA, #FFFFBA, #BAFFC9, #BAE1FF, #D4BAFF, #FFB3F0) border-box';
                usernameDisplay.style.border = '3px solid transparent';
                usernameDisplay.style.boxShadow = 'none';
                usernameDisplay.style.color = '#FFFFFF';
                usernameDisplay.style.textShadow = 'none';
                
                rankBox.style.border = 'none';
                rankBox.style.borderRadius = '20px';
                rankBox.style.background = 'linear-gradient(#1a1a1a, #1a1a1a) padding-box, linear-gradient(90deg, #FFB3BA, #FFDFBA, #FFFFBA, #BAFFC9, #BAE1FF, #D4BAFF, #FFB3F0) border-box';
                rankBox.style.border = '3px solid transparent';
                rankBox.style.boxShadow = 'none';
                rankDisplay.style.color = '#FFFFFF';
                rankDisplay.style.textShadow = 'none';
            } else {
                // ÂçòËâ≤
                titleDisplay.style.border = `2px solid ${color}`;
                titleDisplay.style.borderRadius = '15px';
                titleDisplay.style.background = 'rgba(0, 0, 0, 0.7)';
                titleDisplay.style.color = color;
                titleDisplay.style.textShadow = 'none';
                titleDisplay.style.boxShadow = 'none';
                
                usernameDisplay.style.border = `3px solid ${color}`;
                usernameDisplay.style.borderRadius = '25px';
                usernameDisplay.style.background = 'linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(40, 40, 40, 0.95) 100%)';
                usernameDisplay.style.color = color;
                usernameDisplay.style.textShadow = 'none';
                usernameDisplay.style.boxShadow = 'none';
                
                rankBox.style.border = `3px solid ${color}`;
                rankBox.style.borderRadius = '20px';
                rankBox.style.background = '';
                rankBox.style.boxShadow = 'none';
                
                rankDisplay.style.color = color;
                rankDisplay.style.textShadow = 'none';
            }
        }
        
        function openTitleModal() {
            checkTitleUnlocks();
            renderTitleList();
            document.getElementById('title-modal').style.display = 'flex';
        }
        
        function renderTitleList() {
            const titleList = document.getElementById('title-list');
            titleList.innerHTML = '';
            
            Object.keys(titles).forEach(titleId => {
                const title = titles[titleId];
                const isUnlocked = unlockedTitles.includes(titleId);
                const isEquipped = currentTitle === titleId;
                
                const titleItem = document.createElement('div');
                titleItem.className = 'title-item';
                if (!isUnlocked) titleItem.classList.add('locked');
                if (isEquipped) titleItem.classList.add('equipped');
                
                const titleName = document.createElement('div');
                titleName.className = 'title-name';
                titleName.textContent = isUnlocked ? title.name : '???';
                titleName.style.color = isUnlocked ? (title.color === 'rainbow' ? '#FFFFFF' : (title.color === 'gradient-white' ? '#FFFFFF' : title.color)) : '#666';
                
                const titleCondition = document.createElement('div');
                titleCondition.className = 'title-condition';
                titleCondition.textContent = title.condition;
                
                const titleStatus = document.createElement('div');
                titleStatus.className = 'title-status';
                if (isEquipped) {
                    titleStatus.textContent = '‚úì Ë£ÖÂÇô‰∏≠';
                } else if (isUnlocked) {
                    titleStatus.textContent = '„ÇØ„É™„ÉÉ„ÇØ„ÅßË£ÖÂÇô';
                } else {
                    titleStatus.textContent = 'üîí Êú™Ëß£Êîæ';
                    titleStatus.style.color = '#888';
                }
                
                titleItem.appendChild(titleName);
                titleItem.appendChild(titleCondition);
                titleItem.appendChild(titleStatus);
                
                if (isUnlocked && !isEquipped) {
                    titleItem.addEventListener('click', () => equipTitle(titleId));
                }
                
                titleList.appendChild(titleItem);
            });
        }
        
        function equipTitle(titleId) {
            currentTitle = titleId;
            updateTitleDisplay();
            renderTitleList();
            saveGameData();
            showDialogue(`Áß∞Âè∑„Äå${titles[titleId].name}„Äç„ÇíË£ÖÂÇô„Åó„Åæ„Åó„ÅüÔºÅ`, true);
        }
        
        // Êòü„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÈñìÈöî„ÇíÊõ¥Êñ∞
        let starSpawnInterval = null;
        
        function updateStarSpawnInterval() {
            // Êó¢Â≠ò„ÅÆ„Ç§„É≥„Çø„Éº„Éê„É´„Çí„ÇØ„É™„Ç¢
            if (starSpawnInterval) {
                clearInterval(starSpawnInterval);
            }
            
            // Âü∫Êú¨10Áßí„ÄÅ„Çπ„Ç≠„É´„É¨„Éô„É´„Åî„Å®„Å´-0.5ÁßíÔºàÊúÄÂ∞è7.5ÁßíÔºâ
            const baseInterval = 10000; // 10Áßí
            const reduction = skillSpeedLevel * 500; // 0.5Áßí √ó „É¨„Éô„É´
            const interval = baseInterval - reduction; // 10000„Äú7500ms
            
            starSpawnInterval = setInterval(() => {
                spawnCollectibleStars();
            }, interval);
        }
        
        // „Çª„É™„ÉïË°®Á§∫
        let dialogueTimer = null;
        
        function showDialogue(text, isCommand = false, isPixiv = false, isFetish = false) {
            if (dialogueTimer) {
                clearTimeout(dialogueTimer);
            }
            
            speechText.textContent = text;
            
            if (isFetish) {
                // ÊÄßÁôñÂ∞ÇÁî®„ÅÆÁ¥´Ëâ≤
                speechBubble.style.background = '#D4B5FF';
                const style = document.createElement('style');
                style.id = 'speech-arrow-yellow';
                const old = document.getElementById('speech-arrow-yellow');
                if (old) old.remove();
                style.textContent = `#speech-bubble::before { border-color: transparent transparent #D4B5FF transparent !important; }`;
                document.head.appendChild(style);
            } else if (isPixiv) {
                // pixivÂ∞ÇÁî®„ÅÆ„Éî„É≥„ÇØËâ≤
                speechBubble.style.background = '#FFB3D9';
                const style = document.createElement('style');
                style.id = 'speech-arrow-yellow';
                const old = document.getElementById('speech-arrow-yellow');
                if (old) old.remove();
                style.textContent = `#speech-bubble::before { border-color: transparent transparent #FFB3D9 transparent !important; }`;
                document.head.appendChild(style);
            } else if (isCommand) {
                speechBubble.style.background = '#FFF9C4';
                const style = document.createElement('style');
                style.id = 'speech-arrow-yellow';
                const old = document.getElementById('speech-arrow-yellow');
                if (old) old.remove();
                style.textContent = `#speech-bubble::before { border-color: transparent transparent #FFF9C4 transparent !important; }`;
                document.head.appendChild(style);
            } else {
                speechBubble.style.background = 'white';
                const style = document.createElement('style');
                style.id = 'speech-arrow-yellow';
                const old = document.getElementById('speech-arrow-yellow');
                if (old) old.remove();
                style.textContent = `#speech-bubble::before { border-color: transparent transparent white transparent !important; }`;
                document.head.appendChild(style);
            }
            
            speechBubble.classList.add('show');
            
            dialogueTimer = setTimeout(() => {
                speechBubble.classList.remove('show');
                dialogueTimer = null;
            }, 5000);
        }
        
        // „Ç≠„É£„É©„ÇØ„Çø„Éº„Çø„ÉÉ„Éó
        character.addEventListener('click', () => {
            const now = Date.now();
            if (isAnimating || now - lastCommandTime < commandCooldown) return;
            lastCommandTime = now;
            isAnimating = true;
            
            playCharacterSound();
            
            const random = Math.random();
            if (random < 0.4) {
                character.classList.add('jumping');
                setTimeout(() => {
                    character.classList.remove('jumping');
                    isAnimating = false;
                }, 600);
            } else {
                isAnimating = false;
            }
            
            const dialogue = getRandomDialogue();
            showDialogue(dialogue);
            addExperience(1);
            missionProgress.talkCount++;
            dailyMissionProgress.dailyTalkCount++;
            titleProgress.talkCount++;  // Áß∞Âè∑„Ç´„Ç¶„É≥„ÉàËøΩÂä†
            lastInteraction = Date.now();
            saveGameData();
            checkTitleUnlocks();  // Áß∞Âè∑„ÉÅ„Çß„ÉÉ„ÇØ
        });
        
        // aquaËÉåÊôØÁî®„ÅÆ„Çø„ÉÉ„Éó„Ç§„Éô„É≥„ÉàÔºàÊ≥¢Á¥ãÔºâ
        document.body.addEventListener('click', (e) => {
            if (currentBackground === 'aqua') {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.left = e.clientX + 'px';
                ripple.style.top = e.clientY + 'px';
                ripple.style.transform = 'translate(-50%, -50%)';
                starsContainer.appendChild(ripple);
                setTimeout(() => ripple.remove(), 1500);
            }
        });
        
        // pixiv„Éú„Çø„É≥
        document.getElementById('pixiv-btn').addEventListener('click', () => {
            const now = Date.now();
            if (now - lastCommandTime < commandCooldown) return;
            if (collectedStars >= 3) {
                lastCommandTime = now;
                playActionSound();
                collectedStars -= 3;
                updateStarCounter();
                missionProgress.pixivCount++;
                dailyMissionProgress.dailyPixivCount++;
                titleProgress.pixivCount++;  // Áß∞Âè∑„Ç´„Ç¶„É≥„ÉàËøΩÂä†
                saveGameData();
                addExperience(20);
                checkTitleUnlocks();  // Áß∞Âè∑„ÉÅ„Çß„ÉÉ„ÇØ
                
                // „É©„É≥„ÉÄ„É†„Åß„Ç≠„É£„É©ËààÂ•Æ„Çª„É™„Éï„ÅãÊÄßÁôñ„Çª„É™„Éï„ÇíÈÅ∏Êäû
                const isFetishDialogue = Math.random() < 0.3; // 30%„ÅÆÁ¢∫Áéá„ÅßÊÄßÁôñ„Çª„É™„Éï
                
                if (isFetishDialogue) {
                    // ÊÄßÁôñ„Çª„É™„ÉïÔºàÁ¥´„ÅÆÂêπ„ÅçÂá∫„ÅóÔºâ - 20%
                    const dialogue = fetishDialogues[Math.floor(Math.random() * fetishDialogues.length)];
                    showDialogue(dialogue, true, false, true);
                } else {
                    // „Ç≠„É£„É©ËààÂ•Æ„Çª„É™„ÉïÔºà„Éî„É≥„ÇØ„ÅÆÂêπ„ÅçÂá∫„ÅóÔºâ - 80%
                    // „Ç≠„É£„É©ËààÂ•Æ„Çª„É™„ÉïÔºà„Éî„É≥„ÇØ„ÅÆÂêπ„ÅçÂá∫„ÅóÔºâ
                    const dialogue = getPixivDialogue();
                    showDialogue(dialogue, true, true, false);
                }
            }
        });
        
        // Ë§í„ÇÅ„Çã„Éú„Çø„É≥
        
        // „Éü„ÉÉ„Ç∑„Éß„É≥„Éú„Çø„É≥
        document.getElementById('mission-btn').addEventListener('click', () => {
            openMissionModal();
        });
        
        closeMissionBtn.addEventListener('click', () => {
            missionModal.classList.remove('show');
        });
        
        // ‰∏ÄÊã¨Âèó„ÅëÂèñ„Çä„Éú„Çø„É≥
        document.getElementById('claim-all-missions-btn').addEventListener('click', () => {
            claimAllMissions();
        });
        
        missionModal.addEventListener('click', (e) => {
            if (e.target === missionModal) {
                missionModal.classList.remove('show');
            }
        });
        
        // „Ç∑„Éß„ÉÉ„Éó„É¢„Éº„ÉÄ„É´
        const shopModal = document.getElementById('shop-modal');
        const closeShopBtn = document.getElementById('close-shop-btn');
        
        function openShopModal() {
            shopModal.classList.add('show');
            updateShopButtons();
        }
        
        closeShopBtn.addEventListener('click', () => {
            shopModal.classList.remove('show');
        });
        
        shopModal.addEventListener('click', (e) => {
            if (e.target === shopModal) {
                shopModal.classList.remove('show');
            }
        });
        
        // „Ç∑„Éß„ÉÉ„ÉóÂÜÖ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Å™„ÅÑÔºàÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅåÂÖà„Å´Âá∫„Çã„Çà„ÅÜ„Å´Ôºâ
        const shopContent = document.getElementById('shop-content');
        if (shopContent) {
            shopContent.addEventListener('click', (e) => e.stopPropagation());
        }
        
        function updateShopButtons() {
            // „ÉÄ„Ç§„É§Ë≥ºÂÖ•„Éú„Çø„É≥
            const buyDiamondBtn = document.getElementById('buy-diamond-btn');
            if (collectedStars >= 30) {
                buyDiamondBtn.disabled = false;
                buyDiamondBtn.classList.remove('purchased');
            } else {
                buyDiamondBtn.disabled = true;
            }
            
            // „ÇØ„Éº„É´Ë≥ºÂÖ•„Éú„Çø„É≥
            const buyCoolBtn = document.getElementById('buy-cool-btn');
            const hasCool = unlockedCharacters.indexOf('üòé') !== -1;
            if (hasCool) {
                buyCoolBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyCoolBtn.disabled = true;
                buyCoolBtn.classList.add('purchased');
            } else if (collectedStars >= 100) {
                buyCoolBtn.textContent = 'Ë≥ºÂÖ•';
                buyCoolBtn.disabled = false;
                buyCoolBtn.classList.remove('purchased');
            } else {
                buyCoolBtn.textContent = 'Ë≥ºÂÖ•';
                buyCoolBtn.disabled = true;
            }
            
            // „É¶„Éã„Ç≥„Éº„É≥Ë≥ºÂÖ•„Éú„Çø„É≥
            const buyUnicornBtn = document.getElementById('buy-unicorn-btn');
            const hasUnicorn = unlockedCharacters.indexOf('ü¶Ñ') !== -1;
            if (hasUnicorn) {
                buyUnicornBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyUnicornBtn.disabled = true;
                buyUnicornBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 10) {
                buyUnicornBtn.textContent = 'Ë≥ºÂÖ•';
                buyUnicornBtn.disabled = false;
                buyUnicornBtn.classList.remove('purchased');
            } else {
                buyUnicornBtn.textContent = 'Ë≥ºÂÖ•';
                buyUnicornBtn.disabled = true;
            }
            
            // „Éû„Éç„ÉºËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyMoneyBgBtn = document.getElementById('buy-money-bg-btn');
            const hasMoneyBg = unlockedBackgrounds.indexOf('money') !== -1;
            if (hasMoneyBg) {
                buyMoneyBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyMoneyBgBtn.disabled = true;
                buyMoneyBgBtn.classList.add('purchased');
            } else if (collectedStars >= 200) {
                buyMoneyBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyMoneyBgBtn.disabled = false;
                buyMoneyBgBtn.classList.remove('purchased');
            } else {
                buyMoneyBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyMoneyBgBtn.disabled = true;
            }
            
            
            // „Ç∑„É£„É≥„Éë„É≥ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyChampagneBgBtn = document.getElementById('buy-champagne-bg-btn');
            const hasChampagneBg = unlockedBackgrounds.includes('champagne');
            if (hasChampagneBg) {
                buyChampagneBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyChampagneBgBtn.disabled = true;
                buyChampagneBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buyChampagneBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyChampagneBgBtn.disabled = false;
                buyChampagneBgBtn.classList.remove('purchased');
            } else {
                buyChampagneBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyChampagneBgBtn.disabled = true;
            }

            
        // „Ç∑„É£„É≥„Éë„É≥ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-champagne-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('champagne')) return;
            if (collectedDiamonds < 20) return;
            showConfirmModal('ü•Ç „Ç∑„É£„É≥„Éë„É≥ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºàüíé20Ôºâ', () => {
                playActionSound();
                collectedDiamonds -= 20;
                unlockedBackgrounds.push('champagne');
                titleProgress.shopPurchaseCount++;
                titleProgress.shopPurchaseCount++;
                updateDiamondCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                checkTitleUnlocks();
                showDialogue('ü•Ç „Ç∑„É£„É≥„Éë„É≥ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // „Éü„É©„Éº„Éú„Éº„É´ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyDiscoBgBtn = document.getElementById('buy-disco-bg-btn');
            const hasDiscoBg = unlockedBackgrounds.includes('disco');
            if (hasDiscoBg) {
                buyDiscoBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyDiscoBgBtn.disabled = true;
                buyDiscoBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buyDiscoBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyDiscoBgBtn.disabled = false;
                buyDiscoBgBtn.classList.remove('purchased');
            } else {
                buyDiscoBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyDiscoBgBtn.disabled = true;
            }

            
        // „Éü„É©„Éº„Éú„Éº„É´ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-disco-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('disco')) return;
            if (collectedDiamonds < 20) return;
            showConfirmModal('ü™© „Éü„É©„Éº„Éú„Éº„É´ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºàüíé20Ôºâ', () => {
                playActionSound();
                collectedDiamonds -= 20;
                unlockedBackgrounds.push('disco');
                titleProgress.shopPurchaseCount++;
                titleProgress.shopPurchaseCount++;
                updateDiamondCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                checkTitleUnlocks();
                showDialogue('ü™© „Éü„É©„Éº„Éú„Éº„É´ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // Êµ∑ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buySeaBgBtn = document.getElementById('buy-sea-bg-btn');
            const hasSeaBg = unlockedBackgrounds.includes('sea');
            if (hasSeaBg) {
                buySeaBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buySeaBgBtn.disabled = true;
                buySeaBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buySeaBgBtn.textContent = 'Ë≥ºÂÖ•';
                buySeaBgBtn.disabled = false;
                buySeaBgBtn.classList.remove('purchased');
            } else {
                buySeaBgBtn.textContent = 'Ë≥ºÂÖ•';
                buySeaBgBtn.disabled = true;
            }

            
        // Êµ∑ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-sea-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('sea')) return;
            if (collectedDiamonds < 20) return;
            showConfirmModal('üèùÔ∏è Êµ∑ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºàüíé20Ôºâ', () => {
                playActionSound();
                collectedDiamonds -= 20;
                unlockedBackgrounds.push('sea');
                titleProgress.shopPurchaseCount++;
                updateDiamondCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                showDialogue('üèùÔ∏è Êµ∑ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // „É¢„É´„Éï„Ç©Ëù∂ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyMorphoBgBtn = document.getElementById('buy-morpho-bg-btn');
            const hasMorphoBg = unlockedBackgrounds.includes('morpho');
            if (hasMorphoBg) {
                buyMorphoBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyMorphoBgBtn.disabled = true;
                buyMorphoBgBtn.classList.add('purchased');
            } else if (collectedStars >= 200) {
                buyMorphoBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyMorphoBgBtn.disabled = false;
                buyMorphoBgBtn.classList.remove('purchased');
            } else {
                buyMorphoBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyMorphoBgBtn.disabled = true;
            }

            
        // „É¢„É´„Éï„Ç©Ëù∂ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-morpho-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('morpho')) return;
            if (collectedStars < 200) return;
            showConfirmModal('ü¶ã „É¢„É´„Éï„Ç©Ëù∂ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºà‚≠ê200Ôºâ', () => {
                playActionSound();
                collectedStars -= 200;
                unlockedBackgrounds.push('morpho');
                titleProgress.shopPurchaseCount++;
                updateStarCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                showDialogue('ü¶ã „É¢„É´„Éï„Ç©Ëù∂ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // „Éà„É©„É≥„ÉóËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyCardsBgBtn = document.getElementById('buy-cards-bg-btn');
            const hasCardsBg = unlockedBackgrounds.includes('cards');
            if (hasCardsBg) {
                buyCardsBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyCardsBgBtn.disabled = true;
                buyCardsBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buyCardsBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyCardsBgBtn.disabled = false;
                buyCardsBgBtn.classList.remove('purchased');
            } else {
                buyCardsBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyCardsBgBtn.disabled = true;
            }

            
        // „Éà„É©„É≥„ÉóËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-cards-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('cards')) return;
            if (collectedDiamonds < 20) return;
            showConfirmModal('üÉè „Éà„É©„É≥„ÉóËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºàüíé20Ôºâ', () => {
                playActionSound();
                collectedDiamonds -= 20;
                unlockedBackgrounds.push('cards');
                titleProgress.shopPurchaseCount++;
                updateDiamondCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                showDialogue('üÉè „Éà„É©„É≥„ÉóËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // „Éç„Ç™„É≥ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyNeonCandyBgBtn = document.getElementById('buy-neoncandy-bg-btn');
            const hasNeonCandyBg = unlockedBackgrounds.includes('neoncandy');
            if (hasNeonCandyBg) {
                buyNeonCandyBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyNeonCandyBgBtn.disabled = true;
                buyNeonCandyBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buyNeonCandyBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyNeonCandyBgBtn.disabled = false;
                buyNeonCandyBgBtn.classList.remove('purchased');
            } else {
                buyNeonCandyBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyNeonCandyBgBtn.disabled = true;
            }

            
        // „Éç„Ç™„É≥ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-neoncandy-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('neoncandy')) return;
            if (collectedDiamonds < 20) return;
            showConfirmModal('üç¨ „Éç„Ç™„É≥ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºàüíé20Ôºâ', () => {
                playActionSound();
                collectedDiamonds -= 20;
                unlockedBackgrounds.push('neoncandy');
                titleProgress.shopPurchaseCount++;
                updateDiamondCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                showDialogue('üç¨ „Éç„Ç™„É≥ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // „Éù„ÉÜ„ÉàËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyFriesBgBtn = document.getElementById('buy-fries-bg-btn');
            const hasFriesBg = unlockedBackgrounds.includes('fries');
            if (hasFriesBg) {
                buyFriesBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyFriesBgBtn.disabled = true;
                buyFriesBgBtn.classList.add('purchased');
            } else if (collectedStars >= 200) {
                buyFriesBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyFriesBgBtn.disabled = false;
                buyFriesBgBtn.classList.remove('purchased');
            } else {
                buyFriesBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyFriesBgBtn.disabled = true;
            }

            
        // „Éù„ÉÜ„ÉàËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-fries-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('fries')) return;
            if (collectedStars < 200) return;
            showConfirmModal('üçü „Éù„ÉÜ„ÉàËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºà‚≠ê200Ôºâ', () => {
                playActionSound();
                collectedStars -= 200;
                unlockedBackgrounds.push('fries');
                titleProgress.shopPurchaseCount++;
                updateStarCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                showDialogue('üçü „Éù„ÉÜ„ÉàËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });



            // üé≤„É©„É≥„ÉÄ„É†ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥
            const buyDiceBgBtn = document.getElementById('buy-dice-bg-btn');
            const hasDiceBg = unlockedBackgrounds.includes('dice');
            if (hasDiceBg) {
                buyDiceBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyDiceBgBtn.disabled = true;
                buyDiceBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buyDiceBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyDiceBgBtn.disabled = false;
                buyDiceBgBtn.classList.remove('purchased');
            } else {
                buyDiceBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyDiceBgBtn.disabled = true;
            }

            
        // üé≤„É©„É≥„ÉÄ„É†ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-dice-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (unlockedBackgrounds.includes('dice')) return;
            if (collectedDiamonds < 20) return;
            showConfirmModal('üé≤ „É©„É≥„ÉÄ„É†ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºüÔºàüíé20Ôºâ', () => {
                playActionSound();
                collectedDiamonds -= 20;
                unlockedBackgrounds.push('dice');
                titleProgress.shopPurchaseCount++;
                updateDiamondCounter();
                saveGameData();
                updateShopButtons();
                updateClosetItems();
                checkTitleUnlocks();
                showDialogue('üé≤ „É©„É≥„ÉÄ„É†ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
            });
        });


// „Ç∏„É•„Ç®„É´ËÉåÊôØË≥ºÂÖ•„Éú„Çø„É≥








            const buyJewelBgBtn = document.getElementById('buy-jewel-bg-btn');
            const hasJewelBg = unlockedBackgrounds.indexOf('jewel') !== -1;
            if (hasJewelBg) {
                buyJewelBgBtn.textContent = 'Ë≥ºÂÖ•Ê∏à„Åø';
                buyJewelBgBtn.disabled = true;
                buyJewelBgBtn.classList.add('purchased');
            } else if (collectedDiamonds >= 20) {
                buyJewelBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyJewelBgBtn.disabled = false;
                buyJewelBgBtn.classList.remove('purchased');
            } else {
                buyJewelBgBtn.textContent = 'Ë≥ºÂÖ•';
                buyJewelBgBtn.disabled = true;
            }
        }
        
        // „ÉÄ„Ç§„É§Ë≥ºÂÖ•
        // Ë≥ºÂÖ•Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´
        const confirmModal = document.getElementById('confirm-modal');
        const confirmTitle = document.getElementById('confirm-modal-title');
        const confirmMessage = document.getElementById('confirm-modal-message');
        const confirmYesBtn = document.getElementById('confirm-yes-btn');
        const confirmNoBtn = document.getElementById('confirm-no-btn');
        
        let pendingPurchase = null;
        const confirmDefaults = {
            title: confirmTitle.textContent,
            yesText: confirmYesBtn.textContent,
            noText: confirmNoBtn.textContent
        };
function showConfirmModal(message, onConfirm, options = {}) {
    // options: { title?: string, yesText?: string, noText?: string }
    const title = (typeof options.title === 'string') ? options.title : confirmDefaults.title;
    const yesText = (typeof options.yesText === 'string') ? options.yesText : confirmDefaults.yesText;
    const noText = (typeof options.noText === 'string') ? options.noText : confirmDefaults.noText;

    confirmTitle.textContent = title;
    confirmYesBtn.textContent = yesText;
    confirmNoBtn.textContent = noText;

    confirmMessage.innerHTML = message;
    confirmModal.classList.add('show');
    pendingPurchase = onConfirm;
}
function hideConfirmModal() {
            confirmModal.classList.remove('show');
            pendingPurchase = null;
        }
        
        confirmYesBtn.addEventListener('click', () => {
            if (pendingPurchase) {
                pendingPurchase();
            }
            hideConfirmModal();
        });
        
        confirmNoBtn.addEventListener('click', () => {
            hideConfirmModal();
        });
        
        // „É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        confirmModal.addEventListener('click', (e) => {
            if (e.target === confirmModal) {
                hideConfirmModal();
            }
        });
        
        // „ÉÄ„Ç§„É§Ë≥ºÂÖ•
        document.getElementById('buy-diamond-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (collectedStars >= 30) {
                showConfirmModal(
                    'üíé „ÉÄ„Ç§„É§ √ó 1<br>‚≠êÔ∏è 30ÂÄã„ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü',
                    () => {
                        playActionSound();
                        collectedStars -= 30;
                        collectedDiamonds += 1;
                        updateStarCounter();
                        updateDiamondCounter();
                        saveGameData();
                        updateShopButtons();
                        showDialogue('„ÉÄ„Ç§„É§„Çí1ÂÄãË≥ºÂÖ•„Åó„ÅüÔºÅüíé', true);
                    }
                );
            }
        });
        
        // „ÇØ„Éº„É´Ë≥ºÂÖ•
        document.getElementById('buy-cool-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (collectedStars >= 100) {
                const coolChar = { emoji: 'üòé', name: '„ÇØ„Éº„É´', rarity: 'shop' };
                if (unlockedCharacters.indexOf('üòé') === -1) {
                    showConfirmModal(
                        'üòé „ÇØ„Éº„É´<br>‚≠êÔ∏è 100ÂÄã„ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü',
                        () => {
                            playActionSound();
                            collectedStars -= 100;
                            unlockedCharacters.push('üòé');
                            updateStarCounter();
                            saveGameData();
                            updateShopButtons();
                            showDialogue('üòé „ÇØ„Éº„É´„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
                        }
                    );
                }
            }
        });
        
        // „É¶„Éã„Ç≥„Éº„É≥Ë≥ºÂÖ•
        document.getElementById('buy-unicorn-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (collectedDiamonds >= 10) {
                const unicornChar = { emoji: 'ü¶Ñ', name: '„É¶„Éã„Ç≥„Éº„É≥', rarity: 'shop' };
                if (unlockedCharacters.indexOf('ü¶Ñ') === -1) {
                    showConfirmModal(
                        'ü¶Ñ „É¶„Éã„Ç≥„Éº„É≥<br>üíé 10ÂÄã„ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü',
                        () => {
                            playActionSound();
                            collectedDiamonds -= 10;
                            unlockedCharacters.push('ü¶Ñ');
                            updateDiamondCounter();
                            saveGameData();
                            updateShopButtons();
                            showDialogue('ü¶Ñ „É¶„Éã„Ç≥„Éº„É≥„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
                        }
                    );
                }
            }
        });
        
        // „Éû„Éç„ÉºËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-money-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (collectedStars >= 200) {
                const moneyBg = { id: 'money', name: '„Éû„Éç„Éº', emoji: 'üí∞', rarity: 'shop' };
                if (!unlockedBackgrounds.indexOf('money') !== -1) {
                    showConfirmModal(
                        'üí∞ „Éû„Éç„ÉºËÉåÊôØ<br>‚≠êÔ∏è 200ÂÄã„ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü',
                        () => {
                            playActionSound();
                            collectedStars -= 200;
                            unlockedBackgrounds.push('money');
                titleProgress.shopPurchaseCount++;
                            updateStarCounter();
                            saveGameData();
                            updateShopButtons();
                            showDialogue('üí∞ „Éû„Éç„ÉºËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
                        }
                    );
                }
            }
        });
        
        // „Ç∏„É•„Ç®„É´ËÉåÊôØË≥ºÂÖ•
        document.getElementById('buy-jewel-bg-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            if (collectedDiamonds >= 20) {
                const jewelBg = { id: 'jewel', name: '„Ç∏„É•„Ç®„É´', emoji: 'üíç', rarity: 'shop' };
                if (!unlockedBackgrounds.indexOf('jewel') !== -1) {
                    showConfirmModal(
                        'üíç „Ç∏„É•„Ç®„É´ËÉåÊôØ<br>üíé 20ÂÄã„ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü',
                        () => {
                            playActionSound();
                            collectedDiamonds -= 20;
                            unlockedBackgrounds.push('jewel');
                titleProgress.shopPurchaseCount++;
                            updateDiamondCounter();
                            saveGameData();
                            updateShopButtons();
                            showDialogue('üíç „Ç∏„É•„Ç®„É´ËÉåÊôØ„ÇíË≥ºÂÖ•„Åó„ÅüÔºÅ', true);
                        }
                    );
                }
            }
        });
        
        function openMissionModal() {
            missionModal.classList.add('show');
            updateMissionList();
        }
        
        function updateMissionList() {
            missionList.innerHTML = '';
            
            // ÈÄöÂ∏∏„Éü„ÉÉ„Ç∑„Éß„É≥„ÇíÂàÜÈ°û
            const claimableMissions = [];
            const inProgressMissions = [];
            
            missions.forEach(mission => {
                let currentProgress = 0;
                if (mission.type === 'talk') {
                    currentProgress = missionProgress.talkCount;
                } else if (mission.type === 'pixiv') {
                    currentProgress = missionProgress.pixivCount;
                } else if (mission.type === 'rank') {
                    currentProgress = rank;
                }
                
                const isCompleted = currentProgress >= mission.target;
                const isClaimed = claimedMissions.includes(mission.id);
                
                // ÈÅîÊàêÊ∏à„Åø„ÅØË°®Á§∫„Åó„Å™„ÅÑ
                if (isClaimed) {
                    return;
                }
                
                // Âèó„ÅëÂèñ„ÇäÂèØËÉΩ„Å®ÈÄ≤Ë°å‰∏≠„Å´ÂàÜÈ°û
                if (isCompleted) {
                    claimableMissions.push({ mission, currentProgress, isDaily: false });
                } else {
                    inProgressMissions.push({ mission, currentProgress, isDaily: false });
                }
            });
            
            // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„ÇíÂàÜÈ°û
            const claimableDailyMissions = [];
            const inProgressDailyMissions = [];
            
            dailyMissions.forEach(mission => {
                let currentProgress = 0;
                if (mission.type === 'dailyTalk') {
                    currentProgress = dailyMissionProgress.dailyTalkCount;
                } else if (mission.type === 'dailyPixiv') {
                    currentProgress = dailyMissionProgress.dailyPixivCount;
                } else if (mission.type === 'openGacha') {
                    currentProgress = dailyMissionProgress.openedGacha ? 1 : 0;
                } else if (mission.type === 'changeDecor') {
                    currentProgress = dailyMissionProgress.changedDecor ? 1 : 0;
                }
                
                const isCompleted = currentProgress >= mission.target;
                const isClaimed = dailyClaimedMissions.includes(mission.id);
                
                // Âèó„ÅëÂèñ„ÇäÊ∏à„Åø„ÅØË°®Á§∫„Åó„Å™„ÅÑ
                if (isClaimed) {
                    return;
                }
                
                // Âèó„ÅëÂèñ„ÇäÂèØËÉΩ„Å®ÈÄ≤Ë°å‰∏≠„Å´ÂàÜÈ°û
                if (isCompleted) {
                    claimableDailyMissions.push({ mission, currentProgress, isDaily: true });
                } else {
                    inProgressDailyMissions.push({ mission, currentProgress, isDaily: true });
                }
            });
            
            // Ë°®Á§∫È†Ü: Âèó„ÅëÂèñ„ÇäÂèØËÉΩ„Å™ÈÄöÂ∏∏„Éü„ÉÉ„Ç∑„Éß„É≥ ‚Üí Âèó„ÅëÂèñ„ÇäÂèØËÉΩ„Å™„Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥ ‚Üí ÈÄ≤Ë°å‰∏≠„ÅÆ„Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥ ‚Üí ÈÄ≤Ë°å‰∏≠„ÅÆÈÄöÂ∏∏„Éü„ÉÉ„Ç∑„Éß„É≥
            [...claimableMissions, ...claimableDailyMissions, ...inProgressDailyMissions, ...inProgressMissions].forEach(({ mission, currentProgress, isDaily }) => {
                const missionItem = document.createElement('div');
                missionItem.className = 'mission-item';
                if (isDaily) {
                    missionItem.classList.add('daily');
                }
                
                const isCompleted = currentProgress >= mission.target;
                
                const rewardIcon = mission.rewardType === 'diamond' ? 'üíé' : '‚≠êÔ∏è';
                
                missionItem.innerHTML = `
                    <div class="mission-title">${isDaily ? 'üìÖ ' : ''}${mission.name}</div>
                    <div class="mission-progress">ÈÄ≤Êçó: ${Math.min(currentProgress, mission.target)}/${mission.target}</div>
                    <div class="mission-reward">Â†±ÈÖ¨: ${rewardIcon} √ó ${mission.reward}</div>
                `;
                
                if (isCompleted) {
                    const claimBtn = document.createElement('button');
                    claimBtn.className = 'mission-claim-btn';
                    claimBtn.textContent = 'Â†±ÈÖ¨„ÇíÂèó„ÅëÂèñ„Çã';
                    claimBtn.addEventListener('click', () => {
                        claimMissionReward(mission, isDaily);
                    });
                    missionItem.appendChild(claimBtn);
                }
                
                missionList.appendChild(missionItem);
            });
            
            // ÂÖ®„Å¶ÈÅîÊàêÊ∏à„Åø„ÅÆÂ†¥Âêà
            if (claimableMissions.length === 0 && claimableDailyMissions.length === 0 && inProgressMissions.length === 0 && inProgressDailyMissions.length === 0) {
                missionList.innerHTML = '<div style="text-align:center; color:white; padding:20px;">ÂÖ®„Å¶„ÅÆ„Éü„ÉÉ„Ç∑„Éß„É≥„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅüéâ</div>';
            }
        }
        
        function claimMissionReward(mission, isDaily = false) {
            if (mission.rewardType === 'diamond') {
                // „ÉÄ„Ç§„É§Â†±ÈÖ¨
                collectedDiamonds = Math.min(collectedDiamonds + mission.reward, maxDiamonds);
                updateDiamondCounter();
            } else {
                // ÊòüÂ†±ÈÖ¨
                collectedStars = Math.min(collectedStars + mission.reward, maxStars);
                updateStarCounter();
            }
            
            // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„ÅãÈÄöÂ∏∏„Éü„ÉÉ„Ç∑„Éß„É≥„Åã„ÅßÂàÜ„Åë„Çã
            if (isDaily) {
                dailyClaimedMissions.push(mission.id);
            } else {
                claimedMissions.push(mission.id);
            }
            
            saveGameData();
            updateMissionList();
            playStarSound();
        }
        
        // ‰∏ÄÊã¨Âèó„ÅëÂèñ„ÇäÈñ¢Êï∞
        function claimAllMissions() {
            let claimedCount = 0;
            let totalStars = 0;
            let totalDiamonds = 0;
            
            // ÈÄöÂ∏∏„Éü„ÉÉ„Ç∑„Éß„É≥
            missions.forEach(mission => {
                if (claimedMissions.includes(mission.id)) return;
                
                let currentProgress = 0;
                switch(mission.type) {
                    case 'talk':
                        currentProgress = missionProgress.talkCount;
                        break;
                    case 'pixiv':
                        currentProgress = missionProgress.pixivCount;
                        break;
                    case 'rank':
                        currentProgress = rank;
                        break;
                }
                
                if (currentProgress >= mission.target) {
                    if (mission.rewardType === 'diamond') {
                        totalDiamonds += mission.reward;
                    } else {
                        totalStars += mission.reward;
                    }
                    claimedMissions.push(mission.id);
                    claimedCount++;
                }
            });
            
            // „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥
            dailyMissions.forEach(mission => {
                if (dailyClaimedMissions.includes(mission.id)) return;
                
                let currentProgress = 0;
                switch(mission.type) {
                    case 'dailyTalk':
                        currentProgress = dailyMissionProgress.dailyTalkCount;
                        break;
                    case 'dailyPixiv':
                        currentProgress = dailyMissionProgress.dailyPixivCount;
                        break;
                    case 'openGacha':
                        currentProgress = dailyMissionProgress.openedGacha ? 1 : 0;
                        break;
                    case 'changeDecor':
                        currentProgress = dailyMissionProgress.changedDecor ? 1 : 0;
                        break;
                }
                
                if (currentProgress >= mission.target) {
                    if (mission.rewardType === 'diamond') {
                        totalDiamonds += mission.reward;
                    } else {
                        totalStars += mission.reward;
                    }
                    dailyClaimedMissions.push(mission.id);
                    claimedCount++;
                }
            });
            
            if (claimedCount > 0) {
                // Â†±ÈÖ¨„Çí‰ªò‰∏é
                collectedStars = Math.min(collectedStars + totalStars, maxStars);
                collectedDiamonds = Math.min(collectedDiamonds + totalDiamonds, maxDiamonds);
                updateStarCounter();
                updateDiamondCounter();
                saveGameData();
                updateMissionList();
                
                // ÂäπÊûúÈü≥„ÇíÂÜçÁîü
                playCollectAllSound();
                
                // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
                let message = `${claimedCount}ÂÄã„ÅÆ„Éü„ÉÉ„Ç∑„Éß„É≥„ÇíÈÅîÊàêÔºÅ`;
                if (totalStars > 0) message += ` ‚≠ê${totalStars}`;
                if (totalDiamonds > 0) message += ` üíé${totalDiamonds}`;
                showDialogue(message, true);
            } else {
                showDialogue('Âèó„ÅëÂèñ„Çå„Çã„Éü„ÉÉ„Ç∑„Éß„É≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', true);
            }
        }
        
        // „É©„É≥„ÇØË°®Á§∫„Çí„Çø„ÉÉ„Éó„Åó„Å¶„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        rankDisplay.addEventListener('click', (e) => {
            e.stopPropagation();
            openRankModal();
        });
        
        // „É¶„Éº„Ç∂„Éº„Éç„Éº„É†Ë°®Á§∫„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        usernameText.addEventListener('click', (e) => {
            e.stopPropagation();
            usernameInput.value = username === 'ÂêçÂâç„ÇíÂÖ•Âäõ' ? '' : username;
            updateCharCount();
            usernameModal.classList.add('show');
            setTimeout(() => usernameInput.focus(), 100);
        });
        
        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        closeModalBtn.addEventListener('click', () => {
            rankModal.classList.remove('show');
        });
        
        // „É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÇÇÈñâ„Åò„Çã
        rankModal.addEventListener('click', (e) => {
            if (e.target === rankModal) {
                rankModal.classList.remove('show');
            }
        });
        
        // „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openRankModal() {
            rankModal.classList.add('show');
            updateRewardItems();
        }
        
        // Â†±ÈÖ¨„Ç¢„Ç§„ÉÜ„É†„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateRewardItems() {
            const rewardItems = document.querySelectorAll('.reward-item');
            
            rewardItems.forEach(item => {
                const requiredRank = parseInt(item.dataset.rank);
                const type = item.dataset.type;
                const value = item.dataset.value;
                
                // „É≠„ÉÉ„ÇØËß£Èô§Âà§ÂÆö
                if (rank >= requiredRank) {
                    item.classList.remove('locked');
                    const lockText = item.querySelector('.reward-locked');
                    if (lockText) {
                        lockText.className = 'reward-unlock';
                        lockText.textContent = 'Ëß£Á¶ÅÊ∏à„Åø';
                    }
                    
                    // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                    item.onclick = () => {
                        if (type === 'character') {
                            currentCharacter = value;
                            character.textContent = value;
                            // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                            document.querySelectorAll('[data-type="character"]').forEach(el => {
                                el.classList.remove('active');
                            });
                            item.classList.add('active');
                        } else if (type === 'background') {
                            currentBackground = value;
                            document.body.className = value + '-bg';
                            
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect(value);
                            // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                            document.querySelectorAll('[data-type="background"]').forEach(el => {
                                el.classList.remove('active');
                            });
                            item.classList.add('active');
                        }
                        saveGameData();
                    };
                } else {
                    item.classList.add('locked');
                    item.onclick = null;
                }
                
                // ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
                if (type === 'character' && value === currentCharacter) {
                    item.classList.add('active');
                } else if (type === 'background' && value === currentBackground) {
                    item.classList.add('active');
                } else if (type === item.dataset.type) {
                    item.classList.remove('active');
                }
            });
        }
        
        // „Ç¨„ÉÅ„É£„Éú„Çø„É≥
        document.getElementById('gacha-btn').addEventListener('click', () => {
            gachaModal.classList.add('show');
            gachaResult.innerHTML = '';
            dailyMissionProgress.openedGacha = true;
            saveGameData();
            updateGachaPullButton();
        });
        
        // Êòü„Ç¨„ÉÅ„É£„ÇíÂºï„Åè
        gachaPullBtnStar.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            if (collectedStars < 10) return;
            
            collectedStars -= 10;
            updateStarCounter();
            saveGameData();
            
            // „Ç¨„ÉÅ„É£ÊºîÂá∫
            gachaResult.innerHTML = '<div class="gacha-result-text">„Ç¨„ÉÅ„É£‰∏≠...</div>';
            
            setTimeout(() => {
                try {
                    const result = pullGacha();
                    displayGachaResult(result);
                } catch (error) {
                    console.error('„Ç¨„ÉÅ„É£„Ç®„É©„Éº:', error);
                    gachaResult.innerHTML = '<div class="gacha-result-text">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ</div>';
                    // Êòü„ÇíËøîÂç¥
                    collectedStars += 10;
                    updateStarCounter();
                    saveGameData();
                }
            }, 1000);
        });
        
        // „ÉÄ„Ç§„É§„Ç¨„ÉÅ„É£„ÇíÂºï„Åè
        gachaPullBtnDiamond.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            if (collectedDiamonds < 1) return;
            
            collectedDiamonds -= 1;
            updateDiamondCounter();
            saveGameData();
            
            // „Ç¨„ÉÅ„É£ÊºîÂá∫
            gachaResult.innerHTML = '<div class="gacha-result-text">‚ú® SSR„Ç¨„ÉÅ„É£‰∏≠... ‚ú®</div>';
            
            setTimeout(() => {
                try {
                    const result = pullDiamondGacha();
                    displayGachaResult(result);
                } catch (error) {
                    console.error('„Ç¨„ÉÅ„É£„Ç®„É©„Éº:', error);
                    gachaResult.innerHTML = '<div class="gacha-result-text">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ</div>';
                    // „ÉÄ„Ç§„É§„ÇíËøîÂç¥
                    collectedDiamonds += 1;
                    updateDiamondCounter();
                    saveGameData();
                }
            }, 1000);
        });
        
        // „Ç¨„ÉÅ„É£„ÇíÂºï„ÅèÂá¶ÁêÜÔºàÂÆåÂÖ®Ë¢´„ÇäÈò≤Ê≠¢ÁâàÔºâ
        function pullGacha() {
            let item;
            let type;

            function pickFrom(list){ return list[Math.floor(Math.random() * list.length)]; }
            
            function isOwned(t, it){
                if (!it) return false;
                if (t === 'character') return unlockedCharacters.includes(it.emoji);
                if (t === 'background') return unlockedBackgrounds.includes(it.id);
                if (t === 'decor') return !!ownedDecor[it.emoji];
                return false;
            }

            // „Åæ„ÅöÊú™ÊâÄÊåÅ„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí„Åô„Åπ„Å¶ÈõÜ„ÇÅ„Çã
            const unownedCharacters = gachaCharactersPool.filter(c => !unlockedCharacters.includes(c.emoji));
            const unownedBackgrounds = gachaBackgroundsPool.filter(b => !unlockedBackgrounds.includes(b.id));
            const unownedDecors = gachaDecors.filter(d => !ownedDecor[d.emoji]);

            // „Åô„Åπ„Å¶„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Éó„Éº„É´
            const allUnowned = [
                ...unownedCharacters.map(c => ({ type: 'character', item: c })),
                ...unownedBackgrounds.map(b => ({ type: 'background', item: b })),
                ...unownedDecors.map(d => ({ type: 'decor', item: d }))
            ];

            // Êú™ÊâÄÊåÅ„Ç¢„Ç§„ÉÜ„É†„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÊú™ÊâÄÊåÅ„Åã„ÇâÈÅ∏„Å∂
            if (allUnowned.length > 0) {
                // „É¨„Ç¢„É™„ÉÜ„Ç£„Åî„Å®„ÅÆÁ¢∫Áéá„ÅßÊäΩÈÅ∏
                const random = Math.random() * 100;
                let targetRarity;
                if (random < 45) targetRarity = 'common';        // 45%
                else if (random < 75) targetRarity = 'rare';     // 30%
                else if (random < 97) targetRarity = 'sr';       // 22%
                else targetRarity = 'ssr';                       // 3%

                // ÊåáÂÆö„É¨„Ç¢„É™„ÉÜ„Ç£„ÅÆÊú™ÊâÄÊåÅ„Ç¢„Ç§„ÉÜ„É†„ÇíÂèñÂæó
                let filteredUnowned = allUnowned.filter(x => x.item.rarity === targetRarity);
                
                // ÊåáÂÆö„É¨„Ç¢„É™„ÉÜ„Ç£„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÊ¨°„ÅÆ„É¨„Ç¢„É™„ÉÜ„Ç£„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                if (filteredUnowned.length === 0) {
                    const rarityOrder = ['ssr', 'sr', 'rare', 'common'];
                    const startIdx = rarityOrder.indexOf(targetRarity);
                    for (let i = startIdx + 1; i < rarityOrder.length; i++) {
                        filteredUnowned = allUnowned.filter(x => x.item.rarity === rarityOrder[i]);
                        if (filteredUnowned.length > 0) break;
                    }
                }
                
                // „Åù„Çå„Åß„ÇÇ„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®Êú™ÊâÄÊåÅ„Åã„Çâ„É©„É≥„ÉÄ„É†
                if (filteredUnowned.length === 0) {
                    filteredUnowned = allUnowned;
                }

                const selected = pickFrom(filteredUnowned);
                type = selected.type;
                item = selected.item;
            } else {
                // ÂÖ®ÈÉ®ÊâÄÊåÅÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÈÄöÂ∏∏„ÅÆ„É©„É≥„ÉÄ„É†ÊäΩÈÅ∏
                const random = Math.random() * 100;
                let rarity;
                if (random < 45) rarity = 'common';        // 45%
                else if (random < 75) rarity = 'rare';     // 30%
                else if (random < 97) rarity = 'sr';       // 22%
                else rarity = 'ssr';                       // 3%

                const roll = Math.random();
                if (roll < 0.4) type = 'character';
                else if (roll < 0.7) type = 'background';
                else type = 'decor';

                let list = [];
                if (type === 'character') {
                    list = gachaCharactersPool.filter(c => c.rarity === rarity);
                    if (list.length === 0) list = gachaCharactersPool;
                } else if (type === 'background') {
                    list = gachaBackgroundsPool.filter(b => b.rarity === rarity);
                    if (list.length === 0) list = gachaBackgroundsPool;
                } else {
                    list = gachaDecors.filter(d => d.rarity === rarity);
                    if (list.length === 0) list = gachaDecors;
                }

                item = pickFrom(list);
            }

            const wasOwned = isOwned(type, item);

            // „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Å´ËøΩÂä†
            if (type === 'character') {
                if (!unlockedCharacters.includes(item.emoji)) {
                    unlockedCharacters.push(item.emoji);
                }
                saveGameData();
                return { type: type, item: item, isNew: !wasOwned };
            } else if (type === 'background') {
                if (!unlockedBackgrounds.includes(item.id)) {
                    unlockedBackgrounds.push(item.id);
                }
                saveGameData();
                return { type: type, item: item, isNew: !wasOwned };
            } else if (type === 'decor') {
                if (!ownedDecor[item.emoji]) {
                    ownedDecor[item.emoji] = item.name;
                }
                saveGameData();
                return { type: type, item: item, isNew: !wasOwned };
            }

            return { type: type, item: item, isNew: false };
        }
        
        // „ÉÄ„Ç§„É§„Ç¨„ÉÅ„É£ÔºàSSRÁ¢∫ÂÆöÔºâ
        function pullDiamondGacha() {
            let item;
            let type;

            function pickFrom(list){ return list[Math.floor(Math.random() * list.length)]; }
            
            // SSR„ÅÆ„Åø„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíÈõÜ„ÇÅ„Çã
            const ssrCharacters = gachaCharactersPool.filter(c => c.rarity === 'ssr');
            const ssrBackgrounds = gachaBackgroundsPool.filter(b => b.rarity === 'ssr');
            const ssrDecors = gachaDecors.filter(d => d.rarity === 'ssr');
            
            // Êú™ÊâÄÊåÅ„ÅÆSSR„ÇíÂÑ™ÂÖà
            const unownedSSRCharacters = ssrCharacters.filter(c => !unlockedCharacters.includes(c.emoji));
            const unownedSSRBackgrounds = ssrBackgrounds.filter(b => !unlockedBackgrounds.includes(b.id));
            const unownedSSRDecors = ssrDecors.filter(d => !ownedDecor[d.emoji]);
            
            const allUnownedSSR = [
                ...unownedSSRCharacters.map(c => ({ type: 'character', item: c })),
                ...unownedSSRBackgrounds.map(b => ({ type: 'background', item: b })),
                ...unownedSSRDecors.map(d => ({ type: 'decor', item: d }))
            ];
            
            // Êú™ÊâÄÊåÅSSR„Åå„ÅÇ„Çå„Å∞„Åù„Åì„Åã„ÇâÈÅ∏„Å∂
            if (allUnownedSSR.length > 0) {
                const selected = pickFrom(allUnownedSSR);
                type = selected.type;
                item = selected.item;
            } else {
                // ÂÖ®SSRÊâÄÊåÅÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÂÖ®SSR„Åã„Çâ„É©„É≥„ÉÄ„É†
                const allSSR = [
                    ...ssrCharacters.map(c => ({ type: 'character', item: c })),
                    ...ssrBackgrounds.map(b => ({ type: 'background', item: b })),
                    ...ssrDecors.map(d => ({ type: 'decor', item: d }))
                ];
                
                if (allSSR.length > 0) {
                    const selected = pickFrom(allSSR);
                    type = selected.type;
                    item = selected.item;
                } else {
                    // SSR„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥ÂêàÔºàÂøµ„ÅÆ„Åü„ÇÅÔºâ
                    return pullGacha();
                }
            }
            
            const wasOwned = (type === 'character' && unlockedCharacters.includes(item.emoji)) ||
                           (type === 'background' && unlockedBackgrounds.includes(item.id)) ||
                           (type === 'decor' && ownedDecor[item.emoji]);

            if (type === 'character') {
                if (!unlockedCharacters.includes(item.emoji)) {
                    unlockedCharacters.push(item.emoji);
                }
                saveGameData();
                return { type: type, item: item, isNew: !wasOwned };
            } else if (type === 'background') {
                if (!unlockedBackgrounds.includes(item.id)) {
                    unlockedBackgrounds.push(item.id);
                }
                saveGameData();
                return { type: type, item: item, isNew: !wasOwned };
            } else if (type === 'decor') {
                if (!ownedDecor[item.emoji]) {
                    ownedDecor[item.emoji] = item.name;
                }
                saveGameData();
                return { type: type, item: item, isNew: !wasOwned };
            }

            return { type: type, item: item, isNew: false };
        }
        
        // „Ç¨„ÉÅ„É£ÂäπÊûúÈü≥
        function playGachaSound(rarity) {
            // ÂäπÊûúÈü≥„Åå0%„ÅÆÂ†¥Âêà„ÅØÂÜçÁîü„Åó„Å™„ÅÑ
            if (seVolume <= 0) {
                return;
            }
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // AudioContext„Ååsuspended„ÅÆÂ†¥Âêà„ÅØresume
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        playGachaSoundInternal(audioContext, rarity);
                    });
                } else {
                    playGachaSoundInternal(audioContext, rarity);
                }
            } catch (error) {
                // „Ç®„É©„Éº„ÅØÁÑ°Ë¶ñÔºàÈü≥„ÅåÈ≥¥„Çâ„Å™„ÅÑ„Å†„ÅëÔºâ
            }
        }
        
        function playGachaSoundInternal(audioContext, rarity) {
            const now = audioContext.currentTime;
            
            // seVolume„Åå0„ÅÆÂ†¥Âêà„Åß„ÇÇ„Ç®„É©„Éº„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´ÊúÄÂ∞èÂÄ§„Çí‰øùË®º
            const minVolume = 0.001;
            const effectiveSeVolume = Math.max(seVolume, 0.001);
            
            if (rarity === 'ssr') {
                    // SSR: Rare„ÅÆÈü≥„ÇíÈ´ò„Åè„Åó„Åü2Èü≥
                    const frequencies = [392.00, 493.88]; // G4, B4
                    frequencies.forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(freq, now);
                        
                        gain.gain.setValueAtTime(0, now);
                        gain.gain.linearRampToValueAtTime(0.25 * effectiveSeVolume, now + 0.05);
                        gain.gain.exponentialRampToValueAtTime(Math.max(0.02 * effectiveSeVolume, minVolume), now + 0.5);
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.start(now + i * 0.1);
                    osc.stop(now + 0.5);
                });
            } else if (rarity === 'sr') {
                // SR: Rare„Å®SSR„ÅÆ‰∏≠Èñì„ÅÆ2Èü≥
                const frequencies = [329.63, 415.30]; // E4, G#4
                frequencies.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, now);
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.22 * effectiveSeVolume, now + 0.05);
                    gain.gain.exponentialRampToValueAtTime(Math.max(0.02 * effectiveSeVolume, minVolume), now + 0.45);
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.start(now + i * 0.1);
                    osc.stop(now + 0.45);
                });
            } else if (rarity === 'rare') {
                // Rare: „Ç∑„É≥„Éó„É´„Å™‰∏äÊòáÈü≥
                const frequencies = [261.63, 329.63]; // C4, E4
                frequencies.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, now);
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.2 * effectiveSeVolume, now + 0.05);
                    gain.gain.exponentialRampToValueAtTime(Math.max(0.02 * effectiveSeVolume, minVolume), now + 0.4);
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.start(now + i * 0.1);
                    osc.stop(now + 0.4);
                });
            } else {
                // Common: Áü≠„ÅÑ„Éù„ÉÉ„ÉóÈü≥
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(261.63, now); // C4
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.16 * effectiveSeVolume, now + 0.05);
                gain.gain.exponentialRampToValueAtTime(Math.max(0.02 * effectiveSeVolume, minVolume), now + 0.3);
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.start(now);
                osc.stop(now + 0.3);
            }
        }
        
        // „Ç¨„ÉÅ„É£ÁµêÊûúË°®Á§∫
        function displayGachaResult(result) {
            if (!result || !result.item) {
                gachaResult.innerHTML = '<div class="gacha-result-text">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</div>';
                return;
            }
            
            const rarityNames = {
                common: '„Ç≥„É¢„É≥',
                rare: '„É¨„Ç¢',
                sr: 'SR',
                ssr: 'SSR'
            };
            
            const typeNames = {
                character: '„Ç≠„É£„É©„ÇØ„Çø„Éº',
                background: 'ËÉåÊôØ',
                decor: 'È£æ„Çä'
            };
            
            const icon = result.type === 'character' ? result.item.emoji : result.item.emoji;
            const name = result.item.name || '???';
            const rarity = rarityNames[result.item.rarity] || '„Ç≥„É¢„É≥';
            const type = typeNames[result.type] || '';
            
            gachaResult.innerHTML = `
                <div class="gacha-result-icon">${icon}</div>
                <div class="gacha-result-text">${name}</div>
                <div class="gacha-result-meta">
                    <div class="gacha-rarity rarity-${result.item.rarity}">${rarity}</div>
                    <div class="gacha-result-type">${type}</div>
                </div>
            `;
            
            // ÂäπÊûúÈü≥„ÇíÂÜçÁîü
            playGachaSound(result.item.rarity);
            
            updateGachaPullButton();
        }
        
        // „Ç¨„ÉÅ„É£„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
        function updateGachaPullButton() {
            // Êòü„Ç¨„ÉÅ„É£„Éú„Çø„É≥
            if (collectedStars >= 10) {
                gachaPullBtnStar.disabled = false;
            } else {
                gachaPullBtnStar.disabled = true;
            }
            
            // „ÉÄ„Ç§„É§„Ç¨„ÉÅ„É£„Éú„Çø„É≥
            if (collectedDiamonds >= 1) {
                gachaPullBtnDiamond.disabled = false;
            } else {
                gachaPullBtnDiamond.disabled = true;
            }
        }
        
        // „Ç¨„ÉÅ„É£„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        closeGachaBtn.addEventListener('click', () => {
            gachaModal.classList.remove('show');
        });
        
        gachaModal.addEventListener('click', (e) => {
            if (e.target === gachaModal) {
                gachaModal.classList.remove('show');
            }
        });
        
        // ÁùÄ„ÅõÊõø„Åà„Éú„Çø„É≥
        document.getElementById('closet-btn').addEventListener('click', () => {
            openClosetModal();
        });
        
        // „Ç∑„Éß„ÉÉ„Éó„Éú„Çø„É≥
        document.getElementById('shop-btn').addEventListener('click', () => {
            openShopModal();
        });
        
        // ÊòüÂÖ®ÂõûÂèé„Éú„Çø„É≥
        document.getElementById('collect-all-btn').addEventListener('click', () => {
            const stars = document.querySelectorAll('.collectible-star');
            if (stars.length === 0) return; // Êòü„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            
            // ÂäπÊûúÈü≥„ÇíÂÜçÁîü
            playCollectAllSound();
            
            stars.forEach(star => {
                if (star.dataset.isDiamond === 'true') {
                    collectedDiamonds++;
                } else {
                    collectedStars++;
                }
                star.remove();
            });
            updateStarCounter();
            updateDiamondCounter();
            saveGameData();
            showDialogue('Êòü„ÇíÂÖ®ÈÉ®ÂõûÂèé„Åó„ÅüÔºÅ', true);
        });
        
        // ÁùÄ„ÅõÊõø„Åà„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openClosetModal() {
            closetModal.classList.add('show');
            updateClosetItems();
        }
        
        // ÁùÄ„ÅõÊõø„Åà„Ç¢„Ç§„ÉÜ„É†Ë°®Á§∫
        function updateClosetItems() {
            const charactersGrid = document.getElementById('closet-characters');
            const backgroundsGrid = document.getElementById('closet-backgrounds');
            
            // „Ç≠„É£„É©„ÇØ„Çø„ÉºË°®Á§∫
            charactersGrid.innerHTML = '';
            
            // „Éá„Éï„Ç©„É´„Éà„ÅÆüåö
            const defaultChar = document.createElement('div');
            defaultChar.className = 'reward-item';
            if (currentCharacter === 'üåö') defaultChar.classList.add('active');
            defaultChar.innerHTML = `
                <div class="reward-icon">üåö</div>
                <div class="reward-name">„Åä„Å®„Äú„Åµ</div>
                <div class="reward-unlock">„Éá„Éï„Ç©„É´„Éà</div>
            `;
            defaultChar.onclick = () => {
                currentCharacter = 'üåö';
                character.textContent = 'üåö';
                updateExistingStars();
                saveGameData();
                updateClosetItems();
            };
            charactersGrid.appendChild(defaultChar);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„Ç≠„É£„É©„ÇØ„Çø„Éº
            // üêµ „Çµ„É´ (Rank 5)
            const monkeyChar = document.createElement('div');
            monkeyChar.className = 'reward-item';
            if (rank >= 5) {
                if (currentCharacter === 'üêµ') monkeyChar.classList.add('active');
                monkeyChar.innerHTML = `
                    <div class="reward-icon">üêµ</div>
                    <div class="reward-name">„Çµ„É´</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                monkeyChar.onclick = () => {
                    currentCharacter = 'üêµ';
                    character.textContent = 'üêµ';
                    updateExistingStars();
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                monkeyChar.classList.add('locked');
                monkeyChar.innerHTML = `
                    <div class="reward-icon">üêµ</div>
                    <div class="reward-name">„Çµ„É´</div>
                    <div class="reward-locked">Rank 5„ÅßËß£Á¶Å</div>
                `;
            }
            charactersGrid.appendChild(monkeyChar);
            
            // ü§° „Éî„Ç®„É≠ (Rank 10)
            const clownChar = document.createElement('div');
            clownChar.className = 'reward-item';
            if (rank >= 10) {
                if (currentCharacter === 'ü§°') clownChar.classList.add('active');
                clownChar.innerHTML = `
                    <div class="reward-icon">ü§°</div>
                    <div class="reward-name">„Éî„Ç®„É≠</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                clownChar.onclick = () => {
                    currentCharacter = 'ü§°';
                    character.textContent = 'ü§°';
                    updateExistingStars();
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                clownChar.classList.add('locked');
                clownChar.innerHTML = `
                    <div class="reward-icon">ü§°</div>
                    <div class="reward-name">„Éî„Ç®„É≠</div>
                    <div class="reward-locked">Rank 10„ÅßËß£Á¶Å</div>
                `;
            }
            charactersGrid.appendChild(clownChar);
            
            // üåù „É†„Éº„É≥ (Rank 20)
            const moonFaceChar = document.createElement('div');
            moonFaceChar.className = 'reward-item';
            if (rank >= 20) {
                if (currentCharacter === 'üåù') moonFaceChar.classList.add('active');
                moonFaceChar.innerHTML = `
                    <div class="reward-icon">üåù</div>
                    <div class="reward-name">„É†„Éº„É≥</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                moonFaceChar.onclick = () => {
                    currentCharacter = 'üåù';
                    character.textContent = 'üåù';
                    updateExistingStars();
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                moonFaceChar.classList.add('locked');
                moonFaceChar.innerHTML = `
                    <div class="reward-icon">üåù</div>
                    <div class="reward-name">„É†„Éº„É≥</div>
                    <div class="reward-locked">Rank 20„ÅßËß£Á¶Å</div>
                `;
            }
            charactersGrid.appendChild(moonFaceChar);
            
            // „Ç¨„ÉÅ„É£„Ç≠„É£„É©„ÇØ„Çø„Éº
            gachaCharacters.forEach(char => {
                const item = document.createElement('div');
                item.className = 'reward-item';
                
                if (unlockedCharacters.includes(char.emoji)) {
                    if (currentCharacter === char.emoji) item.classList.add('active');
                    item.innerHTML = `
                        <div class="reward-icon">${char.emoji}</div>
                        <div class="reward-name">${char.name}</div>
                        <div class="reward-unlock">ÊâÄÊåÅ</div>
                    `;
                    item.onclick = () => {
                        currentCharacter = char.emoji;
                        character.textContent = char.emoji;
                        updateExistingStars();
                        saveGameData();
                        updateClosetItems();
                    };
                } else {
                    item.classList.add('locked');
                    item.innerHTML = `
                        <div class="reward-icon">‚ùì</div>
                        <div class="reward-name">???</div>
                        <div class="reward-locked">Êú™ÊâÄÊåÅ</div>
                    `;
                }
                
                charactersGrid.appendChild(item);
            });
            
            // ËÉåÊôØË°®Á§∫
            backgroundsGrid.innerHTML = '';
            
            // „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§úÁ©∫
            const defaultBg = document.createElement('div');
            defaultBg.className = 'reward-item';
            if (currentBackground === 'night') defaultBg.classList.add('active');
            defaultBg.innerHTML = `
                <div class="reward-icon">üåô</div>
                <div class="reward-name">Â§úÁ©∫</div>
                <div class="reward-unlock">„Éá„Éï„Ç©„É´„Éà</div>
            `;
            defaultBg.onclick = () => {
                currentBackground = 'night';
                document.body.className = 'night-bg';
                
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('night');
                saveGameData();
                updateClosetItems();
            };
            backgroundsGrid.appendChild(defaultBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆÂ§ïÊöÆ„Çå (Rank 15)
            const cityBg = document.createElement('div');
            cityBg.className = 'reward-item';
            if (rank >= 15) {
                if (currentBackground === 'city') cityBg.classList.add('active');
                cityBg.innerHTML = `
                    <div class="reward-icon">üåÜ</div>
                    <div class="reward-name">Â§ïÊöÆ„Çå</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                cityBg.onclick = () => {
                    currentBackground = 'city';
                    document.body.className = 'city-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('city');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                cityBg.classList.add('locked');
                cityBg.innerHTML = `
                    <div class="reward-icon">üåÜ</div>
                    <div class="reward-name">Â§ïÊöÆ„Çå</div>
                    <div class="reward-locked">Rank 15„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(cityBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆËôπ (Rank 20)
            const rainbowBg = document.createElement('div');
            rainbowBg.className = 'reward-item';
            if (rank >= 20) {
                if (currentBackground === 'rainbow') rainbowBg.classList.add('active');
                rainbowBg.innerHTML = `
                    <div class="reward-icon">üåà</div>
                    <div class="reward-name">Ëôπ</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                rainbowBg.onclick = () => {
                    currentBackground = 'rainbow';
                    document.body.className = 'rainbow-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('rainbow');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                rainbowBg.classList.add('locked');
                rainbowBg.innerHTML = `
                    <div class="reward-icon">üåà</div>
                    <div class="reward-name">Ëôπ</div>
                    <div class="reward-locked">Rank 20„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(rainbowBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆ„Ç≥„Çπ„É¢ (Rank 100)
            const cosmosBg = document.createElement('div');
            cosmosBg.className = 'reward-item';
            if (rank >= 100) {
                if (currentBackground === 'cosmos') cosmosBg.classList.add('active');
                cosmosBg.innerHTML = `
                    <div class="reward-icon">üí´</div>
                    <div class="reward-name">„Ç≥„Çπ„É¢</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                cosmosBg.onclick = () => {
                    currentBackground = 'cosmos';
                    document.body.className = 'cosmos-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('cosmos');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                cosmosBg.classList.add('locked');
                cosmosBg.innerHTML = `
                    <div class="reward-icon">üí´</div>
                    <div class="reward-name">„Ç≥„Çπ„É¢</div>
                    <div class="reward-locked">Rank 100„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(cosmosBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆ„Éû„Éà„É™„ÉÉ„ÇØ„Çπ (Rank 200)
            const matrixBg = document.createElement('div');
            matrixBg.className = 'reward-item';
            if (rank >= 200) {
                if (currentBackground === 'matrix') matrixBg.classList.add('active');
                matrixBg.innerHTML = `
                    <div class="reward-icon">üî∑</div>
                    <div class="reward-name">„Éû„Éà„É™„ÉÉ„ÇØ„Çπ</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                matrixBg.onclick = () => {
                    currentBackground = 'matrix';
                    document.body.className = 'matrix-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('matrix');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                matrixBg.classList.add('locked');
                matrixBg.innerHTML = `
                    <div class="reward-icon">üî∑</div>
                    <div class="reward-name">„Éû„Éà„É™„ÉÉ„ÇØ„Çπ</div>
                    <div class="reward-locked">Rank 200„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(matrixBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆ„Ç¢„ÇØ„Ç¢ (Rank 300)
            const aquaBg = document.createElement('div');
            aquaBg.className = 'reward-item';
            if (rank >= 300) {
                if (currentBackground === 'aqua') aquaBg.classList.add('active');
                aquaBg.innerHTML = `
                    <div class="reward-icon">üíß</div>
                    <div class="reward-name">„Ç¢„ÇØ„Ç¢</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                aquaBg.onclick = () => {
                    currentBackground = 'aqua';
                    document.body.className = 'aqua-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('aqua');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                aquaBg.classList.add('locked');
                aquaBg.innerHTML = `
                    <div class="reward-icon">üíß</div>
                    <div class="reward-name">„Ç¢„ÇØ„Ç¢</div>
                    <div class="reward-locked">Rank 300„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(aquaBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆ„É°„Éà„É≠„Éù„É™„Çπ (Rank 400)
            const metroBg = document.createElement('div');
            metroBg.className = 'reward-item';
            if (rank >= 400) {
                if (currentBackground === 'metro') metroBg.classList.add('active');
                metroBg.innerHTML = `
                    <div class="reward-icon">üèôÔ∏è</div>
                    <div class="reward-name">„É°„Éà„É≠„Éù„É™„Çπ</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                metroBg.onclick = () => {
                    currentBackground = 'metro';
                    document.body.className = 'metro-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('metro');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                metroBg.classList.add('locked');
                metroBg.innerHTML = `
                    <div class="reward-icon">üèôÔ∏è</div>
                    <div class="reward-name">„É°„Éà„É≠„Éù„É™„Çπ</div>
                    <div class="reward-locked">Rank 400„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(metroBg);
            
            // „É©„É≥„ÇØÂ†±ÈÖ¨„ÅÆ„Éè„ÉÉ„Ç´„Éº (Rank 500)
            const hackerBg = document.createElement('div');
            hackerBg.className = 'reward-item';
            if (rank >= 500) {
                if (currentBackground === 'hacker') hackerBg.classList.add('active');
                hackerBg.innerHTML = `
                    <div class="reward-icon">üíª</div>
                    <div class="reward-name">„Éè„ÉÉ„Ç´„Éº</div>
                    <div class="reward-unlock">„É©„É≥„ÇØÂ†±ÈÖ¨</div>
                `;
                hackerBg.onclick = () => {
                    currentBackground = 'hacker';
                    document.body.className = 'hacker-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect('hacker');
                    saveGameData();
                    updateClosetItems();
                };
            } else {
                hackerBg.classList.add('locked');
                hackerBg.innerHTML = `
                    <div class="reward-icon">üíª</div>
                    <div class="reward-name">„Éè„ÉÉ„Ç´„Éº</div>
                    <div class="reward-locked">Rank 500„ÅßËß£Á¶Å</div>
                `;
            }
            backgroundsGrid.appendChild(hackerBg);
            
            // „Ç¨„ÉÅ„É£ËÉåÊôØ
            gachaBackgrounds.forEach(bg => {
                const item = document.createElement('div');
                item.className = 'reward-item';
                
                if (unlockedBackgrounds.includes(bg.id)) {
                    if (currentBackground === bg.id) item.classList.add('active');
                    item.innerHTML = `
                        <div class="reward-icon">${bg.emoji}</div>
                        <div class="reward-name">${bg.name}</div>
                        <div class="reward-unlock">ÊâÄÊåÅ</div>
                    `;
                    item.onclick = () => {
                        currentBackground = bg.id;
                        document.body.className = bg.id + '-bg';
                        
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect(bg.id);
                        saveGameData();
                        updateClosetItems();
                    };
                } else {
                    item.classList.add('locked');
                    item.innerHTML = `
                        <div class="reward-icon">‚ùì</div>
                        <div class="reward-name">???</div>
                        <div class="reward-locked">Êú™ÊâÄÊåÅ</div>
                    `;
                }
                
                backgroundsGrid.appendChild(item);
            });
            
            // È£æ„Çä„ÅÆË°®Á§∫
            const decorsGrid = document.getElementById('closet-decors');
            decorsGrid.innerHTML = '';
            
            // È£æ„Çä„Çπ„É≠„ÉÉ„Éà„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            let activeDecorSlot = 0;
            const slotBtns = document.querySelectorAll('.decor-slot-btn');
            slotBtns.forEach((btn, idx) => {
                // Ë£ÖÂÇô‰∏≠„ÅÆÈ£æ„Çä„ÇíË°®Á§∫
                const equipped = equippedDecor[idx];
                if (equipped) {
                    btn.textContent = `„Çπ„É≠„ÉÉ„Éà${idx + 1} ${equipped}`;
                    btn.style.background = 'rgba(255, 215, 0, 0.15)';
                } else {
                    btn.textContent = `„Çπ„É≠„ÉÉ„Éà${idx + 1}`;
                    btn.style.background = 'rgba(0,0,0,0.28)';
                }
                
                btn.onclick = () => {
                    slotBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    activeDecorSlot = idx;
                };
            });
            
            // ÊâÄÊåÅ„Åó„Å¶„ÅÑ„ÇãÈ£æ„Çä„ÇíË°®Á§∫
            Object.keys(ownedDecor).forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'decor-item-btn';
                btn.textContent = emoji;
                btn.title = ownedDecor[emoji];
                
                // Êó¢„Å´Ë£ÖÂÇô„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const isEquipped = equippedDecor.includes(emoji);
                if (isEquipped) {
                    btn.style.border = '3px solid #FFD700';
                    btn.style.background = 'rgba(255, 215, 0, 0.2)';
                    btn.style.boxShadow = '0 0 15px rgba(255, 215, 0, 0.5)';
                }
                
                btn.onclick = () => {
                    // Êó¢„Å´‰ªñ„ÅÆ„Çπ„É≠„ÉÉ„Éà„Å´Ë£ÖÂÇô„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    const existingSlot = equippedDecor.indexOf(emoji);
                    if (existingSlot !== -1 && existingSlot !== activeDecorSlot) {
                        return;
                    }
                    
                    // Ë£ÖÂÇô
                    equippedDecor[activeDecorSlot] = emoji;
                    dailyMissionProgress.changedDecor = true;
                    saveGameData();
                    renderPlaceableDecor();
                    updateClosetItems(); // „Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
                    
                    // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                    btn.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        btn.style.transform = '';
                    }, 200);
                };
                decorsGrid.appendChild(btn);
            });
            
            // Á©∫„Å´„Åô„Çã„Éú„Çø„É≥
            if (Object.keys(ownedDecor).length > 0) {
                const emptyBtn = document.createElement('button');
                emptyBtn.className = 'decor-item-btn';
                emptyBtn.textContent = '‚ùå';
                emptyBtn.title = 'Â§ñ„Åô';
                emptyBtn.style.background = 'rgba(255, 100, 100, 0.2)';
                emptyBtn.style.border = '2px solid rgba(255, 100, 100, 0.5)';
                emptyBtn.onclick = () => {
                    equippedDecor[activeDecorSlot] = null;
                    decorPlacements[activeDecorSlot] = null;
                    saveGameData();
                    renderPlaceableDecor();
                    updateClosetItems(); // „Çπ„É≠„ÉÉ„ÉàË°®Á§∫„ÇíÊõ¥Êñ∞
                    
                    // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                    emptyBtn.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        emptyBtn.style.transform = '';
                    }, 200);
                };
                decorsGrid.appendChild(emptyBtn);
            }
            
            // È£æ„Çä„Åå„Å™„ÅÑÂ†¥Âêà
            if (Object.keys(ownedDecor).length === 0) {
                decorsGrid.innerHTML = '<div style="color: rgba(255,255,255,0.5); padding: 20px;">„Ç¨„ÉÅ„É£„ÅßÈ£æ„Çä„Çí„Ç≤„ÉÉ„Éà„Åó„Çà„ÅÜÔºÅ</div>';
            }
        }
        
        // ÁùÄ„ÅõÊõø„Åà„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        closeClosetBtn.addEventListener('click', () => {
            closetModal.classList.remove('show');
            renderPlaceableDecor();
        });
        
        closetModal.addEventListener('click', (e) => {
            if (e.target === closetModal) {
                closetModal.classList.remove('show');
                renderPlaceableDecor();
            }
        });
        
        // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
        function updateCharCount() {
            const length = usernameInput.value.length;
            usernameCharCount.textContent = `${length} / 6`;
        }
        
        // ÂÖ•ÂäõÊôÇ„Å´ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
        usernameInput.addEventListener('input', updateCharCount);
        
        // „É¶„Éº„Ç∂„Éº„Éç„Éº„É†‰øùÂ≠ò
        usernameSaveBtn.addEventListener('click', () => {
            const newUsername = usernameInput.value.trim();
            if (newUsername.length > 0 && newUsername.length <= 6) {
                username = newUsername;
                usernameText.textContent = username;
                saveGameData();
                refreshUIFromState();
                usernameModal.classList.remove('show');
            } else if (newUsername.length === 0) {
                username = 'ÂêçÂâç„ÇíÂÖ•Âäõ';
                usernameText.textContent = username;
                saveGameData();
                refreshUIFromState();
                usernameModal.classList.remove('show');
            } else {
                alert('„É¶„Éº„Ç∂„Éº„Éç„Éº„É†„ÅØ6ÊñáÂ≠ó‰ª•ÂÜÖ„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        });
        
        // „Ç≠„É£„É≥„Çª„É´
        usernameCancelBtn.addEventListener('click', () => {
            usernameModal.classList.remove('show');
        });
        
        // „É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        usernameModal.addEventListener('click', (e) => {
            if (e.target === usernameModal) {
                usernameModal.classList.remove('show');
            }
        });
        
        // Enter„Ç≠„Éº„Åß‰øùÂ≠ò
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                usernameSaveBtn.click();
            }
        });
        
        
        // „Çª„Éº„ÉñË™≠ËæºÂæå„ÇÑ„Çª„Éº„ÉñÂºï„ÅçÁ∂ô„ÅéÂæå„Å´„ÄÅÁèæÂú®„ÅÆÁä∂ÊÖã„ÇíÁîªÈù¢„Å∏ÂèçÊò†„Åô„Çã
        function refreshUIFromState() {
            try {
                if (typeof usernameText !== 'undefined' && usernameText) {
                    usernameText.textContent = username || 'ÂêçÂâç„ÇíÂÖ•Âäõ';
                }
                if (typeof character !== 'undefined' && character) {
                    character.textContent = currentCharacter || 'üåö';
                }

                // „Éá„Éê„ÉÉ„Ç∞„Éú„Çø„É≥„ÅÆË°®Á§∫Âà∂Âæ°
                const debugBtn = document.getElementById('debug-idle-btn');
                if (debugBtn) {
                    debugBtn.style.display = (username === '„ÉÜ„Çπ„Éà') ? 'block' : 'none';
                }

                if (currentBackground) {
                    document.body.className = currentBackground + '-bg';
                    
            const bgfx = document.getElementById('bgfx');
            if (bgfx) bgfx.className = document.body.className;
generateBackgroundEffect(currentBackground);
                }

                if (typeof updateStarCounter === 'function') updateStarCounter();
                if (typeof updateRankDisplay === 'function') updateRankDisplay();
                if (typeof updateDiamondCounter === 'function') updateDiamondCounter();
                if (typeof updateMissionList === 'function') updateMissionList();
                if (typeof updateRewardItems === 'function') updateRewardItems();
                if (typeof updateGachaPullButton === 'function') updateGachaPullButton();
                if (typeof updateButtonStates === 'function') updateButtonStates();
                if (typeof updateClosetItems === 'function') updateClosetItems();
                if (typeof renderPlaceableDecor === 'function') renderPlaceableDecor();
                if (typeof updateExistingStars === 'function') updateExistingStars();
            } catch (e) {
                console.warn('refreshUIFromState failed', e);
            }
        }

// ÂàùÊúüÂåñ
        loadGameData();
        refreshUIFromState();
        updateSkillDisplay();
        updateTitleDisplay();
        
        // ÊîæÁΩÆÂ†±ÈÖ¨„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        checkIdleReward();
        
        // ÊîæÁΩÆÂ†±ÈÖ¨„ÅÆÂèó„ÅëÂèñ„Çä„Éú„Çø„É≥
        document.getElementById('claim-idle-reward-btn').addEventListener('click', claimIdleReward);
        
        // „Éá„Éê„ÉÉ„Ç∞„Éú„Çø„É≥Ôºà‰∏ÄÊôÇÁöÑÔºâ
        document.getElementById('debug-idle-btn').addEventListener('click', () => {
            // „É©„É≥„ÇØ„Çí500„Å´Ë®≠ÂÆö
            rank = 500;
            experience = (rank - 1) * 100; // ÁµåÈ®ìÂÄ§„ÇÇË™øÊï¥
            updateRankDisplay();
            
            // ÂÖ®Áß∞Âè∑„ÇíËß£Êîæ
            unlockedTitles = Object.keys(titles);
            
            // ÂÖ®ËÉåÊôØ„ÇíËß£Êîæ
            if (!unlockedBackgrounds.includes('cosmos')) unlockedBackgrounds.push('cosmos');
            if (!unlockedBackgrounds.includes('matrix')) unlockedBackgrounds.push('matrix');
            if (!unlockedBackgrounds.includes('aqua')) unlockedBackgrounds.push('aqua');
            if (!unlockedBackgrounds.includes('metro')) unlockedBackgrounds.push('metro');
            if (!unlockedBackgrounds.includes('hacker')) unlockedBackgrounds.push('hacker');
            
            saveGameData();
            showDialogue('üéâ „É©„É≥„ÇØ500 & ÂÖ®Áß∞Âè∑ & ÂÖ®ÁâπÂÖ∏ËÉåÊôØ„ÇíËß£Êîæ„Åó„Åæ„Åó„ÅüÔºÅ', true);
            
            // ÊîæÁΩÆÂ†±ÈÖ¨„É¢„Éº„ÉÄ„É´„ÇÇË°®Á§∫
            showIdleRewardModal(10, 100);
        });
        
        // Áß∞Âè∑„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.getElementById('title-display').addEventListener('click', openTitleModal);
        document.getElementById('close-title-modal-btn').addEventListener('click', () => {
            document.getElementById('title-modal').style.display = 'none';
        });
        
        // Áß∞Âè∑„É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.getElementById('title-modal').addEventListener('click', (e) => {
            if (e.target.id === 'title-modal') {
                document.getElementById('title-modal').style.display = 'none';
            }
        });
        
        // „Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.getElementById('skill-diamond-btn').addEventListener('click', () => upgradeSkill('diamond'));
        document.getElementById('skill-speed-btn').addEventListener('click', () => upgradeSkill('speed'));
        document.getElementById('skill-bonus-btn').addEventListener('click', () => upgradeSkill('bonus'));
        
        // „Ç∑„É™„Ç¢„É´„Ç≥„Éº„ÉâÊ©üËÉΩÔºàÂàùÊúüÂåñÂæå„Å´Ë®≠ÂÆöÔºâ
        const serialInput = document.getElementById('serial-input');
        const serialSubmitBtn = document.getElementById('serial-submit-btn');
        const serialMessage = document.getElementById('serial-message');
        
        // ‰ΩøÁî®Ê∏à„Åø„Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ„ÇíÁÆ°ÁêÜ
        let usedSerialCodes = JSON.parse(safeStorage.getItem('usedSerialCodes') || '[]');
        
        serialSubmitBtn.addEventListener('click', () => {
            const code = serialInput.value.trim();
            
            if (!code) {
                serialMessage.textContent = '„Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                serialMessage.className = 'error';
                return;
            }
            
            // „Åô„Åß„Å´‰ΩøÁî®Ê∏à„Åø„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (usedSerialCodes.includes(code)) {
                serialMessage.textContent = '„Åì„ÅÆ„Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ„ÅØÊó¢„Å´‰ΩøÁî®Ê∏à„Åø„Åß„Åô';
                serialMessage.className = 'error';
                return;
            }
            
            // „Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            let reward = null;
            
            if (code === 'otofu1022') {
                // Êòü30ÂÄã„ÄÅ„ÉÄ„Ç§„É§3ÂÄã„ÇíËøΩÂä†
                collectedStars = Math.min(collectedStars + 30, maxStars);
                collectedDiamonds = Math.min(collectedDiamonds + 3, maxDiamonds);
                reward = '‚ú® Êòü√ó30„ÄÅüíé√ó3 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            } else if (code === 'update2') {
                // Êòü100ÂÄã„ÄÅ„ÉÄ„Ç§„É§10ÂÄã„ÇíËøΩÂä†
                collectedStars = Math.min(collectedStars + 100, maxStars);
                collectedDiamonds = Math.min(collectedDiamonds + 10, maxDiamonds);
                reward = '‚ú® Êòü√ó100„ÄÅüíé√ó10 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            } else if (code === 'otofu123') {
                // Êòü500ÂÄã„ÄÅ„ÉÄ„Ç§„É§50ÂÄã„ÇíËøΩÂä†
                collectedStars = Math.min(collectedStars + 500, maxStars);
                collectedDiamonds = Math.min(collectedDiamonds + 50, maxDiamonds);
                reward = '‚ú® Êòü√ó500„ÄÅüíé√ó50 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            } else if (code === 'thanks5') {
                // Êòü50ÂÄã„ÄÅ„ÉÄ„Ç§„É§5ÂÄã„ÇíËøΩÂä†
                collectedStars = Math.min(collectedStars + 50, maxStars);
                collectedDiamonds = Math.min(collectedDiamonds + 5, maxDiamonds);
                reward = '‚ú® Êòü√ó50„ÄÅüíé√ó5 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            } else if (code === 'diamond5') {
                // „ÉÄ„Ç§„É§5ÂÄã„ÇíËøΩÂä†
                collectedDiamonds = Math.min(collectedDiamonds + 5, maxDiamonds);
                reward = 'üíé „ÉÄ„Ç§„É§√ó5 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            } else if (code === 'star30') {
                // Êòü30ÂÄã„ÇíËøΩÂä†
                collectedStars = Math.min(collectedStars + 30, maxStars);
                reward = '‚≠êÔ∏è Êòü√ó30 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            } else if (code === 'star50') {
                // Êòü50ÂÄã„ÇíËøΩÂä†
                collectedStars = Math.min(collectedStars + 50, maxStars);
                reward = '‚≠êÔ∏è Êòü√ó50 „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ';
            }
            
            if (reward) {
                // ‰ΩøÁî®Ê∏à„Åø„Ç≥„Éº„Éâ„Å´ËøΩÂä†
                usedSerialCodes.push(code);
                safeStorage.setItem('usedSerialCodes', JSON.stringify(usedSerialCodes));
                
                // Ë°®Á§∫„ÇíÊõ¥Êñ∞
                updateStarCounter();
                updateDiamondCounter();
                saveGameData();
                
                serialMessage.textContent = reward;
                serialMessage.className = 'success';
                serialInput.value = '';
            } else {
                serialMessage.textContent = 'ÁÑ°Âäπ„Å™„Ç∑„É™„Ç¢„É´„Ç≥„Éº„Éâ„Åß„Åô';
                serialMessage.className = 'error';
            }
        });
        
        // Enter„Ç≠„Éº„Åß„ÇÇÈÄÅ‰ø°„Åß„Åç„Çã„Çà„ÅÜ„Å´
        serialInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                serialSubmitBtn.click();
            }
        });
        
        // ÂàùÊúü„ÅÆÊòü„ÇíÁîüÊàê
        for (let i = 0; i < 5; i++) {
            spawnCollectibleStars();
        }
        
        // ÂàùÂõû„ÅÆÊòü„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÈñìÈöîË®≠ÂÆö
        updateStarSpawnInterval();
        
        // ÂÆöÊúüÁöÑ„Å´„Éú„Éº„Éä„ÇπÊúà„Çí„É©„É≥„ÉÄ„É†„ÅßÂá∫Áèæ„Åï„Åõ„Çã
        setInterval(() => {
            // Âü∫Êú¨10%„ÅÆÁ¢∫Áéá„ÅßÂá∫Áèæ„ÄÅ„Çπ„Ç≠„É´„É¨„Éô„É´„ÅßÊúÄÂ§ß1.5ÂÄçÔºà15%Ôºâ„Åæ„Åß‰∏äÊòá
            const bonusMultiplier = 1 + (skillBonusLevel * 0.1); // 1.0„Äú1.5ÂÄç
            const bonusChance = 0.1 * bonusMultiplier; // 0.1„Äú0.15
            if (Math.random() < bonusChance) {
                spawnBonusMoon();
            }
        }, 60000); // 1ÂàÜ„Åî„Å®„Å´„ÉÅ„Çß„ÉÉ„ÇØ
        
        // ÂÆöÊúüÁöÑ„Å´„Éú„Éº„Éä„Çπ„ÇÆ„Éï„Éà„Çí„É©„É≥„ÉÄ„É†„ÅßÂá∫Áèæ„Åï„Åõ„ÇãÔºà„Çà„Çä‰ΩéÁ¢∫ÁéáÔºâ
        setInterval(() => {
            // Âü∫Êú¨3%„ÅÆÁ¢∫Áéá„ÅßÂá∫Áèæ„ÄÅ„Çπ„Ç≠„É´„É¨„Éô„É´„ÅßÊúÄÂ§ß1.5ÂÄçÔºà4.5%Ôºâ„Åæ„Åß‰∏äÊòá
            const bonusMultiplier = 1 + (skillBonusLevel * 0.1); // 1.0„Äú1.5ÂÄç
            const giftChance = 0.03 * bonusMultiplier; // 0.03„Äú0.045
            if (Math.random() < giftChance) {
                spawnBonusGift();
            }
        }, 60000); // 1ÂàÜ„Åî„Å®„Å´„ÉÅ„Çß„ÉÉ„ÇØ
        
        // ÂÆöÊúüÁöÑ„Å´„É©„É≥„ÉÄ„É†„Çª„É™„Éï
        setInterval(() => {
            if (!speechBubble.classList.contains('show')) {
                const dialogue = getRandomDialogue();
                if (Math.random() < 0.2) {
                    showDialogue(dialogue);
                }
            }
        }, 25000);
        
        // „Éö„Éº„Ç∏„ÇíÈñâ„Åò„ÇãÊôÇ„Å´lastPlayTime„ÇíÊõ¥Êñ∞
        window.addEventListener('beforeunload', () => {
            lastPlayTime = Date.now();
            idleRewardClaimed = false;
            saveGameData();
        });
    </script>

<script>
/* === Portrait viewport fix (Android fullscreen / landscape issues) === */
(function () {
  const app = document.getElementById('app');

  function apply() {
    if (!app) return;
    const w = window.innerWidth;
    const h = window.innerHeight;
    const isLandscape = w > h;

    // PC(itch iframeÂê´„ÇÄ)„Åß„ÅØÂõûËª¢„Åó„Å™„ÅÑ„ÄÇ„Çπ„Éû„ÉõÂπÖ„ÅÆ„Å®„Åç„Å†„ÅëÊ®™Âêë„Åç‚ÜíÁ∏¶„Å´Êàª„Åô„ÄÇ
    const isNarrow = window.matchMedia('(max-width: 767px)').matches;

    if (isLandscape && isNarrow) {
      app.style.width = h + 'px';
      app.style.height = w + 'px';
      app.style.transform = 'rotate(90deg)';
    } else {
      app.style.width = '';
      app.style.height = '';
      app.style.transform = 'none';
    }
  }

  async function tryLockPortrait() {
    try {
      if (screen.orientation && screen.orientation.lock) {
        await screen.orientation.lock('portrait');
      }
    } catch (e) {
      // iOS Safari: not allowed; Android: may require user gesture/fullscreen/PWA
    }
  }

  window.addEventListener('resize', apply, { passive: true });
  window.addEventListener('orientationchange', () => setTimeout(apply, 50), { passive: true });

  window.addEventListener('load', () => {
    apply();
    tryLockPortrait();
  });

  document.addEventListener('fullscreenchange', () => {
    apply();
    tryLockPortrait();
  });
})();
</script>


<script>
(function(){
    const panel = document.getElementById('skill-panel');
    const btn = document.getElementById('skill-toggle-btn');
    if(!panel || !btn) return;

    let open = false; // always start closed

    function apply(){
        if(open){
            panel.classList.add('open');
            btn.textContent = 'üîΩ';
        }else{
            panel.classList.remove('open');
            btn.textContent = 'üîº';
        }
    }

    btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        open = !open;
        apply();
    });

    apply();
})();
</script>

</body>
</html>